/* Â© 2016 Zaption, Inc. All rights reserved. Modification of this file, or reuse of its contents outside of its original context, is forbidden. */
(function(){var d="/ajax/tours/{tourId}/elements/{elId}/textresponse/responses",a="/ajax/tours/{tourId}/elements/{elId}/numresponse/responses",c="/ajax/tours/{tourId}/elements/{elId}/drawnresponse/responses",b="/ajax/tours/{tourId}/elements/{elId}/checkboxes/responses",e="/ajax/tours/{tourId}/elements/{elId}/multichoice/responses",f="/ajax/tours/{tourId}/elements/{elId}/discussion/responses";ZAP.player=ZAP.player||{};ZAP.player.defineResponseRequests=function(){ZAP.player.standalone&&ZAP.player.webhookUrl&&
(d=a=c=b=e=f=ZAP.player.webhookUrl);amplify.request.define("addTextResponseAnswer","ajax",{url:d,dataType:"json",type:"POST",decoder:"zsend"});amplify.request.define("addNumResponseAnswer","ajax",{url:a,dataType:"json",type:"POST",decoder:"zsend"});amplify.request.define("addDrawnResponseAnswer","ajax",{url:c,dataType:"json",type:"POST",decoder:"zsend"});amplify.request.define("addCheckBoxesAnswer","ajax",{url:b,dataType:"json",type:"POST",decoder:"zsend"});amplify.request.define("addMultipleChoiceAnswer",
"ajax",{url:e,dataType:"json",type:"POST",decoder:"zsend"});amplify.request.define("getDiscussionResponses","ajax",{url:f,dataType:"json",type:"GET",decoder:"zsend"})};ZAP.player.defineResponseRequests()})();
!function(d){function a(a,b,e){e=e||"transparent";var c="obj"+(""+Math.random()).slice(2,15),g='<object class="fp-engine" id="'+c+'" name="'+c+'" ',g=g+(d.browser.msie?'classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000">':' data="'+a+'" type="application/x-shockwave-flash">'),f={width:"100%",height:"100%",allowscriptaccess:"always",wmode:e,quality:"high",flashvars:"",movie:a+(d.browser.msie?"?"+c:""),name:c};return d.each(b,function(a,b){f.flashvars+=a+"="+b+"&"}),d.each(f,function(a,b){g+='<param name="'+
a+'" value="'+b+'"/>'}),g+="</object>",d(g)}function c(a,b){return b=b||100,Math.round(a*b)/b}function b(a){return/mpegurl/i.test(a)?"application/x-mpegurl":"video/"+a}function e(a){return/^(video|application)/i.test(a)||(a=b(a)),!!G.canPlayType(a).replace("no","")}function f(a,b){var e=d.grep(a,function(a){return a.type===b});return e.length?e[0]:null}function g(a){var b=a.attr("src");a=a.attr("type")||"";var e=b.split(C)[1];return a=/mpegurl/i.test(a)?"mpegurl":a.replace("video/",""),{src:b,suffix:e||
a,type:a||e}}function h(a){var b=[];d("source",a).each(function(){b.push(g(d(this)))});b.length||b.push(g(a));this.initialSources=b;this.resolve=function(a){return a?(d.isArray(a)?a={sources:d.map(a,function(a){var b,e=d.extend({},a);return d.each(a,function(a){b=a}),e.type=b,e.src=a[b],delete e[b],e})}:"string"==typeof a&&(a={src:a,sources:[]},d.each(b,function(b,e){"flash"!=e.type&&a.sources.push({type:e.type,src:a.src.replace(C,"."+e.suffix+"$2")})})),a):{sources:b}}}function n(a){return a=parseInt(a,
10),10<=a?a:"0"+a}function k(a){a=a||0;var b=Math.floor(a/3600),e=Math.floor(a/60);return a-=60*e,1<=b?(e-=60*b,b+":"+n(e)+":"+n(a)):n(e)+":"+n(a)}!function(a){if(!a.browser){a=a.browser={};var b=navigator.userAgent.toLowerCase(),b=/(chrome)[ \/]([\w.]+)/.exec(b)||/(safari)[ \/]([\w.]+)/.exec(b)||/(webkit)[ \/]([\w.]+)/.exec(b)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(b)||/(msie) ([\w.]+)/.exec(b)||0>b.indexOf("compatible")&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(b)||[];b[1]&&(a[b[1]]=!0,a.version=
b[2]||"0")}}(jQuery);d(function(){"function"==typeof d.fn.flowplayer&&d("video").parent(".flowplayer").flowplayer()});var l=[],q=[],r=window.navigator.userAgent;window.flowplayer=function(a){return d.isFunction(a)?q.push(a):"number"==typeof a||void 0===a?l[a||0]:d(a).data("flowplayer")};d(window).on("beforeunload",function(){d.each(l,function(a,b){b.conf.splash?b.unload():b.bind("error",function(){d(".flowplayer.is-error .fp-message").remove()})})});var t=!1;try{"object"==typeof window.localStorage&&
(window.localStorage.flowplayerTestStorage="test",t=!0)}catch(w){}var D=/Safari/.exec(navigator.userAgent)&&!/Chrome/.exec(navigator.userAgent);safariVersion=(m=/(\d+\.\d+) Safari/.exec(navigator.userAgent))?Number(m[1]):100;d.extend(flowplayer,{version:"5.5.2",engine:{},conf:{},support:{},defaults:{debug:!1,disabled:!1,engine:"html5",fullscreen:window==window.top,keyboard:!0,ratio:0.5625,adaptiveRatio:!1,flashfit:!1,rtmp:0,splash:!1,live:!1,swf:"//releases.flowplayer.org/5.5.2/commercial/flowplayer.swf",
speeds:[0.25,0.5,1,1.5,2],tooltip:!0,volume:t?"true"==localStorage.muted?0:isNaN(localStorage.volume)?1:localStorage.volume||1:1,errors:";Video loading aborted;Network error;Video not properly encoded;Video file not found;Unsupported video;Skin not found;SWF file not found;Subtitles not found;Invalid RTMP URL;Unsupported video format. Try installing Adobe Flash.".split(";"),errorUrls:"          http://get.adobe.com/flashplayer/".split(" "),playlist:[],hlsFix:D&&8>safariVersion}});var E=1;d.fn.flowplayer=
function(a,b){return"string"==typeof a&&(a={swf:a}),d.isFunction(a)&&(b=a,a={}),!a&&this.data("flowplayer")||this.each(function(){var e,c,g=d(this).addClass("is-loading"),f=d.extend({},flowplayer.defaults,flowplayer.conf,a,g.data()),n=d("video",g).addClass("fp-engine").removeAttr("controls"),k=n.length?new h(n):null,r={};if(f.playlist.length){var w,y=f.preload||n.attr("preload");n.length&&n.replaceWith(w=d("<p />"));n=d("<video />").addClass("fp-engine");w?w.replaceWith(n):g.prepend(n);flowplayer.support.video&&
n.attr("preload",y);"string"==typeof f.playlist[0]?n.attr("src",f.playlist[0]):d.each(f.playlist[0],function(a,b){for(var e in b)b.hasOwnProperty(e)&&n.append(d("<source />").attr({type:"video/"+e,src:b[e]}))});k=new h(n)}(w=g.data("flowplayer"))&&w.unload();g.data("fp-player_id",g.data("fp-player_id")||E++);try{r=t?window.localStorage:r}catch(D){}(y=this.currentStyle&&"rtl"===this.currentStyle.direction||window.getComputedStyle&&"rtl"===window.getComputedStyle(this,null).getPropertyValue("direction"))&&
g.addClass("is-rtl");var p=w||{conf:f,currentSpeed:1,volumeLevel:void 0===f.volume?1*r.volume:f.volume,video:{},disabled:!1,finished:!1,loading:!1,muted:"true"==r.muted||f.muted,paused:!1,playing:!1,ready:!1,splash:!1,rtl:y,load:function(a,b){if(!(p.error||p.loading||p.disabled)){if(a=k.resolve(a),d.extend(a,c.pick(a.sources)),a.src){var e=d.Event("load");g.trigger(e,[p,a,c]);e.isDefaultPrevented()?p.loading=!1:(c.load(a),d.isFunction(a)&&(b=a),b&&g.one("ready",b))}return p}},pause:function(a){return!p.ready||
p.seeking||p.disabled||p.loading||(c.pause(),p.one("pause",a)),p},resume:function(){return p.ready&&p.paused&&!p.disabled&&(c.resume(),p.finished&&(p.trigger("resume",[p]),p.finished=!1)),p},toggle:function(){return p.ready?p.paused?p.resume():p.pause():p.load()},seek:function(a,b){if(p.ready&&!p.live){if("boolean"==typeof a){var f=0.1*p.video.duration;a=p.video.time+(a?f:-f)}a=e=Math.min(Math.max(a,0),p.video.duration).toFixed(1);f=d.Event("beforeseek");g.trigger(f,[p,a]);f.isDefaultPrevented()?
(p.seeking=!1,g.toggleClass("is-seeking",p.seeking)):(c.seek(a),d.isFunction(b)&&g.one("seek",b))}return p},seekTo:function(a,b){return p.seek(void 0===a?e:0.1*p.video.duration*a,b)},mute:function(a){return void 0===a&&(a=!p.muted),r.muted=p.muted=a,r.volume=isNaN(r.volume)?f.volume:r.volume,p.volume(a?0:r.volume,!0),p.trigger("mute",a),p},volume:function(a,b){return p.ready&&(a=Math.min(Math.max(a,0),1),b||(r.volume=a),c.volume(a)),p},speed:function(a,b){return p.ready&&("boolean"==typeof a&&(a=
f.speeds[d.inArray(p.currentSpeed,f.speeds)+(a?1:-1)]||p.currentSpeed),c.speed(a),b&&g.one("speed",b)),p},stop:function(){return p.ready&&(p.pause(),p.seek(0,function(){g.trigger("stop")})),p},unload:function(){return g.hasClass("is-embedding")||(f.splash?(p.trigger("unload"),c.unload()):p.stop()),p},disable:function(a){return void 0===a&&(a=!p.disabled),a!=p.disabled&&(p.disabled=a,p.trigger("disable",a)),p}};p.conf=d.extend(p.conf,f);d.each(["bind","one","unbind"],function(a,b){p[b]=function(a,
e){return g[b](a,e),p}});p.trigger=function(a,b){return g.trigger(a,[p,b]),p};g.data("flowplayer")||g.bind("boot",function(){return d.each(["autoplay","loop","preload","poster"],function(a,b){var e=n.attr(b);void 0!==e&&(f[b]=e?e:!0)}),(f.splash||g.hasClass("is-splash")||!flowplayer.support.firstframe)&&(p.forcedSplash=!f.splash&&!g.hasClass("is-splash"),p.splash=f.splash=f.autoplay=!0,g.addClass("is-splash"),flowplayer.support.video&&n.attr("preload","none")),(f.live||g.hasClass("is-live"))&&(p.live=
f.live=!0,g.addClass("is-live")),d.each(q,function(){this(p,g)}),c=flowplayer.engine[f.engine],c&&(c=c(p,g)),c.pick(k.initialSources)?p.engine=f.engine:d.each(flowplayer.engine,function(a){return a!=f.engine&&(c=this(p,g),c.pick(k.initialSources))?(p.engine=a,!1):void 0}),l.push(p),p.engine?(f.splash?p.unload():p.load(),f.disabled&&p.disable(),c.volume(p.volumeLevel),g.one("ready",b),void 0):p.trigger("error",{code:flowplayer.support.flashVideo?5:10})}).bind("load",function(a,b){f.splash&&d(".flowplayer").filter(".is-ready, .is-loading").not(g).each(function(){var a=
d(this).data("flowplayer");a.conf.splash&&a.unload()});g.addClass("is-loading");b.loading=!0}).bind("ready",function(a,b,e){function c(){g.removeClass("is-loading");b.loading=!1}e.time=0;b.video=e;f.splash?g.one("progress",c):c();b.muted?b.mute(!0):b.volume(b.volumeLevel);a=b.conf.hlsFix&&/mpegurl/i.exec(e.type);g.toggleClass("hls-fix",!!a)}).bind("unload",function(){f.splash&&n.remove();g.removeClass("is-loading");p.loading=!1}).bind("ready unload",function(a){a="ready"==a.type;g.toggleClass("is-splash",
!a).toggleClass("is-ready",a);p.ready=a;p.splash=!a}).bind("progress",function(a,b,e){b.video.time=e}).bind("speed",function(a,b,e){b.currentSpeed=e}).bind("volume",function(a,b,e){b.volumeLevel=Math.round(100*e)/100;b.muted?e&&b.mute(!1):r.volume=e}).bind("beforeseek seek",function(a){p.seeking="beforeseek"==a.type;g.toggleClass("is-seeking",p.seeking)}).bind("ready pause resume unload finish stop",function(a,b,e){p.paused=/pause|finish|unload|stop/.test(a.type);"ready"==a.type&&(p.paused="none"==
f.preload,e&&(p.paused=!e.duration||!f.autoplay&&"none"!=f.preload));p.playing=!p.paused;g.toggleClass("is-paused",p.paused).toggleClass("is-playing",p.playing);p.load.ed||p.pause()}).bind("finish",function(){p.finished=!0}).bind("error",function(){n.remove()});g.trigger("boot",[p,g]).data("flowplayer",p)})};!function(){var a=function(a){return(a=/Version\/(\d\.\d)/.exec(a))&&1<a.length?parseFloat(a[1],10):0},b=flowplayer.support,e=d.browser,c=d("<video loop autoplay preload/>")[0],g=navigator.userAgent,
f=e.msie||/Trident\/7/.test(g),h=/iPad|MeeGo/.test(g)&&!/CriOS/.test(g),n=/iPad/.test(g)&&/CriOS/.test(g),k=/iP(hone|od)/i.test(g)&&!/iPad/.test(g),q=/Android/.test(g)&&!/Firefox/.test(g),t=/Android/.test(g)&&/Firefox/.test(g),l=/Silk/.test(g),p=/IEMobile/.test(g),r=p?parseFloat(/Windows\ Phone\ (\d+\.\d+)/.exec(g)[1],10):0,w=p?parseFloat(/IEMobile\/(\d+\.\d+)/.exec(g)[1],10):0,a=(h?a(g):0,q?parseFloat(/Android\ (\d\.\d)/.exec(g)[1],10):0);d.extend(b,{subtitles:!!c.addTextTrack,fullscreen:"function"==
typeof document.webkitCancelFullScreen&&!/Mac OS X 10_5.+Version\/5\.0\.\d Safari/.test(g)||document.mozFullScreenEnabled||"function"==typeof document.exitFullscreen||"function"==typeof document.msExitFullscreen,inlineBlock:!(f&&8>e.version),touch:"ontouchstart"in window,dataload:!h&&!k&&!p,zeropreload:!f&&!q,volume:!(h||q||k||l||n),cachedVideoTag:!(h||k||n||p),firstframe:!(k||h||q||l||n||p||t),inlineVideo:!k&&(!p||8.1<=r&&11<=w)&&(!q||3<=a),hlsDuration:!q&&(!e.safari||h||k||n),seekable:!h&&!n});
try{var y=navigator.plugins["Shockwave Flash"],D=f?(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version"):y.description;f||y[0].enabledPlugin?(D=D.split(/\D+/),D.length&&!D[0]&&(D=D.slice(1)),b.flashVideo=9<D[0]||9==D[0]&&115<=D[3]):b.flashVideo=!1}catch(B){}try{b.video=!!c.canPlayType,b.video&&c.canPlayType("video/mp4")}catch(E){b.video=!1}b.animation=function(){for(var a=" Webkit Moz O ms Khtml".split(" "),b=d("<p/>")[0],e=0;a.length>e;e++)if("undefined"!==b.style[a[e]+"AnimationName"])return!0}()}();
window.attachEvent&&window.attachEvent("onbeforeunload",function(){__flash_savedUnloadHandler=__flash_unloadHandler=function(){}});flowplayer.engine.flash=function(b,e){var c,g,f,h=b.conf;b.video;var n=d(window),k=function(){if("webkit"==H||A){var a=d("object param[name='flashvars']",e),c=(a.attr("value")||"").split("&");d.each(c,function(e,g){return g=g.split("="),"url"==g[0]&&g[1]!=b.video.url?(c[e]="url="+b.video.url,a.attr({value:c.join("&")}),!1):void 0})}},q=function(a){var c=e.height(),g=e.width();
if(b.conf.flashfit||/full/.test(a.type)){var f,h,k=b.isFullscreen,q=k&&u,t=!flowplayer.support.inlineBlock,l=k?q?screen.width:n.width():g,k=k?q?screen.height:n.height():c,r=q=0,g=t?g:"",c=t?c:"";(b.conf.flashfit||"fullscreen"===a.type)&&(f=b.video.width/b.video.height,h=b.video.height/b.video.width,c=Math.max(h*l),g=Math.max(f*k),c=c>k?g*h:c,c=Math.min(Math.round(c),k),g=g>l?c*f:g,g=Math.min(Math.round(g),l),r=Math.max(Math.round((k+r-c)/2),0),q=Math.max(Math.round((l+q-g)/2),0));d("object",e).css({width:g,
height:c,marginTop:r,marginLeft:q})}},t={pick:function(a){if(flowplayer.support.flashVideo){var b=d.grep(a,function(a){return"flash"==a.type})[0];if(b)return b;for(var e,b=0;a.length>b;b++)if(e=a[b],/mp4|flv/i.test(e.type))return e}},load:function(n){function t(a){return a.replace(/&amp;/g,"%26").replace(/&/g,"%26").replace(/=/g,"%3D")}var l=d("video",e),r=t(n.src);is_absolute=/^https?:/.test(r);var w=function(){l.remove()},y=function(a){return 0<d.grep(a,function(a){return!!l[0].canPlayType("video/"+
a.type)}).length};if(flowplayer.support.video&&l.prop("autoplay")&&y(n.sources)?l.one("timeupdate",w):w(),is_absolute||h.rtmp||(r=d("<img/>").attr("src",r)[0].src),f)f.__play(r);else{b.bind("ready",k).bind("ready fullscreen fullscreen-exit",q);c="fp"+(""+Math.random()).slice(3,15);var x={hostname:h.embedded?h.hostname:location.hostname,url:r,callback:"jQuery."+c};e.data("origin")&&(x.origin=e.data("origin"));is_absolute&&delete h.rtmp;d.each("key autoplay preload rtmp subscribe live loop debug splash poster rtmpt".split(" "),
function(a,b){h.hasOwnProperty(b)&&(x[b]=h[b])});void 0!==h.bufferTime&&(x.bufferTime=h.bufferTime);x.rtmp&&(x.rtmp=t(x.rtmp));x.initialVolume=b.volumeLevel;g=a(h.swf,x,h.wmode);g.prependTo(e);f=g[0];setTimeout(function(){try{if(!f.PercentLoaded())return e.trigger("error",[b,{code:7,url:h.swf}])}catch(a){}},5E3);setTimeout(function(){void 0===f.PercentLoaded&&e.trigger("flashdisabled",[b])},1E3);f.pollInterval=setInterval(function(){if(f){var a=f.__status?f.__status():null;a&&(b.trigger("progress",
a.time),n.buffer=a.buffer/n.bytes*n.duration,b.trigger("buffer",n.buffer),!n.buffered&&0<a.time&&(n.buffered=!0,b.trigger("buffered")))}},250);d[c]=function(a,e){h.debug&&console.log("--",a,e);var c=d.Event(a);switch(a){case "ready":e=d.extend(n,e);break;case "click":c.flash=!0;break;case "keydown":c.which=e;break;case "seek":n.time=e}"buffered"!=a&&setTimeout(function(){b.trigger(c,e)},1)}}},speed:d.noop,unload:function(){f&&f.__unload&&f.__unload();delete d[c];d("object",e).remove();f=0;b.unbind("ready",
k).unbind("ready fullscreen fullscreen-exit",q);clearInterval(f.pollInterval)}};return d.each(["pause","resume","seek","volume"],function(a,c){t[c]=function(a){try{b.ready&&("seek"==c&&b.video.time&&!b.paused&&b.trigger("beforeseek"),void 0===a?f["__"+c]():f["__"+c](a))}catch(g){if(void 0===f["__"+c])return e.trigger("flashdisabled",[b]);throw g;}}}),t};var y,G=d("<video/>")[0],v={ended:"finish",pause:"pause",play:"resume",progress:"buffer",timeupdate:"progress",volumechange:"volume",ratechange:"speed",
seeked:"seek",loadeddata:"ready",error:"error",dataunavailable:"error"};flowplayer.engine.html5=function(a,g){function h(b,f,k){b.listeners&&b.listeners.hasOwnProperty(g.data("fp-player_id"))||((b.listeners||(b.listeners={}))[g.data("fp-player_id")]=!0,f.bind("error",function(b){try{if(b.originalEvent&&d(b.originalEvent.originalTarget).is("img"))return b.preventDefault();e(d(b.target).attr("type"))&&a.trigger("error",{code:4})}catch(c){}}),d.each(v,function(e,f){b.addEventListener(e,function(h){if("progress"==
f&&h.srcElement&&0===h.srcElement.readyState&&setTimeout(function(){a.video.duration||a.conf.live&&("mpegurl"!==a.video.type||!l.hlsDuration)||(f="error",a.trigger(f,{code:4}))},1E4),r.debug&&!/progress/.test(f)&&console.log(e,"->",f,h),(a.ready||/ready|error/.test(f))&&f&&d("video",g).length){var q,t=d.Event(f);switch(f){case "ready":q=d.extend(k,{duration:b.duration,width:b.videoWidth,height:b.videoHeight,url:b.currentSrc,src:b.currentSrc});try{q.seekable=!r.live&&/mpegurl/i.test(k?k.type||"":"")&&
b.duration||b.seekable&&b.seekable.end(null)}catch(w){}if(n=n||setInterval(function(){try{q.buffer=b.buffered.end(null)}catch(e){}q.buffer&&(c(q.buffer,1E3)<c(q.duration,1E3)&&!q.buffered?a.trigger("buffer",h):q.buffered||(q.buffered=!0,a.trigger("buffer",h).trigger("buffered",h),clearInterval(n),n=0))},250),!r.live&&!q.duration&&!l.hlsDuration&&"loadeddata"===e){var y=function(){q.duration=b.duration;try{q.seekable=b.seekable&&b.seekable.end(null)}catch(e){}a.trigger(t,q);b.removeEventListener("durationchange",
y)};return b.addEventListener("durationchange",y),void 0}break;case "progress":case "seek":if(a.video.duration,0<b.currentTime||a.live){q=Math.max(b.currentTime,0);break}if("progress"==f)return;case "speed":q=c(b.playbackRate);break;case "volume":q=c(b.volume);break;case "error":try{q=(h.srcElement||h.originalTarget).error}catch(D){return}}a.trigger(t,q)}},!1)}))}var n,k,q,t=d("video",g),l=flowplayer.support,r=(d("track",t),a.conf);return{pick:function(a){if(l.video){if(r.videoTypePreference){var b=
f(a,r.videoTypePreference);if(b)return b}for(b=0;a.length>b;b++)if(e(a[b].type))return a[b]}},load:function(e){if(r.splash&&!k)t=(y?y.attr({type:b(e.type),src:e.src}):y=d("<video/>",{src:e.src,type:b(e.type),"class":"fp-engine",autoplay:"autoplay",preload:"none","x-webkit-airplay":"allow"})).prependTo(g),l.inlineVideo||t.css({position:"absolute",top:"-9999em"}),r.loop&&t.attr("loop","loop"),k=t[0],void 0!==q&&(k.volume=q);else{k=t[0];var c=t.find("source");!k.src&&c.length&&(k.src=e.src,c.remove());
a.video.src&&e.src!=a.video.src?(t.attr("autoplay","autoplay"),k.src=e.src):"none"!=r.preload&&l.dataload||(l.zeropreload?a.trigger("ready",e).trigger("pause").one("ready",function(){g.trigger("resume",[a])}):a.one("ready",function(){g.trigger("pause",[a])}))}h(k,d("source",t).add(t),e);("none"==r.preload||"mpegurl"==e.type)&&l.zeropreload&&l.dataload||k.load();r.splash&&k.load()},pause:function(){k.pause()},resume:function(){k.play()},speed:function(a){k.playbackRate=a},seek:function(b){try{var e=
a.paused;k.currentTime=b;e&&k.pause()}catch(c){}},volume:function(a){q=a;k&&(k.volume=a)},unload:function(){d("video.fp-engine",g).remove();l.cachedVideoTag||(y=null);n=clearInterval(n);k=0}}};var C=/\.(\w{3,4})(\?.*)?$/i;d.throttle=function(a,b){var e;return function(){e||(a.apply(this,arguments),e=1,setTimeout(function(){e=0},b))}};d.fn.slider2=function(a){var b=/iPad/.test(navigator.userAgent)&&!/CriOS/.test(navigator.userAgent);return this.each(function(){var e,c,g,f,h,n,k=d(this),q=d(document),
t=k.children(":last"),l=!1,r=function(){c=k.offset();g=k.width();k.height();f=g;n=Math.max(0,Math.min(f,h*g))},w=function(a){e||a==E.value||h&&!(h>a)||(k.trigger("slide",[a]),E.value=a)},y=function(b){var e=b.pageX;!e&&b.originalEvent&&b.originalEvent.touches&&b.originalEvent.touches.length&&(e=b.originalEvent.touches[0].pageX);b=e-c.left;b=Math.max(0,Math.min(n||f,b));b/=f;return a&&(b=1-b),D(b,0,!0)},D=function(a,e){void 0===e&&(e=0);1<a&&(a=1);var c=Math.round(1E3*a)/10+"%";return(!h||h>=a)&&(b||
l||t.stop(),l?t.css("width",c):t.animate({width:c},e,"linear")),a},E={max:function(a){h=a},disable:function(a){e=a},slide:function(a,b,e){r();e&&w(a);D(a,b)},disableAnimation:function(a,b){l=!1!==a;k.toggleClass("no-animation",!!b)}};r();k.data("api",E).bind("mousedown.sld touchstart",function(a){if(a.preventDefault(),!e){var b=d.throttle(w,100);r();E.dragging=!0;k.addClass("is-dragging");w(y(a));q.bind("mousemove.sld touchmove",function(a){a.preventDefault();b(y(a))}).one("mouseup touchend",function(){E.dragging=
!1;k.removeClass("is-dragging");q.unbind("mousemove.sld touchmove")})}})})};flowplayer(function(a,b){function e(a){return d(".fp-"+a,b)}function c(a){"0px"!==b.css("width")&&"0px"!==b.css("height")&&a===flowplayer.defaults.ratio||!parseInt(v,10)&&y.css("paddingTop",100*a+"%");n.inlineBlock||d("object",b).height(b.height())}function g(a){b.toggleClass("is-mouseover",a).toggleClass("is-mouseout",!a)}var f,h=a.conf,n=flowplayer.support;b.find(".fp-ratio,.fp-ui").remove();b.addClass("flowplayer").append('      <div class="ratio"/>      <div class="ui">         <div class="waiting"><em/><em/><em/></div>         <a class="fullscreen"/>         <a class="unload"/>         <p class="speed"/>         <div class="controls">            <a class="play"></a>            <div class="timeline">               <div class="buffer"/>               <div class="progress"/>            </div>            <div class="volume">               <a class="mute"></a>               <div class="volumeslider">                  <div class="volumelevel"/>               </div>            </div>         </div>         <div class="time">            <em class="elapsed">00:00</em>            <em class="remaining"/>            <em class="duration">00:00</em>         </div>         <div class="message"><h2/><p/></div>      </div>'.replace(/class="/g,
'class="fp-'));var q=e("progress"),t=e("buffer"),l=e("elapsed"),r=e("remaining"),w=e("waiting"),y=e("ratio"),D=e("speed"),E=e("duration"),v=y.css("paddingTop"),s=e("timeline").slider2(a.rtl),G=s.data("api"),C=(e("volume"),e("fullscreen")),u=e("volumeslider").slider2(a.rtl),z=u.data("api"),A=b.is(".fixed-controls, .no-toggle");G.disableAnimation(b.hasClass("is-touch"));n.animation||w.html("<p>loading &hellip;</p>");c(h.ratio);try{h.fullscreen||C.remove()}catch(F){C.remove()}a.bind("ready",function(){var e=
a.video.duration;G.disable(a.disabled||!e);h.adaptiveRatio&&c(a.video.height/a.video.width);E.add(r).html(k(e));3600<=e&&b.addClass("is-long")||b.removeClass("is-long");z.slide(a.volumeLevel);"flash"===a.engine&&G.disableAnimation(!0,!0)}).bind("unload",function(){v||y.css("paddingTop","")}).bind("buffer",function(){var b=a.video,e=b.buffer/b.duration;!b.seekable&&n.seekable&&G.max(e);1>e?t.css("width",100*e+"%"):t.css({width:"100%"})}).bind("speed",function(a,b,e){D.text(e+"x").addClass("fp-hilite");
setTimeout(function(){D.removeClass("fp-hilite")},1E3)}).bind("buffered",function(){t.css({width:"100%"});G.max(1)}).bind("progress",function(){var b=a.video.time,e=a.video.duration;G.dragging||G.slide(b/e,a.seeking?0:250);l.html(k(b));r.html("-"+k(e-b))}).bind("finish resume seek",function(a){b.toggleClass("is-finished","finish"==a.type)}).bind("stop",function(){l.html(k(0));G.slide(0,100)}).bind("finish",function(){l.html(k(a.video.duration));G.slide(1,100);b.removeClass("is-seeking")}).bind("beforeseek",
function(){q.stop()}).bind("volume",function(){z.slide(a.volumeLevel)}).bind("disable",function(){var e=a.disabled;G.disable(e);z.disable(e);b.toggleClass("is-disabled",a.disabled)}).bind("mute",function(a,e,c){b.toggleClass("is-muted",c)}).bind("error",function(a,e,c){if(b.removeClass("is-loading").addClass("is-error"),c)c.message=h.errors[c.code],e.error=!0,a=d(".fp-message",b),d("h2",a).text((e.engine||"html5")+": "+c.message),d("p",a).text(c.url||e.video.url||e.video.src||h.errorUrls[c.code]),
b.unbind("mouseenter click").removeClass("is-mouseover")}).bind("mouseenter mouseleave",function(a){if(!A){var e;a="mouseenter"==a.type;g(a);a?(b.bind("pause.x mousemove.x volume.x",function(){g(!0);e=new Date}),f=setInterval(function(){5E3<new Date-e&&(g(!1),e=new Date)},100)):(b.unbind(".x"),clearInterval(f))}}).bind("mouseleave",function(){(G.dragging||z.dragging)&&b.addClass("is-mouseover").removeClass("is-mouseout")}).bind("click.player",function(b){return d(b.target).is(".fp-ui, .fp-engine")||
b.flash?(b.preventDefault(),a.toggle()):void 0}).bind("contextmenu",function(a){a.preventDefault();var e=b.offset(),c=d(window),g=a.clientX-e.left;a=a.clientY-e.top+c.scrollTop();var f=b.find(".fp-context-menu").css({left:g+"px",top:a+"px",display:"block"}).on("click",function(a){a.stopPropagation()});d("html").on("click.outsidemenu",function(){f.hide();d("html").off("click.outsidemenu")})}).bind("flashdisabled",function(){b.addClass("is-flash-disabled").one("ready",function(){b.removeClass("is-flash-disabled").find(".fp-flash-disabled").remove()}).append('<div class="fp-flash-disabled">Adobe Flash is disabled for this page, click player area to enable.</div>')});
h.poster&&b.css("backgroundImage","url("+h.poster+")");w=b.css("backgroundColor");w="none"!=b.css("backgroundImage")||w&&"rgba(0, 0, 0, 0)"!=w&&"transparent"!=w;!w||h.splash||h.autoplay||a.bind("ready stop",function(){b.addClass("is-poster").one("progress",function(){b.removeClass("is-poster")})});!w&&a.forcedSplash&&b.css("backgroundColor","#555");d(".fp-toggle, .fp-play",b).click(a.toggle);d.each(["mute","fullscreen","unload"],function(b,c){e(c).click(function(){a[c]()})});s.bind("slide",function(b,
e){a.seeking=!0;a.seek(e*a.video.duration)});u.bind("slide",function(b,e){a.volume(e)});e("time").click(function(){d(this).toggleClass("is-inverted")});g(A)});var z,s;d(document).bind("keydown.fp",function(a){var b=z,e=a.ctrlKey||a.metaKey||a.altKey,c=a.which,g=b&&b.conf;if(b&&g.keyboard&&!b.disabled){if(-1!=d.inArray(c,[63,187,191])||27==c&&s.hasClass("is-help"))return s.toggleClass("is-help"),!1;if(!e&&b.ready){if(a.preventDefault(),a.shiftKey)return 39==c?b.speed(!0):37==c&&b.speed(!1),void 0;
if(58>c&&47<c)return b.seekTo(c-48);switch(c){case 38:case 75:b.volume(b.volumeLevel+0.15);break;case 40:case 74:b.volume(b.volumeLevel-0.15);break;case 39:case 76:b.seeking=!0;b.seek(!0);break;case 37:case 72:b.seeking=!0;b.seek(!1);break;case 190:b.seekTo();break;case 32:b.toggle();break;case 70:g.fullscreen&&b.fullscreen();break;case 77:b.mute();break;case 81:b.unload()}}}});flowplayer(function(a,b){if(a.conf.keyboard){b.bind("mouseenter mouseleave",function(e){(z=a.disabled||"mouseenter"!=e.type?
0:a)&&(s=b)});var e=flowplayer.support.video&&"flash"!==a.conf.engine&&d("<video/>")[0].playbackRate?"<p><em>shift</em> + <em>&#8592;</em><em>&#8594;</em>slower / faster</p>":"";b.append('      <div class="fp-help">         <a class="fp-close"></a>         <div class="fp-help-section fp-help-basics">            <p><em>space</em>play / pause</p>            <p><em>q</em>unload | stop</p>            <p><em>f</em>fullscreen</p>'+e+'         </div>         <div class="fp-help-section">            <p><em>&#8593;</em><em>&#8595;</em>volume</p>            <p><em>m</em>mute</p>         </div>         <div class="fp-help-section">            <p><em>&#8592;</em><em>&#8594;</em>seek</p>            <p><em>&nbsp;. </em>seek to previous            </p><p><em>1</em><em>2</em>&hellip; <em>6</em> seek to 10%, 20% &hellip; 60% </p>         </div>      </div>   ');
a.conf.tooltip&&d(".fp-ui",b).attr("title","Hit ? for help").on("mouseout.tip",function(){d(this).removeAttr("title").off("mouseout.tip")});d(".fp-close",b).click(function(){b.toggleClass("is-help")})}});var F,H=d.browser.mozilla?"moz":"webkit",u=flowplayer.support.fullscreen,D=("function"==typeof document.exitFullscreen,navigator.userAgent.toLowerCase()),A=/(safari)[ \/]([\w.]+)/.exec(D)&&!/(chrome)[ \/]([\w.]+)/.exec(D);d(document).bind("fullscreenchange webkitfullscreenchange mozfullscreenchange MSFullscreenChange",
function(a){a=d(document.webkitCurrentFullScreenElement||document.mozFullScreenElement||document.fullscreenElement||document.msFullscreenElement||a.target);a.length&&!F?F=a.trigger("fullscreen",[a]):(F.trigger("fullscreen-exit",[F]),F=null)});flowplayer(function(a,b){if(a.conf.fullscreen){var e,c=d(window),g={apply:!1,pos:0,play:!1};a.isFullscreen=!1;a.fullscreen=function(f){if(!a.disabled){if(void 0===f&&(f=!a.isFullscreen),f&&(e=c.scrollTop()),"webkit"!=H&&!A||"flash"!=a.engine||(g={apply:!0,pos:a.video.time,
play:a.playing}),u)if(f){var h=b[0];d.each(["requestFullScreen","webkitRequestFullScreen","mozRequestFullScreen","msRequestFullscreen"],function(a,b){return"function"==typeof h[b]?(h[b](Element.ALLOW_KEYBOARD_INPUT),!A||document.webkitCurrentFullScreenElement||document.mozFullScreenElement||h[b](),!1):void 0})}else d.each(["exitFullscreen","webkitCancelFullScreen","mozCancelFullScreen","msExitFullscreen"],function(a,b){return"function"==typeof document[b]?(document[b](),!1):void 0});else a.trigger(f?
"fullscreen":"fullscreen-exit",[a]);return a}};var f;b.bind("mousedown.fs",function(){150>+new Date-f&&a.ready&&a.fullscreen();f=+new Date});a.bind("fullscreen",function(){b.addClass("is-fullscreen");a.isFullscreen=!0}).bind("fullscreen-exit",function(){var g;u||"html5"!==a.engine||(g=b.css("opacity")||"",b.css("opacity",0));b.removeClass("is-fullscreen");u||"html5"!==a.engine||setTimeout(function(){b.css("opacity",g)});a.isFullscreen=!1;c.scrollTop(e)}).bind("ready",function(){if(g.apply){var b=
function(){g.play||a.conf.live?a.resume():a.pause();d.extend(g,{pos:0,play:!1})};a.conf.live?b():a.conf.rtmp&&g.pos&&!isNaN(g.pos)?(a.resume(),a.seek(g.pos,b)):b()}})}});flowplayer(function(a,b){var e=d.extend({active:"is-active",advance:!0,query:".fp-playlist a"},a.conf),c=e.active;a.play=function(b){return void 0===b?a.resume():"number"!=typeof b||a.conf.playlist[b]?("number"!=typeof b&&a.load.apply(null,arguments),a.unbind("resume.fromfirst"),a.video.index=b,a.load("string"==typeof a.conf.playlist[b]?
""+a.conf.playlist[b]:d.map(a.conf.playlist[b],function(a){return d.extend({},a)})),a):a};a.next=function(b){b&&b.preventDefault();b=a.video.index;return-1!=b&&(b=b===a.conf.playlist.length-1?0:b+1,a.play(b)),a};a.prev=function(b){b&&b.preventDefault();b=a.video.index;return-1!=b&&(b=0===b?a.conf.playlist.length-1:b-1,a.play(b)),a};d(".fp-next",b).click(a.next);d(".fp-prev",b).click(a.prev);e.advance&&b.unbind("finish.pl").bind("finish.pl",function(a,c){var g=0<=c.video.index?c.video.index+1:void 0;
c.conf.playlist.length>g||e.loop?(g=g===c.conf.playlist.length?0:g,b.removeClass("is-finished"),setTimeout(function(){c.play(g)})):(b.addClass("is-playing"),1<c.conf.playlist.length&&c.one("resume.fromfirst",function(){return c.play(0),!1}))});var g=!1;if(a.conf.playlist.length){var g=!0,f=b.find(".fp-playlist");if(!f.length){var f=d('<div class="fp-playlist"></div>'),h=d(".fp-next,.fp-prev",b);h.length?h.eq(0).before(f):d("video",b).after(f)}f.empty();d.each(a.conf.playlist,function(a,b){var e;if("string"==
typeof b)e=b;else for(var c in b[0])if(b[0].hasOwnProperty(c)){e=b[0][c];break}f.append(d("<a />").attr({href:e,"data-index":a}))})}if(d(e.query,b).length){g||(a.conf.playlist=[],d(e.query,b).each(function(){var b=d(this).attr("href");d(this).attr("data-index",a.conf.playlist.length);a.conf.playlist.push(b)}));b.on("click",e.query,function(b){b.preventDefault();b=d(b.target).closest(e.query);b=Number(b.attr("data-index"));-1!=b&&a.play(b)});var n=d(e.query,b).filter("[data-cuepoints]").length;a.bind("load",
function(g,f,h){g=d(e.query+"."+c,b).removeClass(c).attr("data-index");var k=h.index=a.video.index||0,q=d('a[data-index="'+k+'"]',b).addClass(c),t=k==a.conf.playlist.length-1;b.removeClass("video"+g).addClass("video"+k).toggleClass("last-video",t);h.index=f.video.index=k;h.is_last=f.video.is_last=t;n&&(a.cuepoints=q.data("cuepoints"))}).bind("unload.pl",function(){d(e.query+"."+c,b).toggleClass(c)})}a.conf.playlist.length&&(a.conf.loop=!1)});var J=/ ?cue\d+ ?/;flowplayer(function(a,b){function e(a){b[0].className=
b[0].className.replace(J," ");0<=a&&b.addClass("cue"+a)}var c=0;a.cuepoints=a.conf.cuepoints||[];a.bind("progress",function(g,f,h){if(c&&0.015>h-c)return c=h;c=h;f=a.cuepoints||[];for(var d=0;f.length>d;d++)g=f[d],isNaN(g)||(g={time:g}),0>g.time&&(g.time=a.video.duration+g.time),g.index=d,Math.abs(g.time-h)<0.125*a.currentSpeed&&(e(d),b.trigger("cuepoint",[a,g]))}).bind("unload seek",e);a.conf.generate_cuepoints&&a.bind("load",function(){d(".fp-cuepoint",b).remove()}).bind("ready",function(){var e=
a.cuepoints||[],c=a.video.duration,g=d(".fp-timeline",b).css("overflow","visible");d.each(e,function(b,e){var f=e.time||e;0>f&&(f=c+e);d("<a/>").addClass("fp-cuepoint fp-cuepoint"+b).css("left",100*(f/c)+"%").appendTo(g).mousedown(function(){return a.seek(f),!1})})})});flowplayer(function(a,b){function e(a){a=a.split(":");return 2==a.length&&a.unshift(0),3600*a[0]+60*a[1]+parseFloat(a[2].replace(",","."))}var c=d("track",b),g=a.conf;if(flowplayer.support.subtitles&&(a.subtitles=c.length&&c[0].track,
g.nativesubtitles&&"html5"==g.engine)){if(!a.subtitles)return;var f=function(a){var e=d("video",b)[0].textTracks;e.length&&(e[0].mode=a)};return f("disabled"),a.one("ready",function(){a.conf.splash&&d("video.fp-engine",b).append(d("<track />").attr({kind:"subtitles",srclang:a.subtitles.language||"en",label:a.subtitles.language||"en",src:c.attr("src"),"default":"default"}));f("disabled");f("showing")}),void 0}c.remove();var h=/^(([0-9]{2}:){1,2}[0-9]{2}[,.][0-9]{3}) --\> (([0-9]{2}:){1,2}[0-9]{2}[,.][0-9]{3})(.*)/;
a.subtitles=[];var n=c.attr("src");if(n){setTimeout(function(){d.get(n,function(b){var c,g,f=0,n=b.split("\n"),k=n.length;for(g={};k>f;f++)if(c=h.exec(n[f])){b=n[f-1];for(g="<p>"+n[++f]+"</p><br/>";d.trim(n[++f])&&n.length>f;)g+="<p>"+n[f]+"</p><br/>";g={title:b,startTime:e(c[1]),endTime:e(c[3]),text:g};c={time:g.startTime,subtitle:g};a.subtitles.push(g);a.cuepoints.push(c);a.cuepoints.push({time:g.endTime,subtitleEnd:b});0===g.startTime&&a.trigger("cuepoint",c)}}).fail(function(){return a.trigger("error",
{code:8,url:n}),!1})});var k,q=d("<div class='fp-subtitle'/>").appendTo(b);a.bind("cuepoint",function(a,b,e){e.subtitle?(k=e.index,q.html(e.subtitle.text).addClass("fp-active")):e.subtitleEnd&&(q.removeClass("fp-active"),k=e.index)}).bind("seek",function(b,e,c){k&&a.cuepoints[k]&&a.cuepoints[k].time>c&&(q.removeClass("fp-active"),k=null);d.each(a.cuepoints||[],function(b,e){var g=e.subtitle;g&&k!=e.index?c>=e.time&&(!g.endTime||g.endTime>=c)&&a.trigger("cuepoint",e):e.subtitleEnd&&c>=e.time&&e.index==
k+1&&a.trigger("cuepoint",e)})})}});flowplayer(function(a,b){function e(){if(g&&"undefined"!=typeof _gat){var f=_gat._getTracker(c),h=a.video;f._setAllowLinker(!0);f._trackEvent("Video / Seconds played",a.engine+"/"+h.type,b.attr("title")||h.src.split("/").slice(-1)[0].replace(C,""),Math.round(g/1E3));g=0}}var c=a.conf.analytics,g=0,f=0;c&&("undefined"==typeof _gat&&d.getScript("//google-analytics.com/ga.js"),a.bind("load unload",e).bind("progress",function(){a.seeking||(g+=f?+new Date-f:0,f=+new Date)}).bind("pause",
function(){f=0}),d(window).unload(e))});var K=/IEMobile/.test(r);(flowplayer.support.touch||K)&&flowplayer(function(a,b){var e=/Android/.test(r)&&!/Firefox/.test(r)&&!/Opera/.test(r),c=/Silk/.test(r),g=e?parseFloat(/Android\ (\d\.\d)/.exec(r)[1],10):0;if(e){if(!/Chrome/.test(r)&&4>g){var f=a.load;a.load=function(){var b=f.apply(a,arguments);return a.trigger("ready",[a,a.video]),b}}var h,n=0,q=function(a){h=setInterval(function(){a.video.time=++n;a.trigger("progress",n)},1E3)};a.bind("ready pause unload",
function(){h&&(clearInterval(h),h=null)});a.bind("ready",function(){n=0});a.bind("resume",function(b,e){return e.live?n?q(e):(a.one("progress",function(a,b,e){0===e&&q(b)}),void 0):void 0})}flowplayer.support.volume||b.addClass("no-volume no-mute");b.addClass("is-touch");b.find(".fp-timeline").data("api").disableAnimation();flowplayer.support.inlineVideo&&!a.conf.native_fullscreen||(a.conf.nativesubtitles=!0);var t=!1;b.bind("touchmove",function(){t=!0}).bind("touchend click",function(){return t?
(t=!1,void 0):a.playing&&!b.hasClass("is-mouseover")?(b.addClass("is-mouseover").removeClass("is-mouseout"),!1):(a.paused&&b.hasClass("is-mouseout")&&!a.splash&&a.toggle(),a.paused&&K&&d("video.fp-engine",b)[0].play(),void 0)});a.conf.native_fullscreen&&"function"==typeof d("<video />")[0].webkitEnterFullScreen&&(a.fullscreen=function(){var a=d("video.fp-engine",b);a[0].webkitEnterFullScreen();a.one("webkitendfullscreen",function(){a.prop("controls",!0).prop("controls",!1)})});(e||c)&&a.bind("ready",
function(){var e=d("video.fp-engine",b);e.one("canplay",function(){e[0].play()});e[0].play();a.bind("progress.dur",function(){var c=e[0].duration;1!==c&&(a.video.duration=c,d(".fp-duration",b).html(k(c)),a.unbind("progress.dur"))})})});flowplayer(function(a,b){if(!1!==a.conf.embed){var e=a.conf,c=d(".fp-ui",b),g=d("<a/>",{"class":"fp-embed",title:"Copy to your site"}).appendTo(c),c=d("<div/>",{"class":"fp-embed-code"}).append("<label>Paste this HTML code on your site to embed.</label><textarea/>").appendTo(c),
f=d("textarea",c);a.embedCode=function(){var c=a.video,g=c.width||b.width(),f=c.height||b.height(),h=d("<div/>",{"class":"flowplayer",css:{width:g,height:f}}),n=d("<video/>").appendTo(h);d.each("origin analytics key rtmp subscribe bufferTime".split(" "),function(a,b){e.hasOwnProperty(b)&&h.attr("data-"+b,e[b])});e.logo&&h.attr("data-logo",d("<img />").attr("src",e.logo)[0].src);d.each(c.sources,function(a,b){var c=b.src;(/^https?:/.test(b.src)||"flash"===b.type)&&e.rtmp||(c=d("<img/>").attr("src",
b.src)[0].src);n.append(d("<source/>",{type:"mpegurl"!=b.type?"video/"+b.type:"application/x-mpegurl",src:c}))});c={src:"//embed.flowplayer.org/5.5.2/embed.min.js"};d.isPlainObject(e.embed)&&(c["data-swf"]=e.embed.swf,c["data-library"]=e.embed.library,c.src=e.embed.script||c.src,e.embed.skin&&(c["data-skin"]=e.embed.skin));c=d("<foo/>",c).append(h);return d("<p/>").append(c).html().replace(/<(\/?)foo/g,"<$1script")};b.fptip(".fp-embed","is-embedding");f.click(function(){this.select()});g.click(function(){f.text(a.embedCode());
f[0].focus();f[0].select()})}});d.fn.fptip=function(a,b){return this.each(function(){function e(){c.removeClass(b);d(document).unbind(".st")}var c=d(this);d(a||"a",this).click(function(a){a.preventDefault();c.toggleClass(b);c.hasClass(b)&&d(document).bind("keydown.st",function(a){27==a.which&&e()}).bind("click.st",function(a){d(a.target).parents("."+b).length||e()})})})}}(jQuery);
flowplayer(function(d,a){function c(a){var b=e("<a/>")[0];return b.href=a,b.hostname}function b(a,b){var c,g="ab.ca ac.ac ac.at ac.be ac.cn ac.il ac.in ac.jp ac.kr ac.sg ac.th ac.uk adm.br adv.br ah.cn am.br arq.br art.br arts.ro asn.au asso.fr asso.mc bc.ca bio.br biz.pl biz.tr bj.cn br.com cn.com cng.br cnt.br co.ac co.at co.de co.gl co.hk co.id co.il co.in co.jp co.kr co.mg co.ms co.nz co.th co.uk co.ve co.vi co.za com.ag com.ai com.ar com.au com.br com.cn com.co com.cy com.de com.do com.ec com.es com.fj com.fr com.gl com.gt com.hk com.hr com.hu com.kg com.ki com.lc com.mg com.mm com.ms com.mt com.mu com.mx com.my com.na com.nf com.ng com.ni com.pa com.ph com.pl com.pt com.qa com.ro com.ru com.sb com.sc com.sg com.sv com.tr com.tw com.ua com.uy com.ve com.vn cq.cn de.com de.org ecn.br edu.au edu.cn edu.hk edu.mm edu.my edu.pl edu.pt edu.qa edu.sg edu.tr eng.br ernet.in esp.br etc.br eti.br eu.com eu.int eu.lv firm.in firm.ro fm.br fot.br fst.br g12.br gb.com gb.net gd.cn gen.in go.jp go.kr go.th gov.au gov.az gov.br gov.cn gov.il gov.in gov.mm gov.my gov.qa gov.sg gov.tr gov.tw gov.uk gs.cn gv.ac gv.at gx.cn gz.cn he.cn hi.cn hk.cn hl.cn hu.com id.au idv.tw in.ua ind.br ind.in inf.br info.pl info.ro info.tr info.ve iwi.nz jl.cn jor.br js.cn k12.il k12.tr kr.com lel.br ln.cn ltd.uk maori.nz mb.ca me.uk med.br mi.th mil.br mil.uk mo.cn mod.uk muni.il nb.ca ne.jp ne.kr net.ag net.ai net.au net.br net.cn net.do net.gl net.hk net.il net.in net.kg net.ki net.lc net.mg net.mm net.mu net.ni net.nz net.pl net.ru net.sb net.sc net.sg net.th net.tr net.tw net.uk net.ve nf.ca nhs.uk nm.cn nm.kr no.com nom.br nom.ni nom.ro ns.ca nt.ca nt.ro ntr.br nx.cn odo.br off.ai on.ca or.ac or.at or.jp or.kr or.th org.ag org.ai org.au org.br org.cn org.do org.es org.gl org.hk org.in org.kg org.ki org.lc org.mg org.mm org.ms org.nf org.ni org.nz org.pl org.ro org.ru org.sb org.sc org.sg org.tr org.tw org.uk org.ve pe.ca plc.uk police.uk ppg.br presse.fr pro.br psc.br psi.br qc.ca qc.com qh.cn rec.br rec.ro res.in sa.com sc.cn sch.uk se.com se.net sh.cn sk.ca slg.br sn.cn store.ro tj.cn tm.fr tm.mc tm.ro tmp.br tur.br tv.br tv.tr tw.cn uk.com uk.net us.com uy.com vet.br waw.pl web.ve www.ro xj.cn xz.cn yk.ca yn.cn zj.cn zlg.br".split(" ");c=
b.toLowerCase();var f=c.split("."),h=f.length;2>h||/^\d+$/.test(f[h-1])?b=c:(c=f.slice(-2).join("."),b=3<=h&&0<=e.inArray(c,g)?f.slice(-3).join("."):c);g=0;for(f=b.length-1;0<=f;f--)g+=2983723987*b.charCodeAt(f);g=(""+g).substring(0,7);for(f=0;a.length>f;f++)if(g===a[f].substring(1,8))return 1}var e=jQuery,f=d.conf,g=f.swf.indexOf("flowplayer.org")&&f.e&&a.data("origin"),h=g?c(g):location.hostname,n=f.key;if("file:"==location.protocol&&(h="localhost"),d.load.ed=1,f.hostname=h,f.origin=g||location.href,
g&&a.addClass("is-embedded"),"string"==typeof n&&(n=n.split(/,\s*/)),n&&"function"==typeof b&&b(n,h))f.logo&&a.append(e("<a>",{"class":"fp-logo",href:g}).append(e("<img/>",{src:f.logo})));else{var k=e("<a/>").attr("href","http://flowplayer.org").appendTo(a);e(".fp-controls",a);var l=e('<div class="fp-context-menu"><ul><li class="copyright">&copy; 2014</li><li><a href="http://flowplayer.org">About Flowplayer</a></li><li><a href="http://flowplayer.org/license">GPL based license</a></li></ul></div>').appendTo(a);
d.bind("pause resume finish unload",function(b,c){var g=-1;c.video.src&&e.each([["org","flowplayer","drive"],["org","flowplayer","my"]],function(a,b){return g=c.video.src.indexOf("://"+b.reverse().join(".")),-1===g});/pause|resume/.test(b.type)&&"flash"!=c.engine&&4!=g&&5!=g?(k.show().css({position:"absolute",left:16,bottom:36,zIndex:99999,width:100,height:20,backgroundImage:"url("+".png logo / .net .cloudfront d32wqyuo10o653 //".split(" ").reverse().join("")+")"}),c.load.ed=k.is(":visible")&&e.contains(a[0],
l[0]),c.load.ed||c.pause()):k.hide()})}});
(function(d){function a(b){var c=a.options;b=c.parser[c.strictMode?"strict":"loose"].exec(b);for(var g={},h=14;h--;)g[c.key[h]]=b[h]||"";g[c.q.name]={};g[c.key[12]].replace(c.q.parser,function(a,b,e){b&&(g[c.q.name][b]=e)});return g}function c(){}a.options={strictMode:!1,key:"source protocol authority userInfo user password host port relative path directory file query anchor".split(" "),q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};
var b={length:0,start:function(){},end:function(){}};window.MediaError=window.MediaError||function(){function a(b,e){this.code=b||null;this.message=e||""}a.MEDIA_ERR_NONE_ACTIVE=0;a.MEDIA_ERR_ABORTED=1;a.MEDIA_ERR_NETWORK=2;a.MEDIA_ERR_DECODE=3;a.MEDIA_ERR_NONE_SUPPORTED=4;return a}();c.prototype={_util:{type:"HTML5",TIMEUPDATE_MS:200,MIN_WIDTH:300,MIN_HEIGHT:150,isAttributeSet:function(a){return"string"===typeof a||!0===a},parseUri:a},addEventListener:function(a,b,c){d.addEventListener(this._eventNamespace+
a,b,c)},removeEventListener:function(a,b,c){d.removeEventListener(this._eventNamespace+a,b,c)},dispatchEvent:function(a){var b=d.createEvent("CustomEvent");b.initCustomEvent(this._eventNamespace+a,!1,!1,{type:a,target:this.parentNode,data:null});d.dispatchEvent(b)},load:function(){},canPlayType:function(){return""},getBoundingClientRect:function(){return this.parentNode.getBoundingClientRect()},NETWORK_EMPTY:0,NETWORK_IDLE:1,NETWORK_LOADING:2,NETWORK_NO_SOURCE:3,HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,
HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4};c.prototype.constructor=c;Object.defineProperties(c.prototype,{currentSrc:{get:function(){return void 0!==this.src?this.src:""}},preload:{get:function(){return"auto"},set:function(){}},controls:{get:function(){return!0},set:function(){}},poster:{get:function(){return""},set:function(){}},crossorigin:{get:function(){return""}},played:{get:function(){return b}},seekable:{get:function(){return b}},buffered:{get:function(){return b}},defaultMuted:{get:function(){return!1}},
defaultPlaybackRate:{get:function(){return 1}}});window._MediaElementProto=c})(window.document);
(function(){window.addEventHandling=function(d){d.bind=d.on=function(a,c){if(!this._destroyed){this._listeners||(this._listeners={});var b=this._listeners;void 0===b[a]&&(b[a]=[]);b[a].push(c)}};d.unbind=d.off=function(a,c){var b;if(!this._destroyed){this._listeners||(this._listeners={});var e=this._listeners[a];if(void 0!==e)if($.isFunction(c))for(b=e.length-1;0<=b;b--)e[b]===c&&e.splice(b,1);else if("string"===typeof c)for(b=e.length-1;0<=b;b--)e[b].name===c&&e.splice(b,1)}};d.dispatchEvent=function(a){if(!this._destroyed&&
(this._listeners||(this._listeners={}),(a=this._listeners[a])&&$.isArray(a))){a=a.slice();for(var c=0,b=a.length;c<b;c++)a[c].call(this)}};d.removeAllListeners=function(){delete this._listeners}}})();
(function(d,a){function c(){q||(function(b,e){var c=a.createElement("script");c.src=("file:"===d.location.protocol?"http:":"")+b;e&&c.addEventListener("error",e);var g=a.getElementsByTagName("script")[0];g.parentNode.insertBefore(c,g)}("https://www.youtube.com/iframe_api",function(){log("Warning: failed to load YouTube iFrame API");ZAP.Reachability.YouTube=!1;ZAP.dispatchEvent("reachability:detected")}),q=!0);return l}function b(a){r.unshift(a)}function e(e,q){function l(a){I?a():0>_.indexOf(R,a)&&
R.push(a)}function r(){f("Player ready");Q=!0;var a=n.exec(B.getVideoUrl())[1],b=n.exec(p.src)[1];a!==b&&u(p.src);C()}function y(){if(!I)return p.duration;var a=p.duration,b=B.getDuration();b?a!==b&&(p.duration=b,x.dispatchEvent("durationchange")):setTimeout(y,50);return b}function G(){y()?(p.readyState||(p.readyState=x.HAVE_METADATA),x.dispatchEvent("loadedmetadata"),ia=setInterval(K,g)):setTimeout(G,50)}function v(a){var b={name:"MediaError"};switch(a.data){case 2:b.message="Invalid video parameter.";
b.code=MediaError.MEDIA_ERR_ABORTED;break;case 5:b.message="The requested content cannot be played in an HTML5 player or another error related to the HTML5 player has occurred.";b.code=MediaError.MEDIA_ERR_DECODE;break;case 100:b.message="Video not found.";b.code=MediaError.MEDIA_ERR_NETWORK;break;case 101:case 150:b.message="Video not usable.";b.code=MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED;break;default:b.message="Unknown error.",b.code=5}a=p.error;p.error=b;a&&a.code===b.code||x.dispatchEvent("error")}
function C(){f("Video cued");G();B.mute();d.isTablet||B.playVideo()}function z(){X||(X=setInterval(V,50));x.dispatchEvent("loadeddata");p.readyState=x.HAVE_FUTURE_DATA;x.dispatchEvent("canplay");p.muted||B.unMute();I=!0;for(var a=R.length;a--;)R[a]();R.length=0;p.readyState=x.HAVE_ENOUGH_DATA;x.dispatchEvent("canplaythrough")}function s(a){f("Player state change: "+a.data);var b;switch(a.data){case -1:C();break;case YT.PlayerState.ENDED:b=B.getCurrentTime();p.seeking&&k(b-S)<M&&1>k(b-p.currentTime)&&
T();aa();break;case YT.PlayerState.PLAYING:Y?(Y=!1,d.isTablet&&(p.paused=!1),p.paused?B.pauseVideo():Z(),z()):(b=B.getCurrentTime(),p.seeking&&L===p.paused&&k(b-S)<M?1>k(b-p.currentTime)&&T():Z());break;case YT.PlayerState.PAUSED:b=B.getCurrentTime();p.seeking&&k(b-S)<M?1>k(b-p.currentTime)&&T():(f("onPause()"),L||(L=!0,clearInterval(U),x.dispatchEvent("pause")));break;case YT.PlayerState.BUFFERING:p.networkState=x.NETWORK_LOADING;x.dispatchEvent("waiting");break;case YT.PlayerState.CUED:C()}a.data!==
YT.PlayerState.BUFFERING&&ga===YT.PlayerState.BUFFERING&&x.dispatchEvent("progress");ga=a.data}function F(){x.dispatchEvent("playbackqualitychange")}function H(){clearInterval(U);clearInterval(ia);clearInterval(X);clearTimeout(W);clearTimeout(la);$.each(O,function(a){delete O[a]});B&&(B.stopVideo&&B.stopVideo(),B.clearVideo&&B.clearVideo(),B.destroy&&B.destroy());N.parentNode&&N.parentNode.removeChild(N);N=a.createElement("div")}function u(a){f("Changing src to "+a);p.src=a;if(c()){var e=p.src.split("#t="),
g=0;1<e.length&&(g=parseFloat(e[e.length-1],10)||0);I=!1;Y=!0;H();N.width=p.width;N.height=p.height;ea.appendChild(N);e=x._util.parseUri(a).queryKey;delete e.v;p.autoplay="1"===e.autoplay||p.autoplay;delete e.autoplay;p.loop="1"===e.loop||p.loop;delete e.loop;e.rel=e.rel||0;e.modestbranding=e.modestbranding||1;e.iv_load_policy=e.iv_load_policy||3;e.showinfo=e.showinfo||0;var h="file:"===d.location.protocol?"*":d.location.protocol+"//"+d.location.host;e.origin=e.origin||h;e.controls=e.controls||p.controls?
2:0;p.controls=e.controls;e.wmode=e.wmode||"opaque";e.fs=e.fs||p.controls?1:0;e.start=Math.floor(g);a=n.exec(a)[1];B=new YT.Player(N,{width:p.width,height:p.height,videoId:a,playerVars:e,events:{onReady:r,onError:v,onStateChange:s,onPlaybackQualityChange:F}});B.getIframe().setAttribute("tabindex","-1");Q=!1;p.networkState=x.NETWORK_LOADING;x.dispatchEvent("loadstart");x.dispatchEvent("progress");y();p.seeking=!1;p.ended=!1;p.paused=!p.autoplay;L=!0}else b(function(){u(a)})}function A(){var a=!0;$.each(O,
function(b,e){e=O[b];"function"!==typeof B[b]?delete O[b]:B[b]()!==e.val?(x.dispatchEvent(e.evt),delete O[b]):a=!1});W=a?!1:setTimeout(A,10)}function J(a,b,e){O[a]||(O[a]={val:b,evt:e},W||(W=setTimeout(A)))}function K(){if(I){var a=B.getCurrentTime();p.seeking?k(a-S)<M&&1>k(a-p.currentTime)&&T():p.currentTime=a}}function V(){var a=B.getVideoLoadedFraction();ha!==a&&(ha=a,x.dispatchEvent("progress"),1<=a&&clearInterval(X))}function P(a){p.currentTime=a;p.seeking=!0;I?1<k(B.getCurrentTime()-p.currentTime)?
(p.seeking=!0,S=p.currentTime,M=k(B.getCurrentTime()-S),M=Math.max(M,0.25),M=Math.min(M,1),x.dispatchEvent("seeking"),B.seekTo(p.currentTime)):(B.seekTo(p.currentTime),setImmediate(T)):l(function(){P(a)})}function ka(){B.getCurrentTime()!==ja&&(ja=B.getCurrentTime(),x.dispatchEvent("timeupdate"))}function T(){p.ended&&(B.pauseVideo(),setTimeout(function(){B.pauseVideo()},100));p.seeking=!1;p.ended=!1;x.dispatchEvent("timeupdate");x.dispatchEvent("seeked");x.dispatchEvent("canplay");x.dispatchEvent("canplaythrough")}
function Z(){f("onPlay()");if(p.seeking&&p.paused)B.pauseVideo();else if(p.ended&&(P(0),p.ended=!1),clearInterval(U),U=setInterval(ka,x._util.TIMEUPDATE_MS),L){L=!1;if(p.loop&&!fa||!p.loop)fa=!0,x.dispatchEvent("play");x.dispatchEvent("playing")}}function aa(){f("onEnded()");p.loop?(P(0),x.play()):(p.seeking=!1,p.paused=!0,p.ended=!0,x.dispatchEvent("ended"),B.pauseVideo&&B.pauseVideo(),L||(L=!0,clearInterval(U),x.dispatchEvent("pause")))}function ba(a){p.volume=a;I?(J("getVolume",B.getVolume(),"volumechange"),
B.setVolume(100*p.volume)):l(function(){ba(a)})}function ca(a){p.muted=a;I?(J("isMuted",B.isMuted(),"volumechange"),B[a?"mute":"unMute"]()):l(function(){ca(a)})}function da(a){p.playbackRate=a;I?(J("setPlaybackRate",B.getPlaybackRate(),"ratechange"),B.setPlaybackRate(a)):l(function(){da(a)})}if(!d.postMessage)throw"ERROR: HTMLYouTubeVideoElement requires window.postMessage";var x=this,ea="string"===typeof e?a.querySelector(e):e,N=a.createElement("div"),p={src:h,networkState:x.NETWORK_EMPTY,readyState:x.HAVE_NOTHING,
seeking:!1,autoplay:h,preload:h,controls:!!q,loop:!1,poster:h,volume:1,muted:!1,playbackRate:1,currentTime:0,duration:NaN,ended:!1,paused:!0,width:"100%",height:"100%",error:null},Q=!1,I=!1,R=[],fa=!1,B,L=!0,ga=-1,O={},W,la,X,ha=0,S=-1,M=1,ia,U,Y=!0;x._eventNamespace="HTMLYouTubeVideoElement::"+(1E6*Math.random()).toFixed();x.parentNode=ea;x._util.type="YouTube";var ja=-1;x.play=function(){f("play()");p.paused=!1;I?0!==B.getPlayerState()||p.ended?B.playVideo():aa():l(function(){x.play()})};x.pause=
function(){f("pause()");p.paused=!0;I?0!==B.getPlayerState()&&B.pauseVideo():l(function(){x.pause()})};Object.defineProperties(x,{src:{get:function(){return p.src},set:function(a){if(a)if(R.length=0,a===p.src&&B&&Q){B.pauseVideo();I=!1;p.networkState=x.NETWORK_LOADING;x.dispatchEvent("loadstart");x.dispatchEvent("progress");p.seeking=!1;p.ended=!1;p.paused=!p.autoplay;L=!0;var b=setInterval(function(){0.25>B.getCurrentTime()&&(clearInterval(b),z())},50);B.seekTo(0)}else u(a)}},autoplay:{get:function(){return p.autoplay},
set:function(a){p.autoplay=x._util.isAttributeSet(a)}},loop:{get:function(){return p.loop},set:function(a){p.loop=x._util.isAttributeSet(a)}},width:{get:function(){return x.parentNode.offsetWidth}},height:{get:function(){return x.parentNode.offsetHeight}},currentTime:{get:function(){return p.currentTime},set:function(a){f("set currentTime = "+a);P(a)}},duration:{get:function(){return y()}},ended:{get:function(){return p.ended}},paused:{get:function(){return p.paused}},seeking:{get:function(){return p.seeking}},
readyState:{get:function(){return p.readyState}},networkState:{get:function(){return p.networkState}},volume:{get:function(){return p.volume/100},set:function(a){if(0>a||1<a)throw"Volume value must be between 0.0 and 1.0";ba(a)}},muted:{get:function(){return p.muted},set:function(a){ca(x._util.isAttributeSet(a))}},playbackRate:{get:function(){return p.playbackRate},set:function(a){da(a)}},allPlaybackRates:{get:function(){return Q&&B.getAvailablePlaybackRates()||[]}},error:{get:function(){return p.error}},
buffered:{get:function(){var a={start:function(a){if(0===a)return 0;throw"INDEX_SIZE_ERR: DOM Exception 1";},end:function(a){if(0===a)return a=y(),I&&a?a*B.getVideoLoadedFraction():0;throw"INDEX_SIZE_ERR: DOM Exception 1";}};Object.defineProperties(a,{length:{get:function(){return 1}}});return a}}});x._util.getPlaybackQuality=function(){return Q&&B.getPlaybackQuality()||p.quality||"default"};x._util.setPlaybackQuality=function(a){p.quality=a;I?B.setPlaybackQuality(a):l(function(){x._util.setPlaybackQuality(a)})};
x._util.getAvailableQualityLevels=function(){return Q&&B.getAvailableQualityLevels()||[]}}var f=d.debug("player:HTMLYouTubeVideoElement"),g=10,h="",n=/^.*(?:\/|v=)(.{11})/,k=Math.abs,l=!1,q=!1,r=[];d.YT&&(d.quarantineYT=d.YT,d.YT=null);d.onYouTubeIframeAPIReady=function(){f("YouTube API ready");d.onYouTubeIframeAPIReady.isReady=l=!0;ZAP.Reachability.YouTube=!0;for(var a=r.length;a--;)r[a]();r.length=0};e.prototype=new _MediaElementProto;e.prototype.constructor=e;d.HTMLYouTubeVideoElement=function(a,
b){return new e(a,b)};d.HTMLYouTubeVideoElement._preloadYouTubeAPI=function(){c()}})(window,document);
(function(d,a){function c(a){return a.origin==="http://"+g||a.origin==="https://"+g}function b(a){var b=this,e=a.src.split("?")[0],e="https://"+e.split("//")[1];"play pause paused seekTo unload getCurrentTime getDuration getVideoEmbedCode getVideoHeight getVideoWidth getVideoUrl getColor setColor setLoop getVolume setVolume addEventListener".split(" ").forEach(function(c){b[c]=function(b){b=JSON.stringify({method:c,value:b});a.contentWindow&&a.contentWindow.postMessage(b,e)}})}function e(e,g){function l(a){A.unshift(a)}
function q(a){var b=s.duration;if(b!==a&&(s.duration=a,0!==a&&v.dispatchEvent("durationchange"),isNaN(b)))for(s.networkState=v.NETWORK_IDLE,s.readyState=v.HAVE_METADATA,v.dispatchEvent("loadedmetadata"),v.dispatchEvent("loadeddata"),s.readyState=v.HAVE_FUTURE_DATA,v.dispatchEvent("canplay"),s.readyState=v.HAVE_ENOUGH_DATA,v.dispatchEvent("canplaythrough"),a=A.length;a--;)A[a](),delete A[a]}function r(a){F?(s.seeking=!0,v.dispatchEvent("seeking"),d.isTablet&&!K?(s.currentTime=a,setImmediate(t),J=a):
u.seekTo(a)):l(function(){r(a)})}function t(){s.seeking=!1;v.dispatchEvent("timeupdate");v.dispatchEvent("seeked");v.dispatchEvent("canplay");v.dispatchEvent("canplaythrough")}function w(a){(s.currentTime=a)!==P&&v.dispatchEvent("timeupdate");P=s.currentTime}function D(a){if(c(a)){var e;if("object"===typeof a.data)e=a.data;else try{e=JSON.parse(a.data)}catch(g){console.warn(g);return}if(e.player_id===H)switch(e.event){case "ready":u=new b(z),d.removeEventListener("message",D,!1),d.addEventListener("message",
E,!1),F=!0,s.autoplay&&v.play(),u.addEventListener("loadProgress"),u.addEventListener("playProgress"),u.addEventListener("play"),u.addEventListener("pause"),u.addEventListener("finish"),u.addEventListener("seek"),u.getDuration(),s.networkState=v.NETWORK_LOADING,v.dispatchEvent("loadstart"),v.dispatchEvent("progress")}}}function E(a){if(c(a)){var b;if("object"===typeof a.data)b=a.data;else try{b=JSON.parse(a.data)}catch(e){console.warn(e);return}if(b.player_id===H){switch(b.method){case "getDuration":q(parseFloat(b.value));
break;case "getVolume":a=parseFloat(b.value),s.volume!==a&&(s.volume=a,v.dispatchEvent("volumechange"))}switch(b.event){case "loadProgress":v.dispatchEvent("progress");q(parseFloat(b.data.duration));break;case "playProgress":w(parseFloat(b.data.seconds));break;case "play":s.paused&&!d.isTablet&&u.pause();s.ended&&r(0);d.isTablet&&!V&&(V=K=!0,1<=J&&u.seekTo(J));s.loop||v.dispatchEvent("play");v.dispatchEvent("playing");break;case "pause":s.paused||d.isTablet||u.play();v.dispatchEvent("pause");break;
case "finish":s.loop?(r(0),v.play()):(s.ended=!0,v.dispatchEvent("ended"));break;case "seek":w(parseFloat(b.data.seconds)),t()}}}}function y(a){s.volume=a;F?(u.setVolume(a),v.dispatchEvent("volumechange")):l(function(){y(a)})}function G(a){F?a?(s.muted=s.volume,y(0)):(y(s.muted?s.muted:1),s.muted=0):(s.muted=a?1:0,l(function(){G(a)}))}if(!d.postMessage)throw"ERROR: HTMLVimeoVideoElement requires window.postMessage";var v=this,C="string"===typeof e?a.getElementById(e):e,z=a.createElement("iframe"),
s={src:f,networkState:v.NETWORK_EMPTY,readyState:v.HAVE_NOTHING,seeking:!1,autoplay:f,preload:f,controls:!!g,loop:!1,poster:f,volume:1,muted:0,currentTime:0,duration:NaN,ended:!1,paused:!0,error:null},F=!1,H="HTMLVimeoVideoElement::"+(1E6*Math.random()).toFixed(),u,A=[],J=0,K=!1,V=!1,P=0;v._eventNamespace="HTMLVimeoVideoElement::"+(1E6*Math.random()).toFixed();v.parentNode=C;v._util.type="Vimeo";v.play=function(){s.paused=!1;F?(K=!0,d.isTablet&&!K&&u.seekTo(J),u.play()):l(function(){v.play()})};v.pause=
function(){s.paused=!0;F?u.pause():l(function(){v.pause()})};Object.defineProperties(v,{src:{get:function(){return s.src},set:function(b){if(b&&b!==s.src)if(v._canPlaySrc(b)){s.src=b;F&&F&&u&&(u.pause(),d.removeEventListener("message",E,!1),C.removeChild(z),z=a.createElement("iframe"));F=!1;b=v._util.parseUri(b);var e=b.queryKey,c,g=["api=1","player_id="+H,"title=0","byline=0","portrait=0"];s.loop="1"===e.loop||s.loop;delete e.loop;s.autoplay="1"===e.autoplay||s.autoplay;delete e.autoplay;b=h+"/video/"+
/\d+$/.exec(b.path)+"?";for(c in e)e.hasOwnProperty(c)&&g.push(encodeURIComponent(c)+"="+encodeURIComponent(e[c]));b+=g.join("&");z.id=H;z.style.width="100%";z.style.height="100%";z.frameBorder=0;z.webkitAllowFullScreen=!0;z.mozAllowFullScreen=!0;z.allowFullScreen=!0;C.appendChild(z);z.src=b;d.addEventListener("message",D,!1)}else s.error={name:"MediaError",message:"Media Source Not Supported",code:MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED},v.dispatchEvent("error")}},autoplay:{get:function(){return s.autoplay},
set:function(a){s.autoplay=v._util.isAttributeSet(a)}},loop:{get:function(){return s.loop},set:function(a){s.loop=v._util.isAttributeSet(a)}},width:{get:function(){return v.parentNode.offsetWidth}},height:{get:function(){return v.parentNode.offsetHeight}},currentTime:{get:function(){return s.currentTime},set:function(a){r(a)}},duration:{get:function(){return s.duration}},ended:{get:function(){return s.ended}},paused:{get:function(){return s.paused}},seeking:{get:function(){return s.seeking}},readyState:{get:function(){return s.readyState}},
networkState:{get:function(){return s.networkState}},volume:{get:function(){return 0<s.muted?s.muted:s.volume},set:function(a){if(0>a||1<a)throw"Volume value must be between 0.0 and 1.0";y(a)}},muted:{get:function(){return 0<s.muted},set:function(a){G(v._util.isAttributeSet(a))}},error:{get:function(){return s.error}}})}var f="",g="player.vimeo.com",h=d.location.protocol+"//"+g;e.prototype=new _MediaElementProto;e.prototype.constructor=e;e.prototype._canPlaySrc=function(a){return/player.vimeo.com\/video\/\d+/.test(a)||
/vimeo.com\/\d+/.test(a)?"probably":f};e.prototype.canPlayType=function(a){return"video/x-vimeo"===a?"probably":f};d.HTMLVimeoVideoElement=function(a,b){return new e(a,b)}})(window,document);
window.ZPYTPlayer=function(d,a,c){var b=this;b.type=b.engine="YouTube";b.id=a._zpId+"-"+(1E6*Math.random()).toFixed()+"-youtube";b.el=d;b.clip=a;b.isEnded=!1;b.ended=function(){return b.isEnded};b.el.append($('<div class="zaption-player" id="'+b.id+'"></div>'));b.playerEl=$("#"+b.id);b.mediaReady=!1;b.mediaReadyCallbacks=[];b.media=new HTMLYouTubeVideoElement(b.playerEl[0],c);b.media.addEventListener("ended",function(){b.isEnded=!0;b.dispatchEvent("ended")});b.media.addEventListener("play",function(){b.dispatchEvent("play")});
b.media.addEventListener("pause",function(){b.dispatchEvent("pause")});b.media.addEventListener("seeking",function(){b.mediaReady&&b.dispatchEvent("seeking")});b.media.addEventListener("seeked",function(){if(b.mediaReady)b.dispatchEvent("seeked");else b.onMediaReady()});b.media.addEventListener("durationchange",function(){var a=b.media.duration;0!==a&&(window.isAndroid||(b.clip.videoDuration()!==a&&b.clip.videoDuration(a),0>b.clip.inTime()&&b.clip.inTime(0),b.clip.outTime()>a&&b.clip.outTime(a)),
b.isEnded=!1,b.dispatchEvent("durationchange"))});b.media.addEventListener("volumechange",function(){b.dispatchEvent("volumechange")});b.media.addEventListener("ratechange",function(){b.dispatchEvent("ratechange")});b.media.addEventListener("playing",function(){b.dispatchEvent("playing")});b.media.addEventListener("progress",function(){b.dispatchEvent("progress")});b.media.addEventListener("loadedmetadata",function(){b.dispatchEvent("loadedmetadata")});b.media.addEventListener("loadstart",function(){b.dispatchEvent("loadstart")});
b.media.addEventListener("loadeddata",function(){b._loadedData=!0;b.dispatchEvent("loadeddata")});b.media.addEventListener("canplay",function(){b.dispatchEvent("canplay")});b.media.addEventListener("canplaythrough",function(){b.dispatchEvent("canplaythrough")});b.media.addEventListener("error",function(){log("YouTube playback error: "+b.media.error.message);window.trackJs&&window.trackJs.track(Error("YouTube playback error: "+b.media.error.message));b.media.error.code===MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED&&
(ZAP.Reachability.YouTube=!1,ZAP.dispatchEvent("reachability:detected"));b.dispatchEvent("error")});b.media.addEventListener("timeupdate",function(){b._loadedData&&(b.getPosition()>=b.getDuration()?(b.isEnded=!0,b.pause(),b.dispatchEvent("ended")):b.dispatchEvent("timeupdate"))});b.load(a);return b};ZPYTPlayer.prototype.addMediaReadyCallback=function(d){this.mediaReady?d():0>_.indexOf(this.mediaReadyCallbacks,d)&&this.mediaReadyCallbacks.unshift(d)};
ZPYTPlayer.prototype.onMediaReady=function(){this.mediaReady=!0;for(var d=this.mediaReadyCallbacks.length;d--;)this.mediaReadyCallbacks[d]();this.mediaReadyCallbacks.length=0};ZPYTPlayer.prototype.destroy=function(){this._destroyed=!0;this.removeAllListeners();$("#"+this.id).remove();this.media=null};
ZPYTPlayer.prototype.load=function(d){if(d){this.clip=d;this.isEnded=!1;switch(d.videoType()){case "YouTube":this.media.src="//www.youtube.com/v/"+d.videoLocation()+"#t="+d.inTime()}this.mediaReady=this._loadedData=!1;this.media.currentTime=d.inTime()}};ZPYTPlayer.prototype.play=function(){var d=this;if(d.media){if(d.mediaReady)return d.isEnded=!1,d.media.play();d.addMediaReadyCallback(function(){d.play()})}};
ZPYTPlayer.prototype.pause=function(){var d=this;if(d.media){if(d.mediaReady)return d.media.pause();d.addMediaReadyCallback(function(){d.pause()})}};ZPYTPlayer.prototype.seek=function(d){var a=this;a.media&&(a.mediaReady?(a.isEnded=!1,a.media.currentTime=d+a.clip.inTime()):a.addMediaReadyCallback(function(){a.seek(d)}))};ZPYTPlayer.prototype.getState=function(){return this.media?this.media.paused?"PAUSED":"PLAYING":"UNLOADED"};ZPYTPlayer.prototype.ended=function(){return this.isEnded};
ZPYTPlayer.prototype.getPropBuffered=function(){if(!this.media)return 0;for(var d=this.media.buffered,a=this.getDuration(),c=0,b=0;b<d.length;b++){var e=Math.max(this.clip.inTime(),d.start(b)),f=Math.min(this.clip.outTime(),d.end(b));if(f<=e)return;c+=f-e}return c/a};ZPYTPlayer.prototype.getPosition=function(){if(!this.media)return 0;var d=this.media.currentTime-this.clip.inTime();if(0>d||isNaN(d))d=0;return d};ZPYTPlayer.prototype.getDuration=function(){return this.clip.outTime()-this.clip.inTime()};
ZPYTPlayer.prototype.getVolume=function(){return this.media?this.media.volume:0};ZPYTPlayer.prototype.setVolume=function(d){var a=this;if(a.media){if(a.mediaReady)return a.media.volume=d,a.media.volume;a.addMediaReadyCallback(function(){a.setVolume(d)})}};ZPYTPlayer.prototype.getMute=function(){return this.media?this.media.muted:!1};ZPYTPlayer.prototype.setMute=function(d){var a=this;a.media&&(a.mediaReady?a.media.muted=d:a.addMediaReadyCallback(function(){a.setMute(d)}))};
ZPYTPlayer.prototype.getPlaybackRate=function(){return this.media?this.media.playbackRate:!1};ZPYTPlayer.prototype.setPlaybackRate=function(d){var a=this;a.media&&(a.mediaReady?a.media.playbackRate=d:a.addMediaReadyCallback(function(){a.setPlaybackRate(d)}))};ZPYTPlayer.prototype.getAvailablePlaybackRates=function(){return this.media?this.media.allPlaybackRates:!1};window.addEventHandling(ZPYTPlayer.prototype);
window.ZPVimeoPlayer=function(d,a,c){var b=this;b.type=b.engine="Vimeo";b.id=a._zpId+"-"+(1E6*Math.random()).toFixed()+"-vimeo";b.el=d;b.clip=a;b.isEnded=!1;b.ended=function(){return b.isEnded};b.el.append($('<div class="zaption-player" style="width: 100%; height: 100%;" id="'+b.id+'"></div>'));b.playerEl=$("#"+b.id);b.mediaReady=!1;b.mediaReadyCallbacks=[];b.media=new HTMLVimeoVideoElement(b.playerEl[0],c);b.media.addEventListener("ended",function(){b.isEnded=!0;b.dispatchEvent("ended")});b.media.addEventListener("play",
function(){b.dispatchEvent("play")});b.media.addEventListener("pause",function(){b.dispatchEvent("pause")});b.media.addEventListener("seeking",function(){b.mediaReady&&b.dispatchEvent("seeking")});b.media.addEventListener("seeked",function(){if(b.mediaReady)b.dispatchEvent("seeked");else b.onMediaReady()});b.media.addEventListener("durationchange",function(){var a=b.media.duration;0!==a&&(b.clip.videoDuration()!==a&&b.clip.videoDuration(a),0>b.clip.inTime()&&b.clip.inTime(0),b.clip.outTime()>a&&b.clip.outTime(a),
b.isEnded=!1,b.dispatchEvent("durationchange"))});b.media.addEventListener("volumechange",function(){b.dispatchEvent("volumechange")});b.media.addEventListener("playing",function(){b.mediaReady&&b.dispatchEvent("playing")});b.media.addEventListener("progress",function(){b.dispatchEvent("progress")});b.media.addEventListener("loadedmetadata",function(){b.dispatchEvent("loadedmetadata")});b.media.addEventListener("loadstart",function(){b.dispatchEvent("loadstart")});b.media.addEventListener("loadeddata",
function(){b.dispatchEvent("loadeddata")});b.media.addEventListener("canplay",function(){b.dispatchEvent("canplay")});b.media.addEventListener("canplaythrough",function(){b.dispatchEvent("canplaythrough")});b.media.addEventListener("error",function(){log("Vimeo error:"+b.media.error.message);b.dispatchEvent("error")});b.media.addEventListener("timeupdate",function(){b.getPosition()>=b.getDuration()?(b.isEnded=!0,b.pause(),b.dispatchEvent("ended")):b.dispatchEvent("timeupdate")});b.load(a);return b};
ZPVimeoPlayer.prototype.addMediaReadyCallback=function(d){this.mediaReady?d():0>_.indexOf(this.mediaReadyCallbacks,d)&&this.mediaReadyCallbacks.unshift(d)};ZPVimeoPlayer.prototype.onMediaReady=function(){this.mediaReady=!0;for(var d=this.mediaReadyCallbacks.length;d--;)this.mediaReadyCallbacks[d]();this.mediaReadyCallbacks.length=0;this.media.paused&&this.dispatchEvent("pause")};
ZPVimeoPlayer.prototype.destroy=function(){this._destroyed=!0;this.removeAllListeners();$("#"+this.id).remove();this.media=null};ZPVimeoPlayer.prototype.load=function(d){if(d){this.clip=d;this.isEnded=!1;switch(d.videoType()){case "Vimeo":this.media.src="//player.vimeo.com/video/"+d.videoLocation()}this.mediaReady=!1;this.media.currentTime=d.inTime()}};ZPVimeoPlayer.prototype.play=function(){var d=this;if(d.media){if(d.mediaReady)return d.isEnded=!1,d.media.play();d.addMediaReadyCallback(function(){d.play()})}};
ZPVimeoPlayer.prototype.pause=function(){var d=this;if(d.media){if(d.mediaReady)return d.media.pause();d.addMediaReadyCallback(function(){d.pause()})}};ZPVimeoPlayer.prototype.seek=function(d){var a=this;if(a.media)if(a.mediaReady){a.isEnded=!1;var c=a.media.duration,b=d+a.clip.inTime();b>=c&&(b=c-0.005);a.media.currentTime=b}else a.addMediaReadyCallback(function(){a.seek(d)})};ZPVimeoPlayer.prototype.getState=function(){return this.media?this.media.paused?"PAUSED":"PLAYING":"UNLOADED"};
ZPVimeoPlayer.prototype.ended=function(){return this.isEnded};ZPVimeoPlayer.prototype.getPropBuffered=function(){if(!this.media)return 0;for(var d=this.media.buffered,a=this.getDuration(),c=0,b=0;b<d.length;b++){var e=Math.max(this.clip.inTime(),d.start(b)),f=Math.min(this.clip.outTime(),d.end(b));if(f<=e)return;c+=f-e}return c/a};ZPVimeoPlayer.prototype.getPosition=function(){if(!this.media)return 0;var d=this.media.currentTime-this.clip.inTime();if(0>d||isNaN(d))d=0;return d};
ZPVimeoPlayer.prototype.getDuration=function(){return this.clip.outTime()-this.clip.inTime()};ZPVimeoPlayer.prototype.getVolume=function(){return this.media?this.media.volume:0};ZPVimeoPlayer.prototype.setVolume=function(d){var a=this;if(a.media){if(a.mediaReady)return a.media.volume=d,a.media.volume;a.addMediaReadyCallback(function(){a.setVolume(d)})}};ZPVimeoPlayer.prototype.getMute=function(){return this.media?this.media.muted:!1};
ZPVimeoPlayer.prototype.setMute=function(d){var a=this;a.media&&(a.mediaReady?a.media.muted=d:a.addMediaReadyCallback(function(){a.setMute(d)}))};window.addEventHandling(ZPVimeoPlayer.prototype);
window.ZPHTML5Player=function(d,a,c){var b=this;b.type=b.engine="HTML5";b.id=a._zpId+"-"+(1E6*Math.random()).toFixed()+"-html5";b.el=d;b.clip=a;b.isEnded=!1;b.ended=function(){return b.isEnded};b.el.append($('<div class="zaption-player" id="'+b.id+'"></div>'));b.playerEl=$("#"+b.id);b.mediaReady=!1;b.onReadyState={seekTarget:0,paused:!0,volume:1,playbackRate:1,muted:!1};b.media=document.createElement("video");b.media.style.height="100%";b.media.style.width="100%";b.media.preload="auto";if(c||window.isTablet)b.media.controls=
"controls";b.playerEl[0].appendChild(b.media);b.media.addEventListener("ended",function(){if(!b.media||b.media.ended)b.isEnded=!0,b.dispatchEvent("ended")});b.media.addEventListener("play",function(){b.dispatchEvent("play")});b.media.addEventListener("pause",function(){b.dispatchEvent("pause")});b.media.addEventListener("seeking",function(){b.dispatchEvent("seeking")});b.media.addEventListener("seeked",function(){if(b.mediaReady)b.dispatchEvent("seeked");else b.onMediaReady()});b.media.addEventListener("durationchange",
function(){var a=b.media.duration;0===a||window.isAndroid&&100===a||(b.clip.videoDuration()!==a&&b.clip.videoDuration(a),0>b.clip.inTime()&&b.clip.inTime(0),b.clip.outTime()>a&&b.clip.outTime(a),window.isAndroid&&(b.media.currentTime-1<b.clip.inTime()||b.media.currentTime-1>b.clip.inTime())&&(b.media.currentTime=b.clip.inTime()),b.isEnded=!1,b.dispatchEvent("durationchange"))});b.media.addEventListener("volumechange",function(){b.dispatchEvent("volumechange")});b.media.addEventListener("playing",
function(){b.dispatchEvent("playing")});b.media.addEventListener("progress",function(){b.dispatchEvent("progress")});b.media.addEventListener("loadedmetadata",function(){b.mediaReady||(b.media.currentTime=b.clip.inTime());b.dispatchEvent("loadedmetadata")});b.media.addEventListener("loadstart",function(){b.dispatchEvent("loadstart")});b.media.addEventListener("loadeddata",function(){b.dispatchEvent("loadeddata")});b.media.addEventListener("canplay",function(){b.dispatchEvent("canplay")});b.media.addEventListener("canplaythrough",
function(){b.dispatchEvent("canplaythrough")});b.media.addEventListener("error",function(){b.dispatchEvent("error")});b.media.addEventListener("timeupdate",function(){b.getPosition()>=b.getDuration()?(b.isEnded=!0,b.pause(),b.dispatchEvent("ended")):b.dispatchEvent("timeupdate")});b.load(a);return b};
ZPHTML5Player.prototype.onMediaReady=function(){this.mediaReady=!0;this.setVolume(this.onReadyState.volume);this.setMute(this.onReadyState.muted);this.seek(this.onReadyState.seekTarget);this.onReadyState.paused?this.pause():this.play()};
ZPHTML5Player.prototype.destroy=function(){this._destroyed=!0;this.removeAllListeners();this.mediaReady=!1;$(this.media).find("source").each(function(){this.src="";delete this.src;$(this).remove()});this.media.pause();this.media.src="";this.media.load();this.media.removeAttribute("src");$(this.media).remove();delete this.media;$("#"+this.id).remove();this.media=null};
ZPHTML5Player.prototype.load=function(d){if(d){this.clip=d;this.isEnded=!1;this.media.pause();$(this.media).find("source").each(function(){this.src="";delete this.src;$(this).remove()});this.media.src="";this.media.load();this.media.removeAttribute("src");ZAP.ui.removeMessage(".application-container");switch(this.clip.videoType()){case "S3":$(this.media).append('<source type="video/mp4" src="//s3.amazonaws.com/zaption-users/videos/'+this.clip.videoLocation()+'.mp4"></source>');break;case "standalone":$(this.media).append('<source type="video/mp4" src="/userVideos/'+
this.clip.videoLocation()+'.mp4"></source>');break;case "MP4URL":$(this.media).append('<source type="video/mp4" src="'+this.clip.videoLocation()+'"></source>');break;case "YouTube":$(this.media).append('<source type="video/mp4" src="//zap.systems/stream?videoId='+this.clip.videoLocation()+'&width=1280&height=720"></source>')}$(this.media).find("source")[0].addEventListener("error",function(){ZAP.ui.appendMessage("There was an error loading the video. It may be private or removed by its owner.",".application-container",
"error")},!0);this.media.load();this.mediaReady=!1;this.onReadyState={seekTarget:0,paused:!0,volume:this.media.volume,muted:this.media.muted};this.media.readyState&&(this.media.currentTime=this.clip.inTime())}};ZPHTML5Player.prototype.play=function(){if(this.mediaReady)return this.isEnded=!1,this.media.play();this.onReadyState.paused=!1};ZPHTML5Player.prototype.pause=function(){if(this.mediaReady)return this.media.pause();this.onReadyState.paused=!0};
ZPHTML5Player.prototype.seek=function(d){this.mediaReady?(this.isEnded=!1,this.media.currentTime=d+this.clip.inTime()):this.onReadyState.seekTarget=d};ZPHTML5Player.prototype.getState=function(){return this.mediaReady?this.media.paused?"PAUSED":"PLAYING":"UNLOADED"};ZPHTML5Player.prototype.ended=function(){return this.isEnded};
ZPHTML5Player.prototype.getPropBuffered=function(){if(!this.mediaReady)return 0;for(var d=this.media.buffered,a=this.getDuration(),c=0,b=0;b<d.length;b++){var e=Math.max(this.clip.inTime(),d.start(b)),f=Math.min(this.clip.outTime(),d.end(b));if(f<=e)return;c+=f-e}return c/a};ZPHTML5Player.prototype.getPosition=function(){if(!this.mediaReady)return this.onReadyState.seekTarget;var d=this.media.currentTime-this.clip.inTime();if(0>d||isNaN(d))d=0;return d};
ZPHTML5Player.prototype.getDuration=function(){return this.clip.outTime()-this.clip.inTime()};ZPHTML5Player.prototype.getVolume=function(){return this.mediaReady?this.media.volume:this.onReadyState.volume};ZPHTML5Player.prototype.setVolume=function(d){if(this.mediaReady)return this.media.volume=d,this.media.volume;this.onReadyState.volume=d};ZPHTML5Player.prototype.getMute=function(){return this.mediaReady?this.media.muted:this.onReadyState.muted};
ZPHTML5Player.prototype.setMute=function(d){this.mediaReady?this.media.muted=d:this.onReadyState.muted=d};ZPHTML5Player.prototype.getPlaybackRate=function(){return this.mediaReady?this.media.playbackRate:this.onReadyState.playbackRate};ZPHTML5Player.prototype.setPlaybackRate=function(d){this.mediaReady?this.media.playbackRate=d:this.onReadyState.playbackRate=d};ZPHTML5Player.prototype.getAvailablePlaybackRates=function(){return[0.5,1,1.25,1.5,2,3]};window.addEventHandling(ZPHTML5Player.prototype);
(function(){function d(a){0>_.indexOf(e,a)&&e.unshift(a)}function a(){b||c||$.cachedScript("http://jwpsrv.com/library/cfXtBktSEeKAVyIACp8kUw.js").done(function(){c=!0;for(var a=e.length;a--;)e[a]();e.length=0})}var c=!1,b=!1,e=[],f=function(b,e,f){var k=this;k.type=k.engine="JWPlayer";k.id=e._zpId+"-"+(1E6*Math.random()).toFixed()+"-jwplayer";k.el=b;k.clip=e;k.isEnded=!1;k.ended=function(){return k.isEnded};k.el.append($('<div class="zaption-player" id="'+k.id+'"></div>'));b=function(){var a={controls:!!f,
width:k.el.width(),height:k.el.height(),primary:"html5"};jwplayer(k.id).setup(a);k.jwPlayer=jwplayer(k.id);a={};switch(e.videoType()){case "YouTube":a.sources=[{file:"//www.youtube.com/watch/v/"+e.videoLocation(),type:"youtube"}];break;case "S3":a.sources=[{file:"rtmp://s1ghi5ixd8fbj9.cloudfront.net/cfx/st/mp4:videos/"+e.videoLocation()+".mp4",type:"rtmp"},{file:"//s3.amazonaws.com/zaption-users/videos/"+e.videoLocation()+".mp4",type:"mp4"}];break;case "rtmpURL":a.sources=[{file:e.videoLocation(),
type:"rtmp"}]}k.jwPlayer.load([a]);k.jwPlayer.onPlaylist(function(){k.dispatchEvent("loadedplaylist")});k.jwPlayer.onPlaylistItem(function(){k.dispatchEvent("switchedplaylistitem")});k.jwPlayer.onComplete(function(){k.dispatchEvent("ended")});k.jwPlayer.onPlaylistComplete(function(){k.dispatchEvent("endedplaylist")});k.jwPlayer.onBufferChange(function(){k.dispatchEvent("progress")});k.jwPlayer.onPlay(function(){k.dispatchEvent("play")});k.jwPlayer.onPause(function(){k.dispatchEvent("pause")});k.jwPlayer.onBuffer(function(){k.dispatchEvent("buffering")});
k.jwPlayer.onSeek(function(){k.dispatchEvent("seeked")});k.jwPlayer.onMute(function(){k.dispatchEvent("volumechange")});k.jwPlayer.onVolume(function(){k.dispatchEvent("volumechange")});k.jwPlayer.onError(function(){k.dispatchEvent("error")});k.jwPlayer.onTime(function(){k.getPosition()>k.getDuration()?k.dispatchEvent("ended"):k.dispatchEvent("timeupdate")});k.seek(0,!1)};c?b():(d(b),a());return k};f.onJWLoad=function(){};f.prototype.destroy=function(){this._destroyed=!0;this.removeAllListeners();
this.jwPlayer.remove();$("#"+this.id).remove();this.jwPlayer=null};f.prototype.load=function(a){if(a){this.clip=a;var b={};switch(a.videoType()){case "YouTube":b.sources=[{file:"http://www.youtube.com/watch/v/"+a.videoLocation(),type:"youtube"}];break;case "S3":b.sources=[{file:"rtmp://s1ghi5ixd8fbj9.cloudfront.net/cfx/st/mp4:videos/"+a.videoLocation()+".mp4",type:"rtmp"},{file:"//s3.amazonaws.com/zaption-users/videos/"+a.videoLocation()+".mp4",type:"mp4"}]}this.jwPlayer.load(b)}};f.prototype.play=
function(){return this.jwPlayer.play(!0)};f.prototype.pause=function(){return this.jwPlayer.pause(!0)};f.prototype.seek=function(a){return this.jwPlayer.seek(a+this.clip.inTime())};f.prototype.getState=function(){return this.jwPlayer.getState()};f.prototype.getPropBuffered=function(){return this.jwPlayer.getBuffer()/100};f.prototype.getPosition=function(){var a=this.jwPlayer.getPosition()-this.clip.inTime();0>a&&(a=0);return a};f.prototype.getDuration=function(){return this.clip.outTime()-this.clip.inTime()};
f.prototype.getVolume=function(){return this.jwPlayer.getVolume()/100};f.prototype.setVolume=function(a){return this.jwPlayer.setVolume(100*a)};f.prototype.getMute=function(){return this.jwPlayer.getMute()};f.prototype.setMute=function(a){return this.jwPlayer.setMute(a)};window.addEventHandling(f.prototype);window.ZPJWPlayer=f})();
window.ZPFlowPlayer=function(d,a,c){var b=this;b.type="Flowplayer";b.id=a._zpId+"-"+(1E6*Math.random()).toFixed()+"-flowplayer";b.el=d;b.clip=a;b.isEnded=!1;b.ended=function(){return b.isEnded};b.waitingFor=null;b.isPaused=!1;b.seekTarget=-1;b.storedVolumeLevel=1;b.clipReady=!1;b.clipReadyCallbacks=[];b.el.append($('<div class="zaption-player flowplayer" style="width: 100%; height: 100%;" id="'+b.id+'"></div>'));b.playerEl=$("#"+b.id);b.playerEl.append('<div class="fp-context-menu">');c?b.playerEl.addClass("functional"):
b.playerEl.addClass("no-controls");b._initializeFlowplayer();0===$("#flowplayerSkin").length&&$("head").append($('<link id="flowplayerSkin" rel="stylesheet" type="text/css">').attr("href","//releases.flowplayer.org/5.5.2/skin/functional.css"));return b};ZPFlowPlayer.prototype.addClipReadyCallback=function(d){0>_.indexOf(this.clipReadyCallbacks,d)&&this.clipReadyCallbacks.unshift(d)};
ZPFlowPlayer.prototype._initializeFlowplayer=function(){var d=this;if(d.clip){var a=$("<video>");switch(d.clip.videoType()){case "S3":a.append('<source type="video/flash" src="mp4:videos/'+d.clip.videoLocation()+'.mp4">');a.append('<source type="video/mp4" src="http://s3.amazonaws.com/zaption/videos/'+d.clip.videoLocation()+'.mp4">');break;case "MP4URL":a.append('<source type="video/mp4" src="'+d.clip.videoLocation()+'">');break;case "standalone":a.append('<source type="video/mp4" src="/userVideos/'+
d.clip.videoLocation()+'.mp4">');$(d.media).append('<source type="video/mp4" src="/userVideos/'+d.clip.videoLocation()+'.mp4"></source>');break;default:a.append('<source type="video/mp4" src="'+d.clip.videoLocation()+'">')}d.playerEl.append(a);d.playerEl.flowplayer({key:"$339547711233597",tooltip:!1,keyboard:!1,swf:"/flowplayer.swf",ratio:0.5625,rtmp:"rtmp://sp86m8wv92rsn.cloudfront.net/cfx/st"});d.flowplayer=d.playerEl.data("flowplayer");d.flowplayer.bind("finish",function(){d.dispatchEvent("ended")});
d.flowplayer.bind("resume",function(){d.isPaused||d.dispatchEvent("play")});d.flowplayer.bind("pause",function(){d.isPaused&&d.dispatchEvent("pause")});d.flowplayer.bind("beforeseek",function(){d.dispatchEvent("seeking")});d.flowplayer.bind("seek",function(){0.02>Math.abs(d.seekTarget-d.flowplayer.video.time)&&(d.seekTarget=-1);d.dispatchEvent("seeked")});d.flowplayer.bind("mute",function(){d.dispatchEvent("volumechange")});d.flowplayer.bind("volume",function(){d.dispatchEvent("volumechange")});d.flowplayer.bind("error",
function(){d.dispatchEvent("error")});d.flowplayer.bind("ready",function(){d.clipReady=!0;d.seek(0,!1);for(var a=d.clipReadyCallbacks.length;a--;)d.clipReadyCallbacks[a]();d.clipReadyCallbacks.length=0;d.dispatchEvent("loadeddata")});d.flowplayer.bind("progress",function(){d.getPosition()>=d.getDuration()?d.dispatchEvent("ended"):d.dispatchEvent("timeupdate")})}};
ZPFlowPlayer.prototype.destroy=function(){this._destroyed=!0;this.removeAllListeners();this.flowplayer&&this.flowplayer.unload();$("#"+this.id).remove();this.flowplayer=null};
ZPFlowPlayer.prototype.load=function(d){if(d)if(this.clip=d,this.isPaused=!1,this.seekTarget=-1,this.flowplayer){var a=[];switch(d.videoType()){case "S3":a=[{flash:"mp4:videos/"+d.videoLocation()+".mp4"},{mp4:"http://s3.amazonaws.com/zaption/videos/"+d.videoLocation()+".mp4"}];break;case "MP4URL":a=[{mp4:d.videoLocation()}]}this.clipReady=!1;this.flowplayer.load(a,function(){})}else this._initializeFlowplayer()};
ZPFlowPlayer.prototype.play=function(){var d=this;d.clipReady?(d.isPaused=!1,d.flowplayer.playing||d.flowplayer.play()):d.addClipReadyCallback(function(){d.play()})};ZPFlowPlayer.prototype.pause=function(){var d=this;d.clipReady?(d.isPaused=!0,d.flowplayer.paused||d.flowplayer.pause()):d.addClipReadyCallback(function(){d.pause()})};ZPFlowPlayer.prototype.seek=function(d){var a=this;a.clipReady?(a.seekTarget=d+a.clip.inTime(),a.flowplayer.seek(a.seekTarget)):a.addClipReadyCallback(function(){a.seek(d)})};
ZPFlowPlayer.prototype.getState=function(){if(!this.flowplayer)return"UNLOADED";var d=this.flowplayer.paused,a=this.flowplayer.ready;return this.flowplayer.playing?"PLAYING":d?"PAUSED":a?"UNKNOWN":"UNLOADED"};ZPFlowPlayer.prototype.getPropBuffered=function(){return this.flowplayer?(this.flowplayer.buffer-this.clip.inTime())/this.getDuration():0};
ZPFlowPlayer.prototype.getPosition=function(){if(!this.flowplayer||!this.clipReady)return 0;var d=this.flowplayer.video.time-this.clip.inTime();if(0>d||isNaN(d))d=0;return d};ZPFlowPlayer.prototype.getDuration=function(){return this.flowplayer?this.clip.outTime()-this.clip.inTime():0};ZPFlowPlayer.prototype.getVolume=function(){return this.flowplayer?this.flowplayer.volumeLevel:0};
ZPFlowPlayer.prototype.setVolume=function(d){var a=this;a.storedVolumeLevel=d;if(a.clipReady)return a.flowplayer.volume(d);a.addClipReadyCallback(function(){a.setVolume(d)})};ZPFlowPlayer.prototype.getMute=function(){return this.flowplayer?this.flowplayer.muted:!1};ZPFlowPlayer.prototype.setMute=function(d){var a=this;a.clipReady?(a.flowplayer.mute(d),d||a.flowplayer.volume(a.storedVolumeLevel)):a.addClipReadyCallback(function(){a.setMute(d)})};window.addEventHandling(ZPFlowPlayer.prototype);
window.generateKalturaPartnerPlayer=function(d){function a(a){0>_.indexOf(h,a)&&h.unshift(a)}function c(){f=!0;for(var a=h.length;a--;)h[a]();h.length=0}function b(){if(!g&&!f){var a=function(a){return"https:"===window.location.protocol?"https://cdnapisec.kaltura.com"+a:"http://cdnapi.kaltura.com"+a},b=_.after(2,c),e="/p/"+d.partnerId+"/sp/"+d.partnerId+"00/embedIframeJs/uiconf_id/"+k+"/partner_id/"+d.partnerId;$.cachedScript(a("/p/"+d.partnerId+"/sp/"+d.partnerId+"00/embedIframeJs/uiconf_id/"+n+
"/partner_id/"+d.partnerId)).done(b);$.cachedScript(a(e)).done(b)}}var e=window.debug("player:ZPKalturaPlayer"),f=!1,g=!1,h=[],n=d.playerIdWithoutControls||d.playerId,k=d.playerIdWithControls||d.playerId,l=function(c,g,h){var l=this;l.type=d.videoType;l.engine="Kaltura";l.id=g._zpId+"-"+(1E6*Math.random()).toFixed()+"-kaltura";l.el=c;l.clip=g;l.seeking=!1;l.buffering=!1;l.state={time:0,volume:1,lastVolume:1,muted:!1,state:"unloaded",paused:!0};l.ended=ko.observable(!1);l.kdpReady=!1;l.el.append($('<div class="zaption-player" id="'+
l.id+'"></div>'));l.playerReadyCallbacks=[];c=function(){if(g.ksLoaded&&f){e("Setting up Kaltura player...");var a={autoPlay:!1,mediaProxy:{mediaPlayFrom:g.inTime()},streamerType:"rtmp"};h||d.playerIdWithoutControls||_.extend(a,{"controlBarContainer.plugin":!1,"largePlayBtn.plugin":!1,"loadingSpinner.plugin":!1,"titleLabel.plugin":!1});g.ks()&&(a.ks=g.ks());kWidget.embed({targetId:l.id,wid:"_"+d.partnerId,uiconf_id:h?k:n,entry_id:g.videoLocation(),flashvars:a,params:{wmode:"opaque"},readyCallback:function(a){l.kdp=
document.getElementById(a);l.kdp.kBind("mediaReady",function(){e("kdp event: mediaReady");l.kdpReady=!0;l.dispatchEvent("loadeddata");l.dispatchEvent("canplay");l.dispatchEvent("canplaythrough");l.dispatchEvent("timeupdate");l.onPlayerReady()});l.kdp.kBind("playerPlayEnd",function(){e("kdp event: playerPlayEnd");l.ended(!0);l.dispatchEvent("ended")});l.kdp.kBind("playerPlayed",function(){e("kdp event: playerPlayed");l.ended(!1);l.dispatchEvent("play")});l.kdp.kBind("playerPaused",function(){e("kdp event: playerPaused");
l.dispatchEvent("pause")});l.kdp.kBind("playerSeekStart",function(){e("kdp event: playerSeekStart");l.seeking=!0;l.dispatchEvent("seeking")});l.kdp.kBind("playerSeekEnd",function(){e("kdp event: playerSeekEnd");setImmediate(function(){l.ended(!1);l.seeking=!1;l.dispatchEvent("seeked")})});l.kdp.kBind("mute",function(){l.state.muted=!0;l.dispatchEvent("volumechange")});l.kdp.kBind("unmute",function(){l.state.muted=!1;l.dispatchEvent("volumechange")});l.kdp.kBind("volumeChanged",function(a){l.state.volume=
a.newVolume;l.dispatchEvent("volumechange")});l.kdp.kBind("mediaError",function(){e("kdp event: mediaError");l.dispatchEvent("error")});l.kdp.kBind("playerUpdatePlayhead",function(a){l.state.time-1>a-l.clip.inTime()&&1>a&&2<l.state.time?(log("Kaltura bugged out =("),l.seek(l.state.time)):(l.state.time=a-l.clip.inTime(),0>l.state.time&&(l.state.time=0),l.state.time>l.getDuration()?(l.ended(!0),l.dispatchEvent("timeupdate"),l.dispatchEvent("ended")):l.dispatchEvent("timeupdate"))});l.kdp.kBind("durationChange",
function(a){a=a.newValue;0!==a&&(l.clip.videoDuration()!==a&&l.clip.videoDuration(a),0>l.clip.inTime()&&l.clip.inTime(0),l.clip.outTime()>a&&l.clip.outTime(a),l.isEnded=!1,l.dispatchEvent("durationchange"))});l.kdp.kBind("playerStateChange",function(a){e("kdp event: playerStateChange ("+a+")");l.state.state=a;l.buffering||"buffering"!==l.state.state?l.buffering&&(l.buffering=!1,l.dispatchEvent("buffered")):(l.buffering=!0,l.dispatchEvent("buffering"))})}})}};f&&g.ksLoaded?c():(g.ksLoaded||g.loadKs(c),
f||(a(c),b()));return l};l.prototype.addPlayerReadyCallback=function(a){0>_.indexOf(this.playerReadyCallbacks,a)&&this.playerReadyCallbacks.unshift(a)};l.prototype.onPlayerReady=function(){for(var a=this.playerReadyCallbacks.length;a--;)this.playerReadyCallbacks[a]();this.playerReadyCallbacks.length=0};l.prototype.destroy=function(){this._destroyed=!0;this.removeAllListeners();kWidget.destroy(this.id);$("#"+this.id).remove();this.kdp=null};l.prototype.load=function(a){a&&(this.clip=a,this.state.paused=
!0,a={entryId:a.videoLocation()},e("kdp.changeMedia()"),this.kdp.sendNotification("changeMedia",a))};l.prototype.play=function(){var a=this;a.kdpReady?(a.state.paused=!1,e("kdp.doPlay()"),a.kdp.sendNotification("doPlay")):a.addPlayerReadyCallback(function(){a.play()})};l.prototype.pause=function(){var a=this;if(a.kdpReady){a.state.paused=!0;e("kdp.doPause()");a.kdp.sendNotification("doPause");var b=function(){a.state.paused&&(e("Kaltura play/pause bug workaround: still paused, so sending doPause again"),
a.kdp.sendNotification("doPause"))};setTimeout(b,250);setTimeout(b,500)}else a.addPlayerReadyCallback(function(){a.pause()})};l.prototype.seek=function(a){var b=this;b.kdpReady?(a=Math.min(a,b.getDuration()),b.state.time=a,e("kdp.doSeek("+(a+b.clip.inTime())+")"),b.kdp.sendNotification("doSeek",a+b.clip.inTime())):b.addPlayerReadyCallback(function(){b.seek(a)})};l.prototype.getState=function(){return this.state.state};l.prototype.getPropBuffered=function(){return 0};l.prototype.getPosition=function(){return this.state.time};
l.prototype.getDuration=function(){return this.clip.outTime()-this.clip.inTime()};l.prototype.getVolume=function(){return this.state.volume};l.prototype.setVolume=function(a){var b=this;b.kdpReady?(b.state.volume=b.state.lastVolume=a,b.kdp.sendNotification("changeVolume",a)):b.addPlayerReadyCallback(function(){b.setVolume(a)})};l.prototype.getMute=function(){return this.state.muted};l.prototype.setMute=function(a){var b=this;b.kdpReady?a?(b.state.muted=!0,b.state.lastVolume=b.state.volume,b.kdp.sendNotification("changeVolume",
0)):(b.state.muted=!1,b.kdp.sendNotification("changeVolume",b.state.lastVolume)):b.addPlayerReadyCallback(function(){b.setMute(a)})};window.addEventHandling(l.prototype);return l};
(function(){window.ZPMediaCorePlayer=function(){var d=this;ZPHTML5Player.apply(d,arguments);d.type=d.engine="MediaCore";$(window).on("zaption:videoArchiveAuthenticated",function(a,c){d.clip&&d.clip.archivePartner()===c&&(d.el.find(".video-auth-prompt-pane").hide(),d._loadAfterAuth&&d.load(d._loadAfterAuth))})};ZPMediaCorePlayer.prototype=Object.create(ZPHTML5Player.prototype);ZPMediaCorePlayer.prototype.constructor=ZPMediaCorePlayer;ZPMediaCorePlayer.prototype._showAuthenticationPrompt=function(){var d=
this,a=d.el.find(".video-auth-prompt-pane");if(!a.length){a=$('<div class="video-auth-prompt-pane">');a.text("You need to authenticate with MediaCore to play this video.");a.on("click",function(){return!1});var c=$('<button type="button" class="btn-orange authenticate-btn">Authenticate</button>');c.on("click",function(){d.authenticate();return!1});a.append(c);d.el.append(a)}a.show()};ZPMediaCorePlayer.prototype.authenticate=function(){var d=this;if(d.clip&&d.clip.archivePartner()){var a=_.find(window.privateVideoArchives,
function(a){return a.shortName===d.clip.archivePartner()});if(!a)throw Error("Archive not found");ZAP.mediacore.oauth.authorizeUser(a)}};ZPMediaCorePlayer.prototype.load=function(d){var a=this;if(d){if("MediaCore"!==d.videoType())throw Error("MediaCore player can only play MediaCore videos");var c=d.archivePartner();if(!c)throw Error("MediaCore video has no archivePartner set");var b=_.find(window.privateVideoArchives,function(a){return a.shortName===c});if(!b)throw Error("Archive not found");ZAP.mediacore.oauth.getAccessToken(b)?
(a.clip=d,ZAP.mediacore.requests.getVideoFiles({data:{partnerDomain:b.mediaCoreSubDomain,videoId:d.videoLocation()},archive:b,success:function(e){if(e=e.items[0])return e=ZAP.mediacore.video.getBestEncodingContentURL(e,800,450),ZAP.mediacore.requests.resolveContentURL({data:{partnerDomain:b.mediaCoreSubDomain,path:e,json:!0},archive:b,success:function(b){if(b.location){var e=new ZAP.Clip(ZAP.util.toJS(d),{temporary:!0});e.videoType("MP4URL");e.videoLocation(b.location);e.archivePartner(null);delete a._loadAfterAuth;
a.mediaReady=!1;ZPHTML5Player.prototype.load.call(a,e);a.clip=d}else ZAP.showAlert("MediaCore content location unresolvable.")},error:function(a){ZAP.showAlert(a.message||"Unknown error resolving MediaCore content location.")}});ZAP.showAlert("MediaCore video not found.")},error:function(b){"unauthorized"===b.status?a._showAuthenticationPrompt():ZAP.showAlert(b.message)}})):(a._loadAfterAuth=d,a._showAuthenticationPrompt())}}})();
(function(){var d=[];(window.privateVideoArchives||[]).forEach(function(a){"Kaltura"===a.archiveType&&(d[a.videoType]=window.generateKalturaPartnerPlayer(a))});window.ZPPartnerPlayers=d})();
window.ZPPlaylistPlayer=function(d){var a=this;a.el=d;a.playlist=ko.observableArray();a.players={};a.curIndex=null;a.activePlayer=null;a.subtitlesEnabled=!0;a.isMuted=!1;a.isPaused=!0;a.isEnded=!1;a.volumeLevel=1;a.playbackRate=1;a.transcriptSub=null;a.transcriptObjectSub=null;a.el.css("position","relative");a.loadingImg=$('<img alt="Loading" src="/img/ZPLoader.png" style="position: absolute; left: 50%; margin-left: -16px; top: 50%; margin-top: -16px; display: none; z-index: 1;">');a.loadingImgTimer=
null;a.el.append(a.loadingImg);a.subContainer=$('<div class="sub-container"></div>');a.el.append(a.subContainer);a.loadPlaylist(a.playlist);var c=a.useYTProxy=!1;ZAP.on("reachability:detected",function(){ZAP.Reachability.YouTube||!ZAP.Reachability.YouTubeProxy||c||(c=!0,a.useYTProxy=!0,a._unsetActive(),a.loadPlaylist(a.playlist))});return a};ZPPlaylistPlayer.canPlayHTML5Video=function(){var d=document.createElement("video");return d&&d.canPlayType?!0:!1};
ZPPlaylistPlayer.canPlayMP4HTML5Video=function(){var d=document.createElement("video");return d&&d.canPlayType&&d.canPlayType("video/mp4; codecs=avc1.42E01E,mp4a.40.2")?!0:!1};
ZPPlaylistPlayer.playerForVideoType=function(d){if(!d)return null;switch(d){case "YouTube":return"YouTube";case "YouTubeProxy":return"HTML5";case "Vimeo":return"Vimeo";case "S3":return ZPPlaylistPlayer.canPlayHTML5Video()?"HTML5":"Flowplayer";case "MP4URL":return ZPPlaylistPlayer.canPlayMP4HTML5Video()?"HTML5":"Flowplayer";case "MediaCore":return"MediaCore";case "rtmpURL":return"JWPlayer";default:if(window.privateVideoArchives){var a=_.find(window.privateVideoArchives,function(a){return a.videoType===
d});if(a)return a.videoType}return"Flowplayer"}};ZPPlaylistPlayer.createPlayerForType=function(d,a,c,b){switch(d){case "JWPlayer":return new ZPJWPlayer(a,c,!!b);case "YouTube":return new ZPYTPlayer(a,c,!!b);case "HTML5":return new ZPHTML5Player(a,c,!!b);case "Flowplayer":return new ZPFlowPlayer(a,c,!!b);case "Vimeo":return new ZPVimeoPlayer(a,c,!!b);case "MediaCore":return new ZPMediaCorePlayer(a,c,!!b);default:if(d=window.ZPPartnerPlayers[d])return new d(a,c,!!b)}};
ZPPlaylistPlayer.prototype._startLoadingImg=function(){this.playlist()[this.curIndex]&&!this.loadingImgTimer&&(this.loadingImg.show(),this._updateLoadingImg())};ZPPlaylistPlayer.prototype._stopLoadingImg=function(){this.loadingImg.hide();clearTimeout(this.loadingImgTimer);this.loadingImgTimer=null};
ZPPlaylistPlayer.prototype._updateLoadingImg=function _updateLoadingImg(){var a=this,c="rotate("+45*Math.floor(Date.now()/125)%360+"deg)";a.loadingImg.css("transform",c);a.loadingImg.css("-webkit-transform",c);a.loadingImg.css("-ms-transform",c);a.loadingImgTimer=setTimeout(function(){_updateLoadingImg.call(a)},125)};
ZPPlaylistPlayer.prototype._onPlaylistUpdate=function(){if(!this._destroyed){var d=this.playlist()||[],a=this.activePlayer?this.activePlayer.clip:null;this.curIndex=null;var c=a?_.indexOf(d,a):-1;-1===c&&a&&a._muteSubscription.dispose();-1!==c?this.curIndex=c:1>d.length?this.activePlayer&&this._unsetActive():this.setPlaylistIndex(0);this.isEnded=!1;this.dispatchEvent("loadedplaylist");this.dispatchEvent("switchedplaylistitem")}};
ZPPlaylistPlayer.prototype.loadPlaylist=ZPPlaylistPlayer.prototype.load=function(d){var a=this;a._destroyed||(a.playlist=d||ko.observableArray(),a.playlist.subscribe(function(){a._onPlaylistUpdate()}),a._onPlaylistUpdate())};ZPPlaylistPlayer.prototype.getCurrentItem=function(){return this._destroyed?null:this.playlist()[this.curIndex]};ZPPlaylistPlayer.prototype.getPlaylistIndex=function(){return this._destroyed?0:this.curIndex};
ZPPlaylistPlayer.prototype.setPlaylistIndex=function(d,a){var c=this;if(!c._destroyed&&void 0!==d&&(void 0===a&&(a=!c.isPaused),d!==c.curIndex)){var b=c.playlist()[d];if(b){c.getCurrentItem()&&c.getCurrentItem()._muteSubscription.dispose();var e="YouTube"===b.videoType()&&c.useYTProxy?"YouTubeProxy":b.videoType(),e=ZPPlaylistPlayer.playerForVideoType(e),f=c.players[e];f&&"Vimeo"!==f.engine&&"Kaltura"!==f.engine?(c.activePlayer&&f!==c.activePlayer&&c._unsetActive(),f.load(b)):(c.activePlayer&&c._unsetActive(),
f=c.createPlayer(e,c.el,b),c.players[e]=f,c._addInternalListeners(f));c.activePlayer=f;c.curIndex=d;c._setClipMute(b.mute());b._muteSubscription=b.mute.subscribe(c._setClipMute,c);c.activePlayer._hideLoadingSpinner||(c.activePlayer._hideLoadingSpinner=function(){c._stopLoadingImg();c.activePlayer.off("loadeddata",c.activePlayer._hideLoadingSpinner)});window.isTablet||(c._startLoadingImg(),c.activePlayer.off("loadeddata",c.activePlayer._hideLoadingSpinner),c.activePlayer.on("loadeddata",c.activePlayer._hideLoadingSpinner));
a&&c.play();c.isEnded=!1;c.dispatchEvent("switchedplaylistitem")}}};ZPPlaylistPlayer.prototype.createPlayer=function(d,a,c){if(!this._destroyed)return d=ZPPlaylistPlayer.createPlayerForType(d,a,c),d.setVolume(this.volumeLevel),d.setMute(this.isMuted),d};ZPPlaylistPlayer.prototype.skipPlaylistForward=function(d){if(!this._destroyed){var a=this.curIndex+1;this.playlist()[a]&&this.setPlaylistIndex(a,d)}};
ZPPlaylistPlayer.prototype.skipPlaylistBackward=function(d){if(!this._destroyed){var a=this.curIndex-1;this.playlist()[a]&&this.setPlaylistIndex(a,d)}};ZPPlaylistPlayer.prototype.destroy=function(){this._destroyed=!0;this.removeAllListeners();this.loadingImg&&this.loadingImg.remove();this.subContainer&&this.subContainer.remove();for(var d in this.players)this.players.hasOwnProperty(d)&&(this.players[d].destroy(),delete this.players[d]);this.activePlayer=null;this.dispatchEvent("destroyed")};
ZPPlaylistPlayer.prototype._unsetActive=function(){this.activePlayer.destroy();delete this.players[this.activePlayer.type];this.activePlayer=!1};
ZPPlaylistPlayer.prototype._updateSubtitles=function(){if(!this._destroyed){var d=this.playlist()[this.curIndex];if(this.subtitlesEnabled&&d&&d.transcript()&&d.transcriptObject()){for(var a=this.getPosition()+d.inTime(),d=d.transcriptObject().entries()||[],c=0;c<d.length;c++){var b=d[c];if(b.inTime()>a)break;if(b.inTime()<=a&&b.outTime()>a&&1>this.subContainer.find("#"+b._id).length){var e=$('<span class="entry-container" id="'+b._id+'"></span>');e.text(b.text());e.data("inTime",b.inTime());e.data("outTime",
b.outTime());this.subContainer.append(e)}}this.subContainer.find(".entry-container").each(function(b,e){var c=$(e);(a<c.data("inTime")||a>=c.data("outTime"))&&c.remove()})}}};
ZPPlaylistPlayer.prototype._onItemEnded=function(){var d=this.curIndex+1,a=this.curIndex,c=this.getPosition();this.dispatchEvent("itemwillend");this.dispatchEvent("timeupdate");this.curIndex!==a||this.getPosition()<c?log("ZPPlaylistPlayer skipping ended event due to player movement."):this.isPaused&&d<this.playlist().length||(d>=this.playlist().length?(this.pause(),this.isEnded=!0,this.dispatchEvent("ended")):this.skipPlaylistForward(!0))};
ZPPlaylistPlayer.prototype._addInternalListeners=function(d){var a=this,c=function e(){a._stopLoadingImg();if(!a.activePlayer.seeking&&!a.activePlayer.buffering||a.ended())a.off("ended",e),a.off("seeked",e),a.off("buffered",e)};d.on("durationchange",function(){a.dispatchEvent("durationchange")});d.on("timeupdate",function(){a._updateSubtitles()});d.on("seeked",function(){a._updateSubtitles()});d.on("ended",function(){a._onItemEnded()});d.on("timeupdate",function(){a.dispatchEvent("timeupdate")});
d.on("progress",function(){a.dispatchEvent("progress")});d.on("play",function(){a.isPaused=!1;a.dispatchEvent("play")});d.on("pause",function(){var e=0.5>a.activePlayer.getDuration()-a.activePlayer.getPosition();if(a.isPaused||!e)a.isPaused=!0,a.dispatchEvent("pause")});d.on("buffering",function(){a.dispatchEvent("buffering");a._startLoadingImg()});d.on("buffered",function(){a.dispatchEvent("buffered");a._stopLoadingImg()});d.on("seeking",function(){a._startLoadingImg();a.on("seeked",c);a.on("ended",
c);a.dispatchEvent("seeking")});d.on("seeked",function(){a.dispatchEvent("seeked")});d.on("volumechange",function(){a.dispatchEvent("volumechange")});d.on("ratechange",function(){a.dispatchEvent("ratechange")});d.on("error",function(){a.dispatchEvent("error")});d=function f(){var c=a.playlist()[a.curIndex];a.subContainer.empty();a._updateSubtitles();a.transcriptObjectSub&&(a.transcriptObjectSub.dispose(),a.transcriptObjectSub=null);a.transcriptSub&&(a.transcriptSub.dispose(),a.transcriptSub=null);
c&&(a.transcriptSub=c.transcript.subscribe(function(){c.loadTranscript();f()}),a.transcriptObjectSub=c.transcriptObject.subscribe(f))};a.on("switchedplaylistitem",d);d()};ZPPlaylistPlayer.prototype._setClipMute=function(d){this.activePlayer&&(d?this.activePlayer.setMute(!0):this.activePlayer.setMute(this.isMuted))};
ZPPlaylistPlayer.prototype.play=function(){this.isPaused=!1;if(this.activePlayer)if(this.activePlayer.ended()||"YouTube"===this.activePlayer.type&&0.1>this.activePlayer.getDuration()-this.activePlayer.getPosition())this._onItemEnded();else return this.activePlayer.play()};ZPPlaylistPlayer.prototype.pause=function(){this.isPaused=!0;if(this.activePlayer)return this.activePlayer.pause()};ZPPlaylistPlayer.prototype.seek=function(d){if(this.activePlayer)return this.isEnded=!1,this.activePlayer.seek(d)};
ZPPlaylistPlayer.prototype.getState=function(){return this.activePlayer?this.activePlayer.getState():"UNLOADED"};ZPPlaylistPlayer.prototype.playing=function(){return!this.isPaused};ZPPlaylistPlayer.prototype.ended=function(){return this.isEnded};ZPPlaylistPlayer.prototype.getPropBuffered=function(){return this.activePlayer?this.activePlayer.getPropBuffered():0};
ZPPlaylistPlayer.prototype.getPosition=function(){return this.activePlayer?this.activePlayer.ended()?this.activePlayer.clip.duration():this.activePlayer.getPosition():0};ZPPlaylistPlayer.prototype.getDuration=function(){return this.activePlayer?this.activePlayer.getDuration():0};ZPPlaylistPlayer.prototype.getVolume=function(){return this.activePlayer?this.activePlayer.getVolume():0};ZPPlaylistPlayer.prototype.setVolume=function(d){this.volumeLevel=d;if(this.activePlayer)return this.activePlayer.setVolume(d)};
ZPPlaylistPlayer.prototype.getMute=function(){return this.activePlayer?this.activePlayer.getMute():!1};ZPPlaylistPlayer.prototype.setMute=function(d){this.isMuted=d;if(!(!this.activePlayer||this.getCurrentItem()&&this.getCurrentItem().mute()))return this.activePlayer.setMute(d)};ZPPlaylistPlayer.prototype.getAvailablePlaybackRates=function(){return this.activePlayer?this.activePlayer.getAvailablePlaybackRates?this.activePlayer.getAvailablePlaybackRates():[1]:!1};
ZPPlaylistPlayer.prototype.getPlaybackRate=function(){return this.activePlayer?this.activePlayer.getPlaybackRate?this.activePlayer.getPlaybackRate():1:!1};ZPPlaylistPlayer.prototype.setPlaybackRate=function(d){this.playbackRate=d;this.activePlayer.setPlaybackRate&&this.activePlayer.setPlaybackRate(this.playbackRate)};ZPPlaylistPlayer.prototype.getSubtitlesEnabled=function(){return this.subtitlesEnabled};
ZPPlaylistPlayer.prototype.setSubtitlesEnabled=function(d){(this.subtitlesEnabled=d)?(this.subContainer.show(),this._updateSubtitles()):this.subContainer.hide()};window.addEventHandling(ZPPlaylistPlayer.prototype);
window.LiveElements=function(d,a,c){var b=ko.observableArray();b.liveId=1E6*Math.random();b.paused=ko.observable(!!c);b.pause=function(){if(!b.paused()){log("PAUSE LIVELEMENTS!");b.paused(!0);var e=b.activeElement();e&&b.deactivate(e);"Sidebar"===d&&a._hideSidebar()}};b.resume=function(){if(b.paused()){log("RESUME LIVELEMENTS!");b.paused(!1);var a=b.activeElement();a&&b.activate(a)}};b.contains=function(a){return _.contains(b(),a)};b.activeElement=ko.computed(function(){return b.paused()?null:b()[0]});
b.activeElement.deferUpdates=!1;b.inactiveElements=ko.computed(function(){return b.paused()?b():b().slice(1)});b.stoppingVideo=ko.computed(function(){return b.activeElement()&&b.activeElement().stopVideo()&&!b.activeElement().removeAfter()});b.stoppingVideo.deferUpdates=!1;b.controlsPlayPause=ko.computed(function(){return b.activeElement()&&b.activeElement().stopVideo()});b.controlsPlayPause.deferUpdates=!1;b.start=function(){var a=b.activeElement();a&&b.activate(a)};b.active=function(){return!!b.activeElement()};
b.started=function(){return b.active()||b.paused()};b.deactivate=function(a){if(!a)return!1;a.active()&&(a.active(!1),a.deactivated())};b.activate=function(e){log("ACTIVATE "+e.elementType());if(!e)return!1;e.active()||b.paused()||("Sidebar"===d&&a._showSidebar(),e.active(!0),e.activated())};b.remove=function(e){if(!e)return!1;log("REMOVE "+e.elementType()+" in "+e.space());if(b.contains(e)){var c=_.indexOf(b(),e);b().splice(c,1);b.deactivate(e);b.valueHasMutated();a.liveSideElements.activeElement()||
a._hideSidebar();b.start();return!0}};b.clear=function(){log("CLEAR LiveElements");for(var e=b(),c=0,g=e.length;c<g;c++)b.deactivate(e[c]);a._hideSidebar();e.length=0;b.valueHasMutated()};b.add=function(a,c){var g=b();if(!b.contains(a)){log("ADD "+a.elementType()+" in "+a.space());a.active(!1);var h=b.activeElement();a.precedence||(a.precedence=0);if(c)g.unshift(a);else{for(var d=!1,k=0,l=g.length;k<l;k++){var q=function(b){g.splice(b,0,a);d=!0};if(!(g[k].precedence>a.precedence)){if(g[k].precedence<
a.precedence){q(k);break}if(!g[k].stopVideo()||a.stopVideo()){if(a.stopVideo()&&!g[k].stopVideo()){q(k);break}if(!(g[k].inTime()<a.inTime())){if(g[k].inTime()>a.inTime()){q(k);break}q(k);break}}}}d||g.push(a)}b.valueHasMutated();h&&b.activeElement()!==h&&b.deactivate(h);b.start();return a}};return b};
(function(){window.TimingManager=function(d){var a=this;a.expectedTime=ko.observable(0);a.actualTime=ko.observable(0);var c=0;a.updateActualTime=function(b){var e=a.actualTime();a.actualTime(b);if(b===a.expectedTime())c=0;else if(b!==e){var f=b-a.expectedTime();if(-0.1<f&&2>f)a.expectedTime(b),c=0,d._seeking&&(console.log("Player thought it was still seeking, fixing with seeked event..."),a.dispatchEvent("seeked"));else{b-=e;if(-0.1>b||2<b)c=0;c++;3<=c||-4<f||4>f?(a.expectedTime(a.actualTime()),a.dispatchEvent("seeked")):
(log("Time mismatch, attempting seek to expected time "+a.expectedTime()),d.seek(a.expectedTime()))}}}};window.addEventHandling(window.TimingManager.prototype)})();
(function(){ZAP.elementTypes=[{name:"TextScreen",displayName:"Text Slide",toolbarClass:"text-screen-element",spaces:["MainBox","Sidebar"],activated:function(d,a,c){log("text screen start called");"Stop"===a.behavior()&&a.removeAfter()&&(c.textScreenTimeRemaining=1E3*a.removeAfter(),!a.wasPausedOnStart||a._parent()&&"TourElement"===a._parent()._instanceType)&&(d.isPaused(!1),c.textScreenTimeStarted=new Date,c.textScreenTimer=setTimeout(function(){d.dequeueElement(a);d.playUnlessBlocked()},c.textScreenTimeRemaining))},
deactivated:function(d,a,c){clearTimeout(c.textScreenTimer);log("text screen end called")},pause:function(d,a,c){"Stop"===a.behavior()&&a.removeAfter()&&(clearTimeout(c.textScreenTimer),c.textScreenTimeRemaining-=new Date-c.textScreenTimeStarted);return!0}},{name:"ImageScreen",displayName:"Image Slide",toolbarClass:"image-screen-element",spaces:["MainBox","Sidebar"],activated:function(d,a,c){log("image screen start called");"construct"===d.playerMode&&(c.overlay.find("img.croppable-image"),a.imageURL()||
(c._preventDefault=function(a){a.preventDefault()},$(document).bind("drop dragover",c._preventDefault),c.overlay.find(".browse-button").on("click",function(){c.overlay.find(".image-upload").focus().click()})));if("construct"!==d.playerMode){var b=function(a,b){a.css("left",b.calculateImageLeft()+"%");a.css("top",b.calculateImageTop()+"%");b.imageWidth()?a.css("width",b.calculateImageWidth()+"%"):a.css("max-width","100%");b.imageHeight()?a.css("height",b.calculateImageHeight()+"%"):a.css("max-height",
"100%")};b(c.overlay.find("img"),a);$(window).on("resize.img-"+a._id,function(){b(c.overlay.find("img"),a)})}"Stop"===a.behavior()&&a.removeAfter()&&(c.imageScreenTimeRemaining=1E3*a.removeAfter(),!a.wasPausedOnStart||a._parent()&&"TourElement"===a._parent()._instanceType)&&(d.isPaused(!1),c.imageScreenTimeStarted=new Date,c.imageScreenTimer=setTimeout(function(){d.dequeueElement(a);d.playUnlessBlocked()},c.imageScreenTimeRemaining))},deactivated:function(d,a,c){log("image screen deactivated");$(window).off("resize.img-"+
a._id);clearTimeout(c.imageScreenTimer);$(document).unbind("drop dragover",c._preventDefault)},pause:function(d,a,c){"Stop"===a.behavior()&&a.removeAfter()&&(clearTimeout(c.imageScreenTimer),c.imageScreenTimeRemaining-=new Date-c.imageScreenTimeStarted);return!0}},{name:"Video",displayName:"Video",toolbarClass:"video-element",spaces:["Sidebar"],activated:function(d,a){a.videoClip()&&(!a.wasPausedOnStart||a._parent()&&"TourElement"===a._parent()._instanceType)&&d.isPaused(!1)},deactivated:function(){},
pause:function(d,a,c){return(a=c.overlay.find("#sideVideo").data("playerData"))&&a.player?(a.player.pause(),d.isPaused(!0),!1):!0},play:function(d,a,c){return(a=c.overlay.find("#sideVideo").data("playerData"))&&a.player?(a.player.play(),d.isPaused(!1),!1):!0}},{name:"TextResponse",displayName:"Open Response",toolbarClass:"text-response-element",spaces:["MainBox","Sidebar"],activated:function(d,a,c){log("text response start called ("+a.prompt()+")");var b=!0;c.overlay.find("textarea").each(function(){window.autosize(this)}).on("autosize:resized",
function(){b?b=!1:c.overlay.scrollTo("100%")});$(".player-sidebar").on("transitionend.autosize-update webkitTransitionEnd.autosize-update oTransitionEnd.autosize-update msTransitionEnd.autosize-update",function(a){a.target===this&&window.autosize.update(c.overlay.find("textarea"))});c.overlay.find("form").on("submit",function(b){b.preventDefault();if("construct"!==d.playerMode){b=c.overlay.find("form textarea[name=textResponseAnswer]").val();var f;if(b)f={text:b};else if(d.viewModel.tour().responsesRequired())return ZAP.showAlert("You must enter a response to continue."),
!1;d.sendElementResponse(a,f,!0)}})},deactivated:function(){log("text response end called");$(".player-sidebar").off("transitionend.autosize-update webkitTransitionEnd.autosize-update oTransitionEnd.autosize-update msTransitionEnd.autosize-update")}},{name:"DrawnResponse",displayName:"Drawn Response",toolbarClass:"drawn-response-element",spaces:["MainBox"],activated:function(d,a,c){log("drawn response start called ("+a.prompt()+")");var b;"construct"!==d.playerMode&&(b=c.simpleDraw=new SimpleDraw(c.overlay.find(".draw-canvas")[0],
{initialDrawingJSON:a.response(),scaleFrom:{width:619,height:348},matchSize:$(".video-player")},function(){b.canvas&&(a.drawingJSON(b.getDrawingJSON()),b.addChangeListener(function(b){a.response(b)}),b.canvas.on("mouse:down",function(){c.overlay.find(".drawing-placeholder").hide()}))}),c.overlay.find("#clear_drawing_btn").on("click.simpledraw",function(){b.clear()}),c.overlay.find("#submit_btn").on("click.simpledraw",function(e){e.stopPropagation();e=b.getDrawingJSON();var c;if(e&&e!==fabric.Canvas.EMPTY_JSON||
!d.viewModel.tour().responsesRequired())c={drawingJSON:e,scaleFrom:{width:$(".video-player").width(),height:$(".video-player").height()},inTime:d.currentTime()};else if(d.viewModel.tour().responsesRequired())return ZAP.showAlert("You must draw a response to continue."),!1;d.sendElementResponse(a,c,!0)}),$(window).on("resize."+a._id+" fullscreenchange."+a._id,_.debounce(function(){b.renderJSON(a.response(),{width:$(".video-player").width(),height:$(".video-player").height()})},200)))},deactivated:function(d,
a,c){c.simpleDraw&&(c.simpleDraw.destroy(),c.simpleDraw=null);$(window).off("resize."+a._id+" fullscreenchange."+a._id);log("drawn response end called")}},{name:"NumResponse",displayName:"Numerical Response",toolbarClass:"num-response-element",spaces:["MainBox","Sidebar"],activated:function(d,a,c){log("num response start called");c.overlay.find("form").on("submit",function(b){b.preventDefault();if("construct"!==d.playerMode){b=parseFloat(c.overlay.find("form input[name=numResponseAnswer]").val());
var e;if("number"!==typeof b||isNaN(b)){if(d.viewModel.tour().responsesRequired())return ZAP.showAlert("You must enter a numerical response to continue."),!1}else e={number:parseFloat(b)};d.sendElementResponse(a,e,!0)}})},deactivated:function(){log("num response end called")}},{name:"CheckBoxes",displayName:"Check Boxes",toolbarClass:"check-box-element",spaces:["MainBox","Sidebar"],activated:function(d,a,c){log("checkboxes start called");c.overlay.find("form").on("submit",function(b){b.preventDefault();
b.stopPropagation();if("construct"!==d.playerMode){b=c.overlay.find("form input[name=checkBoxesOptions]:checked").map(function(b,e){var c=_.find(a.choices(),function(a){return a._id===$(e).val()});return c?c._id:null}).get();var e;if(0===b.length){if(d.viewModel.tour().responsesRequired())return ZAP.showAlert("You must choose at least one answer to continue."),!1}else e={checked:b};d.sendElementResponse(a,e,!0)}})},deactivated:function(){log("checkboxes end called")}},{name:"MultipleChoice",displayName:"Multiple Choice",
toolbarClass:"multi-choice-element",spaces:["MainBox","Sidebar"],activated:function(d,a,c){log("multichoice start called");c.overlay.find("form").on("submit",function(b){b.preventDefault();b.stopPropagation();if("construct"!==d.playerMode){var e=c.overlay.find("form input[name=multiChoiceOptions]:checked").val();b=_.find(a.choices(),function(a){return a._id===e});var f;if(b)f={text:b.text(),choice:b._id};else if(d.viewModel.tour().responsesRequired())return ZAP.showAlert("You must choose an answer to continue."),
!1;d.sendElementResponse(a,f,!0)}});if("construct"===d.playerMode)c.overlay.on("click",".action-selector-button",function(){var b=ko.contextFor(this).$data,e=_.find(a.actions(),function(a){return a.criteria()&&a.criteria().choice===b._id});e||(e=new ZAP.ElementAction({_id:(new ObjectId).toString(),criteria:{choice:b._id}}),a.actions.push(e),e.feedbackType.subscribe(function(b){if("Correct"===b){b=_.pluck(a.choices(),"_id");var e=_.pluck(a.actions().map(function(a){return a.criteria()}),"choice");
_.filter(b,function(a){return!_.contains(e,a)}).forEach(function(b){a.actions.push(new ZAP.ElementAction({_id:(new ObjectId).toString(),criteria:{choice:b},feedbackType:"Incorrect"}))})}}))})},deactivated:function(){log("multichoice end called")}},{name:"Discussion",displayName:"Discussion",toolbarClass:"discussion-element",spaces:["Sidebar"],activated:function(d,a,c){log("discussion start called");"construct"!==d.playerMode&&(c._unpauseAfterComment=void 0)},deactivated:function(){log("discussion end called")}},
{name:"Replay",displayName:"Replay",toolbarClass:"replay-element",spaces:["Sidebar"],activated:function(d,a,c){log("replay start called");c.overlay.find(".replay-button").on("click",function(){d.seek(a.inTime(),!0);c.overlay.find("button").removeClass("-show")});c.overlay.find(".continue-button").on("click",function(b){b.stopPropagation();d.playlistPlayer.getPosition()<=a.outTime()-0.5&&d.seek(a.outTime()+0.1,!0);d.dequeueElement(a);a.precedence=0;d.playUnlessBlocked()});d.playlistPlayer.getPosition()<
a.outTime()-0.5&&c.overlay.find("button").removeClass("-show")},shouldEnd:function(d,a,c){log("replay shouldEnd");c.overlay.find("button").addClass("-show");a.precedence=1;d.loadElement(a);c._checkTime&&d.playlistPlayer.off("timeupdate",c._checkTime);c._checkTime=function(){d.curItem()||(d.playlistPlayer.off("timeupdate",c._checkTime),d.dequeueElement(a),a.precedence=0);var b=d.playlistPlayer.getPosition();if(b<=a.inTime()-0.4||b>=a.outTime()+0.4)d.playlistPlayer.off("timeupdate",c._checkTime),d.dequeueElement(a),
a.precedence=0};d.playlistPlayer.on("timeupdate",c._checkTime);return!1},beforeRestart:function(d,a,c){d.playlistPlayer.off("timeupdate",c._checkTime)},deactivated:function(d,a,c){log("replay end called");d.playlistPlayer.off("timeupdate",c._checkTime)}},{name:"Drawing",displayName:"Drawing",toolbarClass:"drawing-element",spaces:["MainBox","Sidebar"],activated:function(d,a,c){log("Drawing start called");"Stop"===a.behavior()&&a.removeAfter()&&(c.drawingTimeRemaining=1E3*a.removeAfter(),!a.wasPausedOnStart||
a._parent()&&"TourElement"===a._parent()._instanceType)&&(d.isPaused(!1),c.drawingTimeStarted=new Date,c.drawingTimer=setTimeout(function(){d.dequeueElement(a);d.playUnlessBlocked()},c.drawingTimeRemaining));var b;if("construct"===d.playerMode)b=c.simpleDraw=new SimpleDraw(c.overlay.find(".draw-canvas")[0],{initialDrawingJSON:a.drawingJSON(),matchSize:c.overlay.parent()},function(){b.canvas&&(a.drawingJSON(b.getDrawingJSON()),b.addChangeListener(function(b){a.drawingJSON(b)}),b.canvas.on("mouse:down",
function(){c.overlay.find(".drawing-placeholder").hide()}))}),c.overlay.find("#clear_drawing_btn").on("click",function(){b.clear()});else{var e={initialDrawingJSON:a.drawingJSON(),viewOnly:!0};"MainBox"===a.space()&&(e.scaleFrom={width:619,height:348},e.matchSize=$(".video-player"));"Sidebar"===a.space()&&(e.width=316,e.height=348,e.scaleFrom={width:316,height:348});b=c.simpleDraw=new SimpleDraw(c.overlay.find(".draw-canvas")[0],e);var f=".video-player";"Sidebar"===a.space()&&(f=".player-sidebar .drawing-content");
$(window).on("resize."+a._id+" fullscreenchange."+a._id,_.debounce(function(){b.renderJSON(a.drawingJSON(),{width:$(f).width(),height:$(f).height()},!1)},200))}},deactivated:function(d,a,c){c.simpleDraw&&(c.simpleDraw.destroy(),c.simpleDraw=null);$(window).off("resize."+a._id+" fullscreenchange."+a._id);clearTimeout(c.drawingTimer);log("Drawing end called")},pause:function(d,a,c){"Stop"===a.behavior()&&a.removeAfter()&&(clearTimeout(c.drawingTimer),c.drawingTimeRemaining-=new Date-c.drawingTimeStarted);
return!0}},{name:"Transcript",displayName:"Transcript",toolbarClass:"transcript-element",spaces:["Sidebar"],activated:function(d,a,c){log("transcript start called");"construct"===d.playerMode&&(c._preventDefault=function(a){a.preventDefault()},$(document).bind("drop dragover",c._preventDefault),c.overlay.find(".browse-button").on("click",function(){c.overlay.find(".transcript-upload").focus().click()}))},deactivated:function(d,a,c){log("transcript end called");$(document).unbind("drop dragover",c._preventDefault)}},
{name:"Group",displayName:"Element Group",spaces:["MainBox","Sidebar"],activated:function(d,a,c){log("element group started");a.activeChild(null);c.childElementDeactivated=function(b){b.active(!1);a.activeChild()===b&&(a.activeChild(void 0),b=_.indexOf(a.filteredChildren(),b),a.filteredChildren().length>b+1?a.filteredChildren()[b+1].activated():(d.dequeueElement(a),d.playUnlessBlocked()))};c.childElementActivated=function(b){var e=a.activeChild();a.activeChild(b);b.active(!0);e&&e!==b&&e.deactivated()};
0<a.filteredChildren().length&&a.filteredChildren()[0].activated()},deactivated:function(d,a){log("element group ended");a.activeChild()&&(a.activeChild().deactivated(),a.activeChild(null))},play:function(d,a){var c=a.activeChild(),b=c?_.indexOf(a.filteredChildren(),c):0;if(c&&c.stopVideo()&&!c.removeAfter()&&!c.play())return!1;if(a.filteredChildren().length>b+1)return a.filteredChildren()[b+1].activated(),!1;c.deactivated();return!0},next:function(d,a){var c=a.activeChildIndex()+1,b=a.filteredChildren(),
e=c<b.length?b[c]:!1;e&&d._continuePastResponses(function(a){a&&(!d.navigationDisabledForward&&!d.navigationDisabled||e.initialResponse().length||e.response())&&e.activated()})},prev:function(d,a){var c=a.activeChildIndex()-1,b=a.filteredChildren();(c=-1<c?b[c]:!1)&&c.activated()}},{name:"Jump",displayName:"Jump",toolbarClass:"jump-element",spaces:["MainBox","Sidebar"],activated:function(d,a){log("jump activated at inTime: "+a.inTime());"construct"!==d.playerMode&&("Element"===a.targetType()?d.goToElement(a.target()):
a.target()&&d.goToPosition(a.target(),a.targetTime()||0))},deactivated:function(){log("jump deactivated")}}]})();
(function(){var d=window.debug("player:ZaptionPlayer");window.ZaptionPlayer=function(a,c){var b=[];window.Date.now||(window.Date.now=function(){return+new Date});return function(a,f,g){var h=this;if(void 0!==b[a])return b[a];b[a]=h;void 0===g&&(g={});void 0===c&&(c=[]);h.id=a;h.playlist=ko.observableArray();h.curItem=ko.observable();h.options=g;h.volume=1;h.muted=!1;h.playbackRate=ko.observable(1);h.hasPlaybackButtons=ko.observable(!0);h.subtitled=!0;h.fullScreenMode="";h.playerMode=g.playerMode||
"view";h.sidebar=g.sidebarId?$("#"+g.sidebarId):$([]);h.mainOverlay=g.overlayId?$("#"+g.overlayId):$([]);h.isPaused=ko.observable(!0);h.nextInterestingTime=0;h.viewModel=g.viewModel;h.viewerName=g.viewModel&&g.viewModel.viewerName||ko.observable(window.viewerName||"Anonymous");h.channel=new ZAP.PresentationChannel(g.channelId||"common");h.liveMainElements=new LiveElements("MainBox",h,!0);h.liveSideElements=new LiveElements("Sidebar",h,!0);h.timingManager=new window.TimingManager(h);h.instances=b;
h.isFinished=ko.observable(!1);h.fullScreenAvailable=screenfull.enabled&&!bowser.safari&&!ZAP.is.mobile;h.isFullScreenMode=ko.observable(!1);h.currentTimeOnClip=ko.observable(0);h.currentTimeOnTour=ko.observable(0);h.isPlayerMode("view","preview","present")&&(h.ratioPlayed=ko.computed(function(){return h.currentTimeOnTour()/h.viewModel.tour().totalDuration()}));if(h.isPlayerMode("view","present")){var d=_.max(Object.keys(window.minutesViewed).map(function(a){return parseInt(a,10)}))||0,k=_.max(Object.keys(window.minutesViewed[d]||
{}).map(function(a){return parseInt(a,10)}))||0;h.furthestTimeViewed=ko.observable();h.furthestTimeViewed.subscribe(function(){var a=100*(h.furthestTimeViewed()/h.viewModel.tour().totalDuration());$(".seekbar-disabled-part").css("width",100-a+"%")});h.furthestTimeViewed(60*d+k);h.historian=new ZAP.TourHistorian(h.viewModel.tour()._id,h.viewerName)}window.preventBind(h.sidebar);window.preventBind(h.mainOverlay);h.el=$("#"+a);h.el.css("background","#000");h.height=h.el.height();h.width=h.el.width();
h.seekBar=$([]);h.controlBar=$([]);h.el.addClass("-mode-"+h.playerMode);screenfull.onchange=function(){if(screenfull.isFullscreen){var a=h.isPlayerMode("present")?102:46,b=h.liveSideElements.activeElement()&&!h.isPlayerMode("present")?316:null;$(window).on("resize.fixfullscreen",function(){var b=h.liveSideElements.activeElement()&&!h.isPlayerMode("present")?316:null;ZAP.player.centerFullScreenVideo($(window).width(),$(window).height(),a,b)});$(".video-player").on("transitionend webkitTransitionEnd oTransitionEnd msTransitionEnd",
function(){$(window).trigger("resize");$("body").addClass("body-fullscreen")});ZAP.player.centerFullScreenVideo(screen.width,screen.height,a,b)}else h.fullScreenMode="",b=h.el.parent(),b.removeClass("full-screen"),b.find(".interception-overlay").remove(),h.mainOverlay.off("vmousemove"),clearTimeout(h._fullScreenMouseMove._timeout),h._fullScreenMouseMove._timeout=null,$(".video-player").css({width:"",height:"",top:""}),$(window).off("resize.fixfullscreen"),$(".video-player").off("transitionend webkitTransitionEnd oTransitionEnd msTransitionEnd"),
$("body").removeClass("body-fullscreen"),h.exitFullScreen();h.isFullScreenMode(screenfull.isFullscreen||window.isTabletFullscreen||window.isFakeFullscreen)};h.durationSubscription=null;h.playlistPlayer=new ZPPlaylistPlayer(h.el);g.controlBar&&h.endowControlBar(g.controlBar);g.seekBar&&h.endowSeekBar(g.seekBar);h._addKeyBindings();h._bindInternalListeners();h.loadPlaylist(f,g.initialClip);h.elementsTimeUpdate(!0)}}();ZaptionPlayer.prototype.enqueueElement=function(a,c){if(!this._destroyed)switch(a.space()){case "MainBox":this.liveMainElements.add(a,
c);break;case "Sidebar":this.liveSideElements.add(a,c)}};ZaptionPlayer.prototype.isPlayerMode=function(){var a=Array.prototype.slice.call(arguments);return-1<$.inArray(this.playerMode,a)};ZaptionPlayer.prototype.dequeueElement=function(a){if(!this._destroyed){switch(a.space()){case "MainBox":this.liveMainElements.remove(a);break;case "Sidebar":this.liveSideElements.remove(a)}this.activeGroupWithElement(a)&&a.deactivated()}};ZaptionPlayer.prototype.pauseElementsQueues=function(){this._destroyed||(this.liveSideElements.pause(),
this.liveMainElements.pause())};ZaptionPlayer.prototype.resumeElementsQueues=function(){this._destroyed||(this.liveSideElements.resume(),this.liveMainElements.resume(),this.elementsTimeUpdate(!0))};ZaptionPlayer.prototype.destroy=function(){this._destroyed=!0;this.removeAllListeners();this.pause();this.playlist=ko.observableArray();this.clearControlBarEventHandlers();this.clearSeekBarEventHandlers();this.instances[this.id]=void 0;this.playlistPlayer&&this.playlistPlayer.destroy()};ZaptionPlayer.prototype.loadPlaylist=
ZaptionPlayer.prototype.load=function(a,c){var b=this;b._destroyed||(b.playlist=a||ko.observableArray(),b.playlist.subscribe(function(){b.refreshPlaylist()}),b.refreshPlaylist(),b.playlistPlayer.load(a),c&&b.setCurrentItem(c),b.on("ended",function(){(screenfull.isFullscreen||window.isTabletFullscreen||window.isFakeFullscreen)&&b.exitFullScreen()}))};ZaptionPlayer.prototype.refreshPlaylist=function(){if(!this._destroyed){d("refreshPlaylist()");for(var a=this.playlist()||[],c=0,b=0;b<a.length;b++)a[b].tourOffset=
c,this._prepareClip(a[b]),c+=a[b].duration();this.togglePlaybackRateButtons();this.refreshElements()}};ZaptionPlayer.prototype.refreshElements=function(){if(!this._destroyed&&this.isPlayerMode("construct")){d("Refresh elements");for(var a=0;a<this.playlist().length;a++)this._prepareElements(this.playlist()[a]),this.playlist()[a].elements._sortDirty=!0;this.clearElementsQueues();this.resetElementTriggers(this.currentTime(),!0);this.elementsTimeUpdate(!0)}};ZaptionPlayer.prototype.play=function(){d("play()");
var a=this;if(!a._destroyed&&a.curItem())return a._continuePastResponses(function(c){if(c){c=a._getPlayPauseControllers();var b=!0;c.forEach(function(a){b&&!a.play()&&(b=!1)});b&&(c.forEach(function(b){a.dequeueElement(b)}),a.isPaused(!1),a.playVideo())}})};ZaptionPlayer.prototype.playVideo=function(){this._destroyed||(this.playlistPlayer.isEnded?this.playlistPlayer.dispatchEvent("ended"):this.playlistPlayer.play())};ZaptionPlayer.prototype._getPlayPauseControllers=function(){var a=[];this.liveMainElements.controlsPlayPause()&&
a.push(this.liveMainElements.activeElement());this.liveSideElements.controlsPlayPause()&&a.push(this.liveSideElements.activeElement());return a};ZaptionPlayer.prototype._continuePastResponses=function(a){var c=this;if(!c.isPlayerMode("view"))return a(!0);var b=c._getPlayPauseControllers().map(function(a){return"Group"===a.elementType()&&a.activeChild()?a.activeChild():a});return b.length?b[0].canContinuePastResponse(c,function(e,f){return e?b[1]?b[1].canContinuePastResponse(c,a):a(e,f):a(e,f)}):a(!0)};
ZaptionPlayer.prototype.playUnlessBlocked=function(){if(!this.isPlayerMode("present")||this.isFullScreenMode())this.liveMainElements.stoppingVideo()||this.liveSideElements.stoppingVideo()||this.play()};ZaptionPlayer.prototype.pause=function(){d("pause()");if(this.curItem()){var a=!0;this._getPlayPauseControllers().forEach(function(c){c.pause()||(a=!1)});a&&(this.isPaused(!0),this.videoPause())}};ZaptionPlayer.prototype.videoPause=function(){this._destroyed||this.playlistPlayer.pause(!0)};ZaptionPlayer.prototype.seek=
function(a,c){if(!this._destroyed){d("seek("+a+", "+c+")");var b=this.timingManager.expectedTime();this.seek._playOnSeek=!!c;this.playlistPlayer.seek(a);a!==b&&(this._endAllStopVideoElements(),this.timingManager.expectedTime(a),this.resetElementTriggers(),this._updateTime())}};ZaptionPlayer.prototype.togglePlay=ZaptionPlayer.prototype.togglePause=function(){this._destroyed||(this.playing()?this.pause():this.play())};ZaptionPlayer.prototype.getState=function(){return this._destroyed?"DESTROYED":this.playlistPlayer.getState()};
ZaptionPlayer.prototype.playing=function(){return this._destroyed?!1:"PLAYING"===this.getState()};ZaptionPlayer.prototype.getBuffer=function(){return this._destroyed?0:this.playlistPlayer.getPropBuffered()};ZaptionPlayer.prototype.getFullPlaylist=function(){return this._destroyed?[]:this.playlist()};ZaptionPlayer.prototype.getPlaylist=function(){return this._destroyed?[]:this.playlist()};ZaptionPlayer.prototype.getPlaylistItem=function(a){return this._destroyed?null:0>a||a>=this.playlist().length?
this.curItem():this.playlist()[a]};ZaptionPlayer.prototype.getWidth=function(){return this._destroyed?0:this.el.width()};ZaptionPlayer.prototype.getHeight=function(){return this._destroyed?0:this.el.height()};ZaptionPlayer.prototype.getDuration=function(){return this._destroyed?0:this.playlistPlayer.getDuration()};ZaptionPlayer.prototype.currentTime=ZaptionPlayer.prototype.getPlayPosition=ZaptionPlayer.prototype.getPosition=function(){return this._destroyed||!this.curItem()?0:this.timingManager.expectedTime()};
ZaptionPlayer.prototype.volume=ZaptionPlayer.prototype.getVolume=function(){return this._destroyed?1:this.volume=this.playlistPlayer.getVolume()};ZaptionPlayer.prototype.setVolume=function(a){this._destroyed||(1<a?a=1:0>a&&(a=0),this.volume=a,this.playlistPlayer.setVolume(this.volume))};ZaptionPlayer.prototype.playbackRate=ZaptionPlayer.prototype.getPlaybackRate=function(){if(!this._destroyed)return this.playbackRate(this.playlistPlayer.getPlaybackRate()),this.playbackRate()};ZaptionPlayer.prototype.setPlaybackRate=
function(a){this._destroyed||(this.updateAriaStatus("Playback set to "+a+"x speed."),this.playbackRate(a),this.playlistPlayer.setPlaybackRate(a))};ZaptionPlayer.prototype.nextPlaybackRate=function(a){if(!this._destroyed){var c=this.playlistPlayer.getAvailablePlaybackRates(),b=this.getPlaybackRate(),e=c.indexOf(b);this.setPlaybackRate((a?c[e+1]:c[e-1])||b)}};ZaptionPlayer.prototype.togglePlaybackRateButtons=function(){if(!this._destroyed)if(this.playbackRateLocked)this.setPlaybackRate(1),this.hasPlaybackButtons(!1);
else{var a=1<this.playlistPlayer.getAvailablePlaybackRates().length;this.playbackRate(1);this.hasPlaybackButtons(a)}};ZaptionPlayer.prototype.rewind=function(){this._destroyed||this.seek(Math.max(0,this.currentTime()-5))};ZaptionPlayer.prototype.playRange=function(a,c){var b=this;if(!b._destroyed&&b.curItem()){b.seek(a,!0);var e=function(){b.currentTime()>=c&&(g(),b.pause())},f=function(){var e=b.currentTime();(e<a-1||e>=c)&&g()},g=function n(){b.playlistPlayer.off("timeupdate",e);b.off("ended",n);
b.playlistPlayer.off("error",n);b.playlistPlayer.off("pause",n);b.playlistPlayer.off("seeked",f)};b.playlistPlayer.on("timeupdate",e);b.on("ended",g);b.playlistPlayer.on("error",g);b.playlistPlayer.on("pause",g);b.playlistPlayer.on("seeked",f)}};ZaptionPlayer.prototype.getFullScreen=ZaptionPlayer.prototype.getFullscreen=function(){return this._destroyed?!1:void 0!==document.fullScreen?document.fullScreen:!1};ZaptionPlayer.prototype._fullScreenMouseMove=function(){var a=this.isPlayerMode("view","preview",
"present")?this.el.parent():this.el;if(a.hasClass("full-screen")){var c=a.find(".player-controls.full-screen");clearTimeout(this._fullScreenMouseMove._timeout);this._fullScreenMouseMove._timeout=null;this._fullScreenMouseMove._timeout=setTimeout(function(){c.hasClass("full-screen")&&c.fadeOut()},3E3);c.fadeIn()}};ZaptionPlayer.prototype.goFullScreenVideo=function(){var a=this;if(!a._destroyed&&a.curItem())if(a.fullScreenMode="video",a.isFullScreenMode(!0),$(".zEWidget-launcher, .shadow").fadeOut("fast"),
a.fullScreenAvailable){var c=a.el.parent();c.addClass("full-screen");screenfull.request(c[0])}else ZAP.is.android&&ZAP.is.mobile&&screen.orientation&&screen.orientation.lock("landscape"),a.isPlayerMode("present")?($("body").addClass("presenter-fake-fullscreen"),a.viewModel.showFullScreenCloseButton(!0)):($("body").addClass("generic-fake-fullscreen"),c=a.liveSideElements.activeElement()?316:null,$(window).on("resize.fixfullscreen",function(){var b=a.liveSideElements.activeElement()?316:null;ZAP.player.centerFullScreenVideo($(window).width(),
$(window).height(),46,b)}),ZAP.player.centerFullScreenVideo($(window).width(),$(window).height(),46,c),$(".video-player").on("transitionend webkitTransitionEnd oTransitionEnd msTransitionEnd",function(){$(window).trigger("resize")}),c="fake-full-screen",window.isTablet?(c="tablet",window.isTabletFullscreen=!0):window.isFakeFullscreen=!0,a.el.parent().addClass(c).addClass("full-screen"),$(".player-cutoff, .player-controls").addClass(c).addClass("full-screen"))};ZaptionPlayer.prototype.exitFullScreen=
function(){this._destroyed||(this.isFullScreenMode(!1),$(".zEWidget-launcher, .shadow").fadeIn().css("display",""),this.isPlayerMode("present")?($("body").removeClass("presenter-fake-fullscreen"),this.viewModel.showFullScreenCloseButton(!1),this.viewModel.isAttendeeListVisible(!1)):$("body").removeClass("generic-fake-fullscreen"),this.fullScreenAvailable?screenfull.exit():(ZAP.is.android&&ZAP.is.mobile&&screen.orientation&&screen.orientation.lock("portrait").then(function(){screen.orientation.unlock()}),
$(".video-player").css({width:"",height:"",top:""}),$(window).off("resize.fixfullscreen"),$(".video-player").off("transitionend webkitTransitionEnd oTransitionEnd msTransitionEnd"),this.el.parent().removeClass("tablet full-screen fake-full-screen"),$(".player-cutoff, .player-controls").removeClass("tablet full-screen fake-full-screen"),window.isTablet?window.isTabletFullscreen=!1:window.isFakeFullscreen=!1))};ZaptionPlayer.prototype.toggleFullScreenVideo=function(){!this._destroyed&&this.isPlayerMode("view",
"preview","present","video-view")&&(this.isFullScreenMode()?this.exitFullScreen():(this.goFullScreenVideo(),window.isTablet&&setImmediate(function(){window.scrollTo(0,1)})))};ZaptionPlayer.prototype.muted=ZaptionPlayer.prototype.getMute=function(){return this._destroyed?!1:this.playlistPlayer.getMute()};ZaptionPlayer.prototype.mute=function(){this._destroyed||(this.muted=!0,this.controlBar.find(".volume").addClass("muted"),this.playlistPlayer.setMute(this.muted))};ZaptionPlayer.prototype.unmute=function(){this._destroyed||
(this.muted=!1,this.controlBar.find(".volume").removeClass("muted"),this.playlistPlayer.setMute(this.muted))};ZaptionPlayer.prototype.toggleMute=function(){this._destroyed||((this.muted=!this.muted)?this.controlBar.find(".volume").addClass("muted"):this.controlBar.find(".volume").removeClass("muted"),this.playlistPlayer.setMute(this.muted))};ZaptionPlayer.prototype.playlistNext=ZaptionPlayer.prototype.nextItem=function(a){this._destroyed||this.playlistPlayer.skipPlaylistForward(a)};ZaptionPlayer.prototype.playlistPrev=
ZaptionPlayer.prototype.prevItem=function(a){this._destroyed||this.playlistPlayer.skipPlaylistBackward(a)};ZaptionPlayer.prototype.prevItemsLastElement=function(a){this._destroyed||(this.playlistPlayer.skipPlaylistBackward(a),this._sortElements(this.curItem()),(a=this.curItem().elements.sorted)&&0<a.length&&((a=_.last(a))&&"Group"===a.elementType()&&a.filteredChildren().length&&(a=_.last(a.filteredChildren())),this.goToElement(a)))};ZaptionPlayer.prototype.resetOrPrev=function(a){this._destroyed||
(void 0===a&&(a=!this.isPaused()),2>this.currentTime()&&0!==this.playlistPlayer.curIndex?this.prevItemsLastElement(a):this.seek(0,a),this.playlistPlayer.curIndex?this.updateAriaStatus("Beginning of the video"):this.updateAriaStatus("Beginning of the Lesson "))};ZaptionPlayer.prototype.nextItemOrElement=function(){var a=this;if(a.curItem()){var c=a.activeMainBoxGroup();c&&c.activeChildIndex()+1<c.filteredChildren().length||(c=a.activeSidebarGroup())&&c.activeChildIndex()+1<c.filteredChildren().length||
(c=!1);if(c)c.next();else return a._continuePastResponses(function(b){if(b)if(0<a.liveMainElements.inactiveElements().length)a.liveMainElements.remove(a.liveMainElements.activeElement());else if(0<a.liveSideElements.inactiveElements().length)a.liveSideElements.remove(a.liveSideElements.activeElement());else{a._sortElements(a.curItem());var e;b=a.curItem().elements.sorted;for(var c=a.currentTime(),g=b.length-1;0<=g&&!(c>b[g].inTime()||b[g]._triggered);g--)e=b[g];b=e?_(a.playlist()).find(function(a){return a._id===
e.clip()}):null;e&&b&&a.navigationDisabledForward&&e.inTime()+b.tourOffset>a.furthestTimeViewed()&&(e=null);a._endAllStopVideoElements();e?a.goToElement(e):((b=a.playlist()[a.playlistPlayer.curIndex+1])&&a.navigationDisabledForward&&b.tourOffset>a.furthestTimeViewed()&&(b=null),b?(a.updateAriaStatus("Beginning of the next video"),a.playlistNext()):(b=a.navigationDisabledForward?a.furthestTimeViewed()-a.curItem().tourOffset:a.curItem().outTime(),0.5<b-a.currentTime()&&(a.seek(b),a.updateAriaStatus("End of the Lesson. You may now rate this lesson or review your responses."))))}})}else a.playlistPlayer.setPlaylistIndex(0)};
ZaptionPlayer.prototype.prevItemOrElement=function(){if(this.curItem()){var a=this.activeSidebarGroup();a&&0<a.activeChildIndex()||(a=this.activeMainBoxGroup())&&0<a.activeChildIndex()||(a=!1);if(a)a.prev();else if(0<this.liveMainElements.inactiveElements().length)this.liveMainElements.remove(this.liveMainElements.activeElement());else if(0<this.liveSideElements.inactiveElements().length)this.liveSideElements.remove(this.liveSideElements.activeElement());else{this._sortElements(this.curItem());for(var c,
a=this.curItem().elements.sorted,b=this.currentTime(),e=a.length-1;0<=e;e--)if((b>a[e].inTime()||a[e]._triggered)&&!a[e].active()){c=a[e];break}c&&"Group"===c.elementType()&&c.filteredChildren().length&&(c=_.last(c.filteredChildren()));this._endAllStopVideoElements();c?this.goToElement(c):this.resetOrPrev()}}else this.playlistPlayer.setPlaylistIndex(0)};ZaptionPlayer.prototype.setCurrentItem=function(a,c){if(!this._destroyed){if("object"===typeof a)a=$.inArray(a,this.playlist());else if("string"===
typeof a)for(var b=0,e=this.playlist(),b=0;b<e.length;b++)if(String(e[b]._id)===a){a=b;break}"number"!==typeof a||0>a||a>=this.playlist().length?(window.trackJs.track(Error("Warning: item is not in playlist, unable to switch (trying to switch to "+a+").")),console.log("Warning: item is not in playlist, unable to switch (trying to switch to "+a+").")):this.playlistPlayer.setPlaylistIndex(a,c)}};ZaptionPlayer.prototype.getCurrentItem=function(){if(this._destroyed)return null;if(this.curItem())return this.curItem()};
ZaptionPlayer.prototype.endowControlBar=function(a){var c=this;a=$(a);c.controlBar=c.controlBar.add(a);var b=a.find(".prev"),e=a.find(".pause"),f=a.find(".play"),g=a.find(".next"),d=a.find(".cc"),n=a.find(".volume"),k=a.find(".rate-up"),l=a.find(".rate-down"),q=a.find(".rewind"),r=a.find(".fullscreen"),t=a.find(".seekbar");b.on("click",function(){c.prevItemOrElement();return!1});e.on("click",function(){c.pause();return!1});f.on("click",function(){c.play();return!1});g.on("click",function(){c.nextItemOrElement();
return!1});q.on("click",function(){c.rewind();return!1});d.on("click",function(){c.toggleSubtitles();return!1});n.on("click",function(){c.toggleMute();return!1});k.on("click",function(){c.nextPlaybackRate(!0);return!1});l.on("click",function(){c.nextPlaybackRate(!1);return!1});r.on("click",function(){c.toggleFullScreenVideo();return!1});_.each(t,c.endowSeekBar,c);c.isPlayerMode("view")||(a.find(".currentTime").text(ZAP.util.secondsToTimestamp(c.currentTime())),a.find(".duration").text(ZAP.util.secondsToTimestamp(c.getDuration())));
if(a.hasClass("video-player-controls")){e.hide();var w=function(){var b=(a.hasClass("full-screen")?window.screen.width:a.width())-a.find(".left-controls-section").width()-a.find(".right-controls-section").width()+a.find(".seekbar").width()-2;t.css("width",b+"px")};setTimeout(w,0);c.on("switchedplaylistitem",function(){setTimeout(w,0)})}c._updateTime()};ZaptionPlayer.prototype.clearControlBarEventHandlers=function(){this.controlBar.find(".prev, .pause, .play, .next, .cc, .volume, .rate-up, .rate-down, .rewind, .fullscreen, .seekbar").off("click")};
ZaptionPlayer.prototype.endowSeekBar=function(a,c){var b=this;a=$(a);b.seekBar=b.seekBar.add(a);c||(c=0);a.off("selectstart");a.on("selectstart",function(){return!1});a.on("vmousedown",function(e){if(!a.data("stopSeek")){var f=a.offset().left,g=a[0].getBoundingClientRect().width,d=b.currentTimeOnTour(),n=!1,k=!1;b._seeking=!0;if(b.isPlayerMode("view","present")){var l=Math.max(Math.min((e.pageX-(f+c))/(g-c),1),0)*b.viewModel.tour().totalDuration();if(b.navigationDisabledForward&&l>b.furthestTimeViewed())return}b.isPaused()||
b.videoPause();var q=function(a){k=n=!1;b.playlistPlayer.off("seeked",r);b.playlistPlayer.on("seeked",r);var e=(a.pageX-(f+c))/(g-c),d=b.isPlayerMode("view","preview","present")?b.viewModel.tour().totalDuration():b.getDuration();if(!isNaN(d))if(0>e&&(e=0),1<e&&(e=1),a=e*d,b.isPlayerMode("view","preview","present")){b.isPlayerMode("view","present")&&b.navigationDisabledForward&&a>b.furthestTimeViewed()&&(a=b.furthestTimeViewed());for(d=e=b.playlistPlayer.curIndex;e<b.playlist().length&&a>b.playlist()[e].tourOffset&&
a>b.playlist()[e].tourOffset+b.playlist()[e].duration();)e++;for(;0<e&&a<b.playlist()[e].tourOffset;)e--;e!==d&&b.setCurrentItem(e,!b.isPaused());b.seek(a-b.playlist()[e].tourOffset)}else a=e*d,b.isPlayerMode("construct")&&b.viewModel.croppingClip()&&(a<b.viewModel.cropperInTime()?a=b.viewModel.cropperInTime():a>b.viewModel.cropperOutTime()&&(a=b.viewModel.cropperOutTime())),b.seek(a)},r=function w(){b.playlistPlayer.off("seeked",w);k=!0;!b.isPaused()&&n?(b._seeking=!1,b.play(),b._declareSeek(d,b.currentTimeOnTour())):
n&&(b._seeking=!1,b._declareSeek(d,b.currentTimeOnTour()))};q(e);$(document).on("vmousemove",q);$(document).on("vmouseup",function D(){n=!0;$(document).off("vmousemove",q);$(document).off("vmouseup",D);!b.isPaused()&&k?(b._seeking=!1,b.play(),b._declareSeek(d,b.currentTimeOnTour())):k&&(b._seeking=!1,b._declareSeek(d,b.currentTimeOnTour()))})}})};ZaptionPlayer.prototype.clearSeekBarEventHandlers=function(){this.seekBar.off()};ZaptionPlayer.prototype._declareSeek=function(a,c){this.viewModel&&this.isPlayerMode("view")&&
(a<c?this.isPlayerMode("view")&&this.historian.trackEvent("clipSkippedForward",{clipId:this.curItem()._id}):a>c&&this.isPlayerMode("view")&&this.historian.trackEvent("clipSkippedBackward",{clipId:this.curItem()._id}))};ZaptionPlayer.prototype._prepareClip=function(a){var c=this;if(!c._destroyed)return a.inTime(a.inTime()||0),a.outTime(a.outTime()||a.duration()||a.videoDuration()),c._prepareElements(a),a._zpPrepared||(a._zpId="zplayer-"+(new Date).getTime()+"-"+(1E6*Math.random()).toFixed(),a.elements.subscribe(function(){c.refreshElements()}),
a.elements._sortDirty=!0,a._zpPrepared=!0),a};ZaptionPlayer.prototype._sortElements=function(a){a.elements._sortDirty&&(a.elements.sorted=a.elements.slice().sort(function(a,b){return a.inTime()!==b.inTime()?a.inTime()-b.inTime():a.outTime()!==b.outTime()?a.outTime()-b.outTime():a.removeAfter()!==b.removeAfter()?a.removeAfter()-b.removeAfter():a.stopVideo()!==b.stopVideo()?a.stopVideo()?-1:1:b.dateCreated()-a.dateCreated()}),a.elements._sortDirty=!1)};ZaptionPlayer.prototype._prepareElements=function(a){var c=
this;if(!c._destroyed){var b=a.elements()||[];$.each(b,function(b,f){c._prepareElement(a,f)});return b}};ZaptionPlayer.prototype._prepareElement=function(a,c){var b=this;if(!b._destroyed&&c){"Group"===c.elementType()&&_.each(c.filteredChildren(),function(e){b._prepareElement(a,e)});c.options(c.options()||{});b._addElementProperties(c);if(c._zpPrepared)return c;c._zpSubscribed||(c._zpSubscribed=!0,c.inTime.subscribe(function(){b.refreshElements()}),c.outTime.subscribe(function(){b.refreshElements()}),
c.stopVideo.subscribe(function(){b.refreshElements()}),c.removeAfter.subscribe(function(){b.refreshElements()}),c.behavior.subscribe(function(){b.refreshElements()}),c.space.subscribe(function(){c._zpPrepared=!1;b.refreshElements()}),"Group"===c.elementType()&&c.filteredChildren.subscribe(function(){c._zpPrepared=!1;b.refreshElements()}));switch(c.space()){case "Sidebar":b._prepareSidebarElement(c);break;case "MainBox":b._prepareMainBoxElement(c)}}};ZaptionPlayer.prototype._addElementProperties=function(a){var c=
this;a&&!a._hasElementProperties&&(a.tourInTime=ko.computed(function(){var b=_.findWhere(c.playlist(),{_id:a.clip()});return b?b.tourOffset+a.inTime():0}),a.timer=ko.observable(0),a.startTimer=function(){a.interval=setInterval(function(){a.timer(a.timer()+1E3)},1E3)},a.stopTimer=function(){clearInterval(a.interval)},a.isPresentation=ko.computed(function(){return c.isPlayerMode("present")}),a.isAnswerVisible=ko.observable(!1),a.areResponsesVisible=ko.observable(!1),a.showRespondDevice=ko.observable(!0),
"DrawnResponse"===a.elementType()&&(a.showPlaceholder=ko.computed(function(){if(!a.response())return!0;try{return 0===JSON.parse(a.response()).objects.length}catch(b){return!0}})),a.getChoicePercentage=function(b){b=a.aggregatedResponses().data[b]||0;var e=a.aggregatedResponses().total||1;return parseInt(100*b/e)+"%"},c.isPlayerMode("present")&&a.isResponseElement()&&0===a.presentationResponses().length&&(a.aggregatedResponses=ko.computed(function(){var b={},e=0;switch(a.elementType()){case "CheckBoxes":_.each(a.presentationResponses(),
function(a){_.each(a.checkedChoices||a.checked,function(a){b[a]=b[a]?b[a]+1:1;e+=1})});break;case "MultipleChoice":_.each(a.presentationResponses(),function(a){b[a.choice]=b[a.choice]?b[a.choice]+1:1;e+=1})}return{data:b,total:e}})),a._hasElementProperties=!0)};ZaptionPlayer.prototype._sanitizeElement=function(a){this.isPlayerMode("view")&&a.find('a[target="_blank"]').each(function(){0>this.rel.indexOf("noreferrer")&&(this.rel+=" noreferrer")});return a};ZaptionPlayer.prototype._prepareSidebarElement=
function(a){var c=this,b=c.getElementType(a.elementType());if(!b)throw Error("Element type does not exist");-1===$.inArray("Sidebar",b.spaces)&&log("Element type not allowed in this space");a.activated=function(){a.startTimer();c.isPlayerMode("present")&&!c.liveMainElements.activeElement()&&c.viewModel.sidebarMinimized(!1);c.isPlayerMode("present")&&a.isResponseElement()&&0===a.presentationResponses().length&&amplify.request({resourceId:"presentationElementResponses",data:{presentationId:c.viewModel.presentation._id,
elementId:a._id},success:function(b){a.presentationResponses(b)}});var e=b.name;c.isPlayerMode("construct")&&(e+="ConstructPane");c.isPlayerMode("present")||"video"!==c.fullScreenMode||ZAP.player.centerFullScreenVideo($(window).width(),$(window).height(),46,316);a.areResponsesVisible(!1);a.isAnswerVisible(!1);a.showRespondDevice(!0);if(c.isPlayerMode("present")&&a.comments()){var f=_.filter(a.comments(),function(a){return a.presentation()===c.viewModel.presentation._id});a.comments(f)}dust.render(e,
{},function(e,f){a.options().overlay=$(f);c.activeSidebarGroup()&&"Group"!==a.elementType()?(c.sidebar.find(".child-element-content").append(a.options().overlay),a.options().overlay.css("position","static")):c.sidebar.append(a.options().overlay);if("Stop"===a.behavior()){a.wasPausedOnStart=c.isPaused();if(a.removeAfter()||"Video"===a.elementType())c.ignoreNextPause=!0;c.pause()}var d=ko.contextFor($("body")[0]).createChildContext(c.curItem()),d=d.createChildContext(a);ko.applyBindings(d,a.options().overlay[0]);
!$.fn.placeholder.input&&!$.fn.placeholder.textarea&&-1<f.indexOf("placeholder=")&&a.options().overlay.find("input, textarea").placeholder();(d=c.activeGroupWithElement(a))&&d.active()&&d.options().childElementActivated(a);c.updateAriaStatus("Showing <var type>"+a.displayType()+"</var> element: <var description>"+_.escape(a.plainTextPrompt())+"</var>");$("#sidebar").find("input, textarea, select, button").filter(":first").focus();a.options().overlay=c._sanitizeElement(a.options().overlay);b.activated(c,
a,a.options());c.isPlayerMode("present")&&a.isResponseElement()&&(setImmediate(function(){var b=a.options().overlay.find(".element-content-inner > form");b.length&&a.showRespondDevice(b[0].scrollHeight<=b.height())}),d=a.toJSON(),c.channel.elementActivated(d));c.isPlayerMode("present")&&ZAP.ui.adjustFontSize(a.options().overlay.find('[style*="font-size"]'))})};a.deactivated=function(){a.stopTimer();ko.removeNode(a.options().overlay[0]);a.options().overlay.remove();b.deactivated(c,a,a.options());var e=
c.activeGroupWithElement(a);e&&e.active()?(e.options().childElementDeactivated(a),$("#sidebar").find("input, textarea, select, button").filter(":first").focus()):c.isPlayerMode("present")?c.viewModel.sidebarMinimized(!0):("video"===c.fullScreenMode&&ZAP.player.centerFullScreenVideo($(window).width(),$(window).height(),46),$(".player-controls").focus(),c.updateAriaStatus(""));c.isPlayerMode("present")&&a.isResponseElement()&&c.channel.elementDeactivated(a.toJSON())};a.pause=function(){if(b.pause){var e=
b.pause(c,a,a.options());return void 0!==e?e:!0}return!0};a.play=function(){if(b.play){var e=b.play(c,a,a.options());return void 0!==e?e:!0}return!0};a.next=function(){if(b.next){var e=b.next(c,a,a.options());return void 0!==e?e:!0}return!0};a.prev=function(){if(b.prev){var e=b.prev(c,a,a.options());return void 0!==e?e:!0}return!0};a._zpPrepared=!0;return a};ZaptionPlayer.prototype._prepareMainBoxElement=function(a){var c=this,b=c.getElementType(a.elementType());if(!b)throw Error("Element type does not exist");
-1===$.inArray("MainBox",b.spaces)&&log("Element type not allowed in this space");var e=b.name;c.isPlayerMode("construct")&&(e+="ConstructPane");a.activated=function(){a.startTimer();c.isPlayerMode("present")&&c.liveSideElements.activeElement()&&c.viewModel.sidebarMinimized(!0);c.isPlayerMode("present")&&a.isResponseElement()&&0===a.presentationResponses().length&&amplify.request({resourceId:"presentationElementResponses",data:{presentationId:c.viewModel.presentation._id,elementId:a._id},success:function(b){a.presentationResponses(b)}});
a.areResponsesVisible(!1);a.isAnswerVisible(!1);a.showRespondDevice(!0);dust.render(e,{},function(e,g){a.options().overlay=$(g);a.options().overlay.on("click",function(a){$("body").trigger("close-dropdown");a.stopPropagation()});a.options().overlay.on("keydown",function(a){a.stopPropagation()});c.activeMainBoxGroup()&&"Group"!==a.elementType()?(c.mainOverlay.find(".child-element-content").append(a.options().overlay),a.options().overlay.css("position","static")):c.mainOverlay.append(a.options().overlay);
var d=ko.contextFor($("body")[0]).createChildContext(c.curItem()),d=d.createChildContext(a);ko.applyBindings(d,a.options().overlay[0]);!$.fn.placeholder.input&&!$.fn.placeholder.textarea&&-1<g.indexOf("placeholder=")&&a.options().overlay.find("input, textarea").placeholder();if("Stop"===a.behavior()){a.wasPausedOnStart=c.isPaused();if(a.removeAfter()||"Video"===a.elementType())c.ignoreNextPause=!0;c.pause()}(d=c.activeGroupWithElement(a))&&d.active()&&d.options().childElementActivated(a);setImmediate(function(){c.updateAriaStatus("Showing <var type>"+
a.displayType()+"</var> element: <var description>"+_.escape(a.plainTextPrompt())+"</var>");$("#overlay").find("input, textarea, select, button").filter(":first").focus()});a.options().overlay=c._sanitizeElement(a.options().overlay);b.activated(c,a,a.options());c.isPlayerMode("present")&&a.isResponseElement()&&(setImmediate(function(){var b=a.options().overlay.find(".element-content-inner > form");b.length&&a.showRespondDevice(b[0].scrollHeight<=b.height())}),d=a.toJSON(),c.channel.elementActivated(d));
c.isPlayerMode("present")&&ZAP.ui.adjustFontSize(a.options().overlay.find('[style*="font-size"]'))})};a.deactivated=function(){a.stopTimer();ko.removeNode(a.options().overlay[0]);a.options().overlay.remove();b.deactivated(c,a,a.options());var e=c.activeGroupWithElement(a);e&&e.active()?(e.options().childElementDeactivated(a),$("#overlay").find("input, textarea, select, button").filter(":first").focus()):(e=$("#sidebar").find("input, textarea, select, button").filter(":first:not(#discussionCommentInput)"),
e.length?e.focus():($(".player-controls").focus(),c.updateAriaStatus("")));c.isPlayerMode("present")&&a.isResponseElement()&&c.channel.elementDeactivated(a.toJSON())};a.pause=function(){if(b.pause){var e=b.pause(c,a,a.options());return void 0!==e?e:!0}return!0};a.play=function(){if(b.play){var e=b.play(c,a,a.options());return void 0!==e?e:!0}return!0};a.next=function(){if(b.next){var e=b.next(c,a,a.options());return void 0!==e?e:!0}return!0};a.prev=function(){if(b.prev){var e=b.prev(c,a,a.options());
return void 0!==e?e:!0}return!0};a._zpPrepared=!0;return a};ZaptionPlayer.prototype.activeMainBoxGroup=function(){return this.liveMainElements.activeElement()&&"Group"===this.liveMainElements.activeElement().elementType()?this.liveMainElements.activeElement():null};ZaptionPlayer.prototype.activeSidebarGroup=function(){return this.liveSideElements.activeElement()&&"Group"===this.liveSideElements.activeElement().elementType()?this.liveSideElements.activeElement():null};ZaptionPlayer.prototype.activeGroupWithElement=
function(a){return this.activeMainBoxGroup()&&this.activeMainBoxGroup().containsElement(a)?this.activeMainBoxGroup():this.activeSidebarGroup()&&this.activeSidebarGroup().containsElement(a)?this.activeSidebarGroup():null};ZaptionPlayer.prototype._loadChildElement=function(a){var c=this.activeGroupWithElement(a);c&&c.active()&&c.activeChild()!==a&&a.activated()};ZaptionPlayer.prototype._updateDrawingOffsets=function(){[this.liveMainElements,this.liveSideElements].forEach(function(a){a.activeElement()&&
a.activeElement().options()&&a.activeElement().options().simpleDraw&&a.activeElement().options().simpleDraw.updateOffset()})};ZaptionPlayer.prototype._hideSidebar=function(){this.sidebar&&(this.sidebar.stop(!0,!1),this.isPlayerMode("view","preview","present")&&(this.sidebar.parent().removeClass("expanded"),this.sidebar.closest(".preview-tour-modal").removeClass("expanded"),this.sidebar.parent().one("transitionend webkitTransitionEnd oTransitionEnd msTransitionEnd",this._updateDrawingOffsets.bind(this))))};
ZaptionPlayer.prototype._showSidebar=function(){this.sidebar&&(this.sidebar.stop(!0,!1),this.isPlayerMode("view","preview","present")&&(this.sidebar.parent().addClass("expanded"),this.sidebar.closest(".preview-tour-modal").addClass("expanded"),this.sidebar.parent().one("transitionend webkitTransitionEnd oTransitionEnd msTransitionEnd",this._updateDrawingOffsets.bind(this))))};ZaptionPlayer.prototype._loadNextElement=function(a,c){if(this.curItem()){var b;"Sidebar"===c?b=this.liveSideElements:"MainBox"===
c&&(b=this.liveMainElements);for(var e=this.curItem().elements(),f=this.currentTime(),g,d=0;d<e.length;d++){var n=e[d];if(n.inTime()<a.inTime()||n.outTime()<a.outTime()||n._id===a._id||b.contains(n))return;if(!g||n.inTime()<g.inTime())g=n}g&&g.inTime()-1<=f&&this.loadElement(g)}};ZaptionPlayer.prototype._endAllStopVideoElements=function(){d("Ending all stopVideo elements");[this.liveMainElements,this.liveSideElements].forEach(function(a){var c=[];a().forEach(function(a){a.stopVideo()&&c.push(a)});
c.forEach(function(b){a.remove(b)})})};ZaptionPlayer.prototype.clearElementsQueues=function(){this._destroyed||(this.liveSideElements.clear(),this.liveMainElements.clear())};ZaptionPlayer.prototype.goToPosition=function(a,c){this._destroyed||("string"===typeof a&&(a=_.find(this.playlist(),function(b){return b._id===a})),this.curItem()&&a===this.curItem()||this.setCurrentItem(a),"number"===typeof c&&this.seek(c))};ZaptionPlayer.prototype.goToElement=function(a){var c=this;if(!c._destroyed){c.resumeElementsQueues();
if("string"===typeof a&&(a=function f(a,b){for(var c=0;c<a.length;c++){if(String(a[c]._id)===b)return a[c];var d=f(a[c].filteredChildren(),b);if(d)return d}return null}(c.viewModel&&c.viewModel.tour&&c.viewModel.tour().filteredElements()||c.curItem().elements(),a),!a))return;c.curItem()&&a.clip()===c.curItem()._id||c.setCurrentItem(a.clip());var b=c.isPaused()||a.stopVideo()&&!a.removeAfter();c.playlistPlayer.on("seeked",function g(){c.playlistPlayer.off("seeked",g);c.loadElement(a)});c.seek(a.inTime(),
!b)}};ZaptionPlayer.prototype.loadElement=function(a){!this._destroyed&&this.curItem()&&this.curItem()._id===a.clip()&&(a._parent()&&a._parent().elementType&&"Group"===a._parent().elementType()?(a._parent()._triggered=!0,this.enqueueElement(a._parent()),this._loadChildElement(a)):(a._triggered=!0,this.enqueueElement(a,!0)))};ZaptionPlayer.prototype.elementIsLoaded=function(a){if(this._destroyed)return!1;if("MainBox"===a.space())return this.liveMainElements.contains(a);if("Sidebar"===a.space())return this.liveSideElements.contains(a)};
ZaptionPlayer.prototype.resetElementTriggers=function(a,c){if(!this._destroyed&&this.curItem()){d("Reset element triggers from "+a+" (including active: "+c+")");this.elementsTimeUpdate.lastUpdate=void 0;void 0===a&&(a=this.currentTime());this.nextInterestingTime=a;for(var b=this.curItem().elements(),e=0;e<b.length;e++){var f=b[e];f.active()&&!f.stopVideo()&&f.inTime()<=a&&f.outTime()>=a&&!c||!(f.outTime()>=a)||(f._triggered=!1)}this.curItem()._showedEndingElements=!1;this.elementsTimeUpdate(!0)}};
ZaptionPlayer.prototype.elementsTimeUpdate=function(a){var c=this;if(!c._destroyed&&c.curItem()){var b=Math.min(c.currentTime(),c.getDuration());if(!c.isPaused()&&c.elementsTimeUpdate.lastUpdate!==b||a){void 0===c.elementsTimeUpdate.lastUpdate&&(c.elementsTimeUpdate.lastUpdate=b);var e=c.curItem().elements(),f=[],g=function(a){return function(){a._triggered=!0;"Sidebar"===a.space()&&"Replay"===a.elementType()&&c.liveSideElements.contains(a)&&c.getElementType(a.elementType()).beforeRestart(c,a,a.options());
c.enqueueElement(a)}},d=function(a){return function(){if("Continue"===a.behavior()||"Stop"===a.behavior()||"Pause"===a.behavior())"Replay"===a.elementType()&&a.pauseAtEnd&&c.liveSideElements.contains(a)?b>=a.outTime()-0.2&&b<=a.outTime()+0.4?(c.pause(),c.getElementType(a.elementType()).shouldEnd(c,a,a.options())):(c.dequeueElement(a),c._loadNextElement(a,a.space())):(c._loadNextElement(a,a.space()),c.dequeueElement(a))}},n=Number.POSITIVE_INFINITY;for(a=0;a<e.length;a++){var k=e[a],l=c.elementIsLoaded(k)&&
!k.stopVideo()&&!c.curItem()._showedEndingElements,l=b===c.elementsTimeUpdate.lastUpdate?l&&(b<k.inTime()||b>k.outTime()):l&&b>k.outTime()&&c.elementsTimeUpdate.lastUpdate<=k.outTime(),q=!k._triggered&&!c.elementIsLoaded(k),q=b===c.elementsTimeUpdate.lastUpdate?q&&b>=k.inTime()&&b<=k.outTime():q&&b>=k.inTime()&&c.elementsTimeUpdate.lastUpdate<=k.inTime();b<k.inTime()?n=Math.min(n,k.inTime()):b<k.outTime()&&(n=Math.min(n,k.outTime()));l?f.unshift(d(k)):q&&f.push(g(k))}c.nextInterestingTime=Math.min(c.curItem().duration(),
n);c.elementsTimeUpdate.lastUpdate=b;for(a=0;a<f.length;a++)f[a]()}}};ZaptionPlayer.prototype.showEndingElements=function(){var a=this,c=[];a.curItem()._showedEndingElements=!0;var b=function(b){return function(){b._triggered=!0;"Sidebar"===b.space()&&"Replay"===b.elementType()&&a.liveSideElements.contains(b)&&a.getElementType(b.elementType()).beforeRestart(a,b,b.options());a.enqueueElement(b)}};a.curItem().elements().forEach(function(e){!e._triggered&&e.inTime()>a.getDuration()-0.25&&c.push(b(e))});
for(var e=0;e<c.length;e++)c[e]()};ZaptionPlayer.prototype.getPlaylistDuration=function(){if(this._destroyed)return 0;for(var a=0,c=this.playlist(),b=0;b<c.length;b++)a+=c[b].duration();return a};ZaptionPlayer.prototype.disableSubtitles=function(){this._destroyed||(this.subtitled=!1,this.controlBar.find(".cc").addClass("off"),this.playlistPlayer.setSubtitlesEnabled(this.subtitled))};ZaptionPlayer.prototype.enableSubtitles=function(){this._destroyed||(this.subtitled=!0,this.controlBar.find(".cc").removeClass("off"),
this.playlistPlayer.setSubtitlesEnabled(this.subtitled))};ZaptionPlayer.prototype.toggleSubtitles=function(){this._destroyed||(this.subtitled?this.disableSubtitles():this.enableSubtitles())};ZaptionPlayer.prototype.updateAriaStatus=function(a){$("#zaptionPlayerStatus").html(a)};ZaptionPlayer.prototype.hasElementsRemaining=function(){if(this.liveMainElements.stoppingVideo()||this.liveSideElements.stoppingVideo())return!0;var a=this.currentTimeOnTour(),c=!1;this.playlist().forEach(function(b){b.tourOffset+
b.duration()<a||b.elements().forEach(function(e){e.inTime()+b.tourOffset>a&&(c=!0)})});return c};ZaptionPlayer.prototype._updateTime=function(){if(this.curItem()){var a=this.timingManager.expectedTime();this.currentTimeOnTour(this.curItem().tourOffset+a);this.currentTimeOnClip(a);this.controlBar.find(".currentTime").text(ZAP.util.secondsToTimestamp(a));var c=this.getDuration(),b=Math.min(a/c,1),c=this.getBuffer(),e=Math.max(0,c-b);this.seekBar.each(function(a,c){var g=$(c),f=g.find(".seek-buffered"),
d=g.find(".seek-progress"),g=g.find(".elements-play-head");f.css("width",Math.floor(1E3*e)/10+"%");d.css("width",Math.floor(1E3*b)/10+"%");g.css("left",Math.floor(1E3*b)/10+"%")});a>this.nextInterestingTime&&this.elementsTimeUpdate();if(this.isPlayerMode("view")){this.furthestTimeViewed(Math.max(this.furthestTimeViewed(),this.currentTimeOnTour()));this.navigationDisabledForward&&0.5>this.furthestTimeViewed()-this.currentTimeOnTour()?$(".player-next-button-bg").addClass("disabled"):$(".player-next-button-bg").removeClass("disabled");
var a=5*Math.floor(this.currentTimeOnTour()/5),c=Math.round(Math.floor(a/60)),f=Math.round(a-60*c),g=window.minutesViewed&&window.minutesViewed[c]&&window.minutesViewed[c][f];!this.isPaused()&&!this._seeking&&0<a&&!g&&(window.minutesViewed[c]=window.minutesViewed[c]||{},window.minutesViewed[c][f]=!0,this.historian.trackEvent("spanViewed",{tourSecondsMark:a}));this.isFinished()||(a=this.hasElementsRemaining(),c=0.95<this.currentTimeOnTour()/this.viewModel.tour().totalDuration(),!a&&c&&(this.isFinished(!0),
this.historian.trackFinished()))}else this.isPlayerMode("construct")&&this.viewModel.croppingClip()&&this.currentTime()>this.viewModel.cropperOutTime()&&this.pause();this.dispatchEvent("timeupdate")}};ZaptionPlayer.prototype._switchedPlaylistItem=function(a){var c=this,b=c.playlistPlayer.curIndex,b=c.playlist()[b],e=c.curItem();window.isTablet&&e&&(e._id===b._id?c.viewModel.needsTouchToPlay(window.isTablet&&c.viewModel.needsTouchToPlay()):c.viewModel.needsTouchToPlay(window.isTablet));if(e!==b||a)d("Switched playlist item, preparing things..."),
c.clearElementsQueues(),c.timingManager.expectedTime(0),c.timingManager.actualTime(0),c.pauseElementsQueues(),c.curItem(b),c.controlBar.find(".duration").text(ZAP.util.secondsToTimestamp(c.getDuration())),c.resetElementTriggers(0,!0),c.isPlayerMode("view","preview","present")&&!e||c.resumeElementsQueues(),c._updateTime(),c._onPause(),c.elementsTimeUpdate(!0),c.durationSubscription&&c.durationSubscription.dispose(),b&&(c.durationSubscription=b.duration.subscribe(function(){c.controlBar.find(".duration").text(ZAP.util.secondsToTimestamp(c.getDuration()))})),
"video"===c.fullScreenMode&&(a=c.isPlayerMode("view","preview","present")?c.el.parent():c.el,"YouTube"===b.videoType()?a.find(".interception-overlay").css("height",window.screen.height-100+"px"):a.find(".interception-overlay").css("height","100%")),c.dispatchEvent("switchedplaylistitem")};ZaptionPlayer.prototype._onPause=function(){d("_onPause()");this.ignoreNextPause||this._seeking?this.ignoreNextPause=!1:(this.isPaused(!0),this.dispatchEvent("pause"))};ZaptionPlayer.prototype._bindInternalListeners=
function(){var a=this,c=null;a.timingManager.expectedTime.subscribe(function(){a._updateTime()});a.timingManager.on("seeked",function(){d('"Ghetto seek" detected, resetting element triggers.');a.resetElementTriggers()});var b=function(){var b=a.controlBar.find(".play"),c=a.controlBar.find(".pause");a.isPaused()?(c.hide(),b.show()):(b.hide(),c.show())};a.isPaused.subscribe(b);a.isPaused.subscribe(function(){a.isPaused()&&c?(clearInterval(c),c=null):a.isPaused()||c||(c=setInterval(function(){a.currentTime()>
a.nextInterestingTime&&a._updateTime()},10))});a.isPlayerMode("view","present")&&(a.isPaused.subscribe(function(){a.isPaused()?a.historian.stopTimeTracker():a.historian.startTimeTracker()}),a.isPaused()||a.historian.startTimeTracker());b();a.playlistPlayer.on("timeupdate",function(){a.timingManager.updateActualTime(a.playlistPlayer.getPosition())});a.playlistPlayer.on("itemwillend",function(){a.curItem()._showedEndingElements||a.showEndingElements()});a.playlistPlayer.on("seeked",function(){a._updateTime();
a.dispatchEvent("seeked")});a.playlistPlayer.on("ended",function(){a.liveMainElements.stoppingVideo()||a.liveSideElements.stoppingVideo()||(a.isPaused(!0),a._hideSidebar(),a.isPlayerMode("view","present")&&a.historian.sendHistoryData(),a.isPlayerMode("present")&&a.channel.end(!1),a.updateAriaStatus("End of the Lesson. You may now rate this lesson or review your responses."),a.dispatchEvent("ended"))});a.playlistPlayer.on("play",function(){d("_onPlay()");if(!a._seeking){var b=a.liveMainElements.stoppingVideo()||
a.liveSideElements.stoppingVideo();a.isPaused()&&b?a.videoPause():(a.isPaused(!1),window.isTablet&&(a.viewModel.needsTouchToPlay(!1),a.viewModel.clickedStartTour&&$(".tour-intro").hasClass("active")&&a.viewModel.clickedStartTour()),a.dispatchEvent("play"))}});a.playlistPlayer.on("pause",function(){a._onPause()});a.playlistPlayer.on("seeking",function(){a.dispatchEvent("seeking")});a.playlistPlayer.on("seeked",function(){!a.seek._playOnSeek||a.liveMainElements.active()||a.liveSideElements.active()&&
a.liveSideElements.activeElement().stopVideo()||a.playlistPlayer.play();a.dispatchEvent("seeked")});a.playlistPlayer.on("switchedplaylistitem",function(){a._switchedPlaylistItem()});a.playlistPlayer.on("durationchange",function(){a.controlBar.find(".duration").text(ZAP.util.secondsToTimestamp(a.getDuration()));a.refreshPlaylist();a._updateTime();a.dispatchEvent("durationchange")})};ZaptionPlayer.prototype._addKeyBindings=function(){var a=this,c=function(b){var e=_.contains(["input","textarea","select",
"button"],b.target.tagName.toLowerCase()),c="true"===b.target.contentEditable||$(b.target).parents("[contenteditable=true]").length;if(!(e||c||b.metaKey||b.ctrlKey||b.altKey||b.shiftKey)){e=!$(".orange-frame").is(":visible");switch(b.keyCode){case 13:$(".tour-intro").hasClass("active")&&!$("#skip").is(":focus")?a.viewModel.clickedStartTour():$("#skip").is(":focus")&&($.scrollTo("#bodyContentStart"),$("#bodyContentStart").focus());break;case 27:a.exitFullScreen();break;case 32:$("#skip").is(":focus")?
($.scrollTo("#bodyContentStart"),$("#bodyContentStart").focus()):a.isPlayerMode("present")?a.viewModel.isFullScreen()?a.togglePlay():a.viewModel.startPresentation():$(".tour-intro").hasClass("active")?a.viewModel.clickedStartTour():a.togglePlay();break;case 37:case 188:!a.navigationDisabled&&e&&(b.shiftKey?b.ctrlKey?a.seek(a.currentTime()-10):a.seek(a.currentTime()-0.5):a.prevItemOrElement());break;case 39:case 190:a.navigationDisabledForward||a.navigationDisabled||!e||(b.shiftKey?b.ctrlKey?a.seek(a.currentTime()+
10):a.seek(a.currentTime()+0.5):a.nextItemOrElement());break;case 38:a.setVolume(a.volume+0.1);break;case 40:a.setVolume(a.volume-0.1);break;case 77:a.toggleMute();break;case 70:a.toggleFullScreenVideo();break;case 187:a.nextPlaybackRate(!0);break;case 189:a.nextPlaybackRate(!1);break;case 84:$(".play-head:visible").trigger("mouseover");_.delay(function(){$(".play-head:visible").trigger("mouseout")},2E3);a.updateAriaStatus("You are at time "+ZAP.util.secondsToDurationString(a.currentTimeOnTour())+
" out of "+ZAP.util.secondsToDurationString(a.viewModel.tour().totalDuration()));break;default:return}b.preventDefault()}};$(document).keydown(c);$(document).on("reveal:open",".reveal-modal",function(){$(document).off("keydown",c)});$(document).on("reveal:close",".reveal-modal",function(){$(document).off("keydown",c).on("keydown",c)});a.el.on("click",function(){a.togglePlay()})};ZaptionPlayer.prototype.restartPlaylist=function(){var a=this;a.pauseElementsQueues();a.curItem()===a.playlist()[0]?(a.clearElementsQueues(),
a.pauseElementsQueues(),a.on("seeked",function b(){a.off("seeked",b);a._switchedPlaylistItem(!0)}),a.seek(0)):a.setCurrentItem(0)};ZaptionPlayer.prototype.sendElementResponse=function(a,c,b){var e=this;if(e.isPlayerMode("view")&&c){var f;switch(a.elementType()){case "TextResponse":f="addTextResponseAnswer";break;case "NumResponse":f="addNumResponseAnswer";break;case "DrawnResponse":f="addDrawnResponseAnswer";break;case "CheckBoxes":f="addCheckBoxesAnswer";break;case "MultipleChoice":f="addMultipleChoiceAnswer"}var g=
{tourId:e.viewModel.tour()._id,elId:a._id,viewerName:e.viewerName(),elementType:a.elementType(),fingerprint:window.fingerprint};window.ltiSessionId&&(g.ltiSessionId=window.ltiSessionId);$.extend(g,c);ZAP.player.standalone&&!ZAP.player.webhookUrl||amplify.request({resourceId:f,data:g,success:function(){"CheckBoxes"===a.elementType()?a.initialResponses(a.responses().slice()):a.initialResponse(a.response());window.currentUser||a.saveResponseLocally(window.fingerprint,e.viewerName())},error:function(b){setTimeout(function(){e.videoPause();
e.goToElement(a)},25);b.refresh?(window.trackJs&&window.trackJs.track(Error("CSRF failure forcing refresh on element submission.")),ZAP.showAlert("Your response could not been submitted, because you were logged out or something went wrong with your login session.",{afterClose:function(){window.location.reload()}})):(window.trackJs&&window.trackJs.track(Error("Element response submission failed with error: "+b.message)),ZAP.showAlert("Your response could not be submitted because an error occurred: "+
b.message))}})}var d,n;for(f=0;f<a.actions().length;f++)if(g=a.actions()[f],g.feedbackText()&&"CheckBoxes"===a.elementType()&&(n=!0),!d&&(g.appliesTo(c)||n)){g.execute(a,e,c);d=!0;break}b&&!d&&(e.dequeueElement(a),c="MainBox"===a.space()?e.liveSideElements:e.liveMainElements,c.stoppingVideo()&&(c=c.activeElement().activeChild()||c.activeElement(),c.isResponseElement()||e.dequeueElement(c)),e.playUnlessBlocked())};ZaptionPlayer.prototype.getElementType=function(a){for(var c=ZAP.elementTypes,b=c.length;b--;)if(c[b].name===
a)return c[b];return null};ZaptionPlayer.prototype.toggleNavigationForward=function(a){this.navigationDisabledForward=!a};ZaptionPlayer.prototype.toggleNavigation=function(a){this.navigationDisabled=!a;this.seekBar.toggleClass("disabled",!a);a=a?"off":"on";this.seekBar[a]("mousedown click",!1);this.seekBar.find(".play-head")[a]("mousedown click",!1);this.seekBar.find(".tour-element-markers *")[a]("mousedown click",!1)};ZaptionPlayer.prototype.toggleLockPlaybackRate=function(a){this.playbackRateLocked=
!!a;this.togglePlaybackRateButtons()};window.addEventHandling(ZaptionPlayer.prototype)})();var fabric=fabric||{version:"1.4.11"};"undefined"!==typeof exports&&(exports.fabric=fabric);"undefined"!==typeof document&&"undefined"!==typeof window?(fabric.document=document,fabric.window=window):(fabric.document=require("jsdom").jsdom("<!DOCTYPE html><html><head></head><body></body></html>"),fabric.window=fabric.document.createWindow());fabric.isTouchSupported="ontouchstart"in fabric.document.documentElement;
fabric.isLikelyNode="undefined"!==typeof Buffer&&"undefined"===typeof window;fabric.SHARED_ATTRIBUTES="display transform fill fill-opacity fill-rule opacity stroke stroke-dasharray stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width".split(" ");fabric.DPI=96;"object"!==typeof JSON&&(JSON={});
(function(){function d(a){return 10>a?"0"+a:a}function a(a){e.lastIndex=0;return e.test(a)?'"'+a.replace(e,function(a){var b=h[a];return"string"===typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function c(b,e){var d,h,t,w,D=f,E,y=e[b];y&&"object"===typeof y&&"function"===typeof y.toJSON&&(y=y.toJSON(b));"function"===typeof n&&(y=n.call(e,b,y));switch(typeof y){case "string":return a(y);case "number":return isFinite(y)?String(y):"null";case "boolean":case "null":return String(y);
case "object":if(!y)return"null";f+=g;E=[];if("[object Array]"===Object.prototype.toString.apply(y)){w=y.length;for(d=0;d<w;d+=1)E[d]=c(d,y)||"null";t=0===E.length?"[]":f?"[\n"+f+E.join(",\n"+f)+"\n"+D+"]":"["+E.join(",")+"]";f=D;return t}if(n&&"object"===typeof n)for(w=n.length,d=0;d<w;d+=1)"string"===typeof n[d]&&(h=n[d],(t=c(h,y))&&E.push(a(h)+(f?": ":":")+t));else for(h in y)Object.prototype.hasOwnProperty.call(y,h)&&(t=c(h,y))&&E.push(a(h)+(f?": ":":")+t);t=0===E.length?"{}":f?"{\n"+f+E.join(",\n"+
f)+"\n"+D+"}":"{"+E.join(",")+"}";f=D;return t}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+d(this.getUTCMonth()+1)+"-"+d(this.getUTCDate())+"T"+d(this.getUTCHours())+":"+d(this.getUTCMinutes())+":"+d(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var b,e,f,g,h,n;"function"!==typeof JSON.stringify&&(e=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
h={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(a,b,e){var d;g=f="";if("number"===typeof e)for(d=0;d<e;d+=1)g+=" ";else"string"===typeof e&&(g=e);if((n=b)&&"function"!==typeof b&&("object"!==typeof b||"number"!==typeof b.length))throw Error("JSON.stringify");return c("",{"":a})});"function"!==typeof JSON.parse&&(b=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,JSON.parse=function(a,
e){function c(a,b){var g,f,d=a[b];if(d&&"object"===typeof d)for(g in d)Object.prototype.hasOwnProperty.call(d,g)&&(f=c(d,g),void 0!==f?d[g]=f:delete d[g]);return e.call(a,b,d)}var g;a=String(a);b.lastIndex=0;b.test(a)&&(a=a.replace(b,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return g=
eval("("+a+")"),"function"===typeof e?c({"":g},""):g;throw new SyntaxError("JSON.parse");})})();
(function(){function d(a,b){this.__eventListeners[a]&&(b?fabric.util.removeFromArray(this.__eventListeners[a],b):this.__eventListeners[a].length=0)}function a(a,b){this.__eventListeners||(this.__eventListeners={});if(1===arguments.length)for(var c in a)this.on(c,a[c]);else this.__eventListeners[a]||(this.__eventListeners[a]=[]),this.__eventListeners[a].push(b);return this}function c(a,b){if(this.__eventListeners){if(0===arguments.length)this.__eventListeners={};else if(1===arguments.length&&"object"===
typeof arguments[0])for(var c in a)d.call(this,c,a[c]);else d.call(this,a,b);return this}}function b(a,b){if(this.__eventListeners){var c=this.__eventListeners[a];if(c){for(var d=0,n=c.length;d<n;d++)c[d].call(this,b||{});return this}}}fabric.Observable={observe:a,stopObserving:c,fire:b,on:a,off:c,trigger:b}})();
fabric.Collection={add:function(){this._objects.push.apply(this._objects,arguments);for(var d=0,a=arguments.length;d<a;d++)this._onObjectAdded(arguments[d]);this.renderOnAddRemove&&this.renderAll();return this},insertAt:function(d,a,c){var b=this.getObjects();c?b[a]=d:b.splice(a,0,d);this._onObjectAdded(d);this.renderOnAddRemove&&this.renderAll();return this},remove:function(){for(var d=this.getObjects(),a,c=0,b=arguments.length;c<b;c++)a=d.indexOf(arguments[c]),-1!==a&&(d.splice(a,1),this._onObjectRemoved(arguments[c]));
this.renderOnAddRemove&&this.renderAll();return this},forEachObject:function(d,a){for(var c=this.getObjects(),b=c.length;b--;)d.call(a,c[b],b,c);return this},getObjects:function(d){return"undefined"===typeof d?this._objects:this._objects.filter(function(a){return a.type===d})},item:function(d){return this.getObjects()[d]},isEmpty:function(){return 0===this.getObjects().length},size:function(){return this.getObjects().length},contains:function(d){return-1<this.getObjects().indexOf(d)},complexity:function(){return this.getObjects().reduce(function(d,
a){return d+=a.complexity?a.complexity():0},0)}};
(function(d){var a=Math.sqrt,c=Math.atan2,b=Math.PI/180;fabric.util={removeFromArray:function(a,b){var c=a.indexOf(b);-1!==c&&a.splice(c,1);return a},getRandomInt:function(a,b){return Math.floor(Math.random()*(b-a+1))+a},degreesToRadians:function(a){return a*b},radiansToDegrees:function(a){return a/b},rotatePoint:function(a,b,c){var d=Math.sin(c);c=Math.cos(c);a.subtractEquals(b);return(new fabric.Point(a.x*c-a.y*d,a.x*d+a.y*c)).addEquals(b)},transformPoint:function(a,b,c){return c?new fabric.Point(b[0]*
a.x+b[1]*a.y,b[2]*a.x+b[3]*a.y):new fabric.Point(b[0]*a.x+b[1]*a.y+b[4],b[2]*a.x+b[3]*a.y+b[5])},invertTransform:function(a){var b=a.slice(),b=1/(a[0]*a[3]-a[1]*a[2]),b=[b*a[3],-b*a[1],-b*a[2],b*a[0],0,0];a=fabric.util.transformPoint({x:a[4],y:a[5]},b);b[4]=-a.x;b[5]=-a.y;return b},toFixed:function(a,b){return parseFloat(Number(a).toFixed(b))},parseUnit:function(a){var b=/\D{0,2}$/.exec(a);a=parseFloat(a);switch(b[0]){case "mm":return a*fabric.DPI/25.4;case "cm":return a*fabric.DPI/2.54;case "in":return a*
fabric.DPI;case "pt":return a*fabric.DPI/72;case "pc":return 12*(a*fabric.DPI/72);default:return a}},falseFunction:function(){return!1},getKlass:function(a,b){a=fabric.util.string.camelize(a.charAt(0).toUpperCase()+a.slice(1));return fabric.util.resolveNamespace(b)[a]},resolveNamespace:function(a){if(!a)return fabric;a=a.split(".");for(var b=a.length,c=d||fabric.window,h=0;h<b;++h)c=c[a[h]];return c},loadImage:function(a,b,c,d){if(a){var n=fabric.util.createImage();n.onload=function(){b&&b.call(c,
n);n=n.onload=n.onerror=null};n.onerror=function(){fabric.log("Error loading "+n.src);b&&b.call(c,null,!0);n=n.onload=n.onerror=null};0!==a.indexOf("data")&&"undefined"!==typeof d&&(n.crossOrigin=d);n.src=a}else b&&b.call(c,a)},enlivenObjects:function(a,b,c,d){function n(){++l===q&&b&&b(k)}a=a||[];var k=[],l=0,q=a.length;q?a.forEach(function(a,b){if(a&&a.type){var e=fabric.util.getKlass(a.type,c);e.async?e.fromObject(a,function(c,e){e||(k[b]=c,d&&d(a,k[b]));n()}):(k[b]=e.fromObject(a),d&&d(a,k[b]),
n())}else n()}):b&&b(k)},groupSVGElements:function(a,b,c){a=new fabric.PathGroup(a,b);"undefined"!==typeof c&&a.setSourcePath(c);return a},populateWithProperties:function(a,b,c){if(c&&"[object Array]"===Object.prototype.toString.call(c))for(var d=0,n=c.length;d<n;d++)c[d]in a&&(b[c[d]]=a[c[d]])},drawDashedLine:function(b,d,g,h,n,k){h-=d;var l=n-g;n=a(h*h+l*l);h=c(l,h);var l=k.length,q=0,r=!0;b.save();b.translate(d,g);b.moveTo(0,0);b.rotate(h);for(d=0;n>d;)d+=k[q++%l],d>n&&(d=n),b[r?"lineTo":"moveTo"](d,
0),r=!r;b.restore()},createCanvasElement:function(a){a||(a=fabric.document.createElement("canvas"));a.getContext||"undefined"===typeof G_vmlCanvasManager||G_vmlCanvasManager.initElement(a);return a},createImage:function(){return fabric.isLikelyNode?new (require("canvas").Image):fabric.document.createElement("img")},createAccessors:function(a){a=a.prototype;for(var b=a.stateProperties.length;b--;){var c=a.stateProperties[b],d=c.charAt(0).toUpperCase()+c.slice(1),n="set"+d,d="get"+d;a[d]||(a[d]=new Function('return this.get("'+
c+'")'));a[n]||(a[n]=new Function("value",'return this.set("'+c+'", value)'))}},clipContext:function(a,b){b.save();b.beginPath();a.clipTo(b);b.clip()},multiplyTransformMatrices:function(a,b){for(var c=[[a[0],a[2],a[4]],[a[1],a[3],a[5]],[0,0,1]],d=[[b[0],b[2],b[4]],[b[1],b[3],b[5]],[0,0,1]],n=[],k=0;3>k;k++){n[k]=[];for(var l=0;3>l;l++){for(var q=0,r=0;3>r;r++)q+=c[k][r]*d[r][l];n[k][l]=q}}return[n[0][0],n[1][0],n[0][1],n[1][1],n[0][2],n[1][2]]},getFunctionBody:function(a){return(String(a).match(/function[^{]*\{([\s\S]*)\}/)||
{})[1]},isTransparent:function(a,b,c,d){0<d&&(b=b>d?b-d:0,c=c>d?c-d:0);var n=!0;a=a.getImageData(b,c,2*d||1,2*d||1);b=3;for(c=a.data.length;b<c&&(n=0>=a.data[b],!1!==n);b+=4);return n}}})("undefined"!==typeof exports?exports:this);
(function(){function d(e,d,n,k,l,q,r){var t=f.call(arguments);if(b[t])return b[t];var w=Math.PI,D=r*(w/180),E=Math.sin(D),D=Math.cos(D),y=0,G=0;n=Math.abs(n);k=Math.abs(k);var v=-D*e-E*d,C=-D*d+E*e,z=n*n,s=k*k,F=C*C,H=v*v,u=4*z*s-z*F-s*H,A=0;0>u?(z=Math.sqrt(1-0.25*u/(z*s)),n*=z,k*=z):A=(l===q?-0.5:0.5)*Math.sqrt(u/(z*F+s*H));F=A*n*C/k;H=-A*k*v/n;A=D*F-E*H+e/2;z=E*F+D*H+d/2;s=c(1,0,(v-F)/n,(C-H)/k);C=c((v-F)/n,(C-H)/k,(-v-F)/n,(-C-H)/k);0===q&&0<C?C-=2*w:1===q&&0>C&&(C+=2*w);w=Math.ceil(Math.abs(C/
(0.5*w)));v=[];C/=w;F=8/3*Math.sin(C/4)*Math.sin(C/4)/Math.sin(C/2);H=s+C;for(u=0;u<w;u++)v[u]=a(s,H,D,E,n,k,A,z,F,y,G),y=v[u][4],G=v[u][5],s+=C,H+=C;return b[t]=v}function a(a,b,c,d,l,q,r,t,w,D,E){var y=f.call(arguments);if(e[y])return e[y];var G=Math.cos(a),v=Math.sin(a),C=Math.cos(b),z=Math.sin(b),s=c*l*C-d*q*z+r,F=d*l*C+c*q*z+t;e[y]=[D+w*(-c*l*v-d*q*G),E+w*(-d*l*v+c*q*G),s+w*(c*l*z+d*q*C),F+w*(d*l*z-c*q*C),s,F];return e[y]}function c(a,b,c,e){a=Math.atan2(b,a);c=Math.atan2(e,c);return c>=a?c-
a:2*Math.PI-(a-c)}var b={},e={},f=Array.prototype.join;fabric.util.drawArc=function(a,b,c,e){var f=[[],[],[],[]];e=d(e[5]-b,e[6]-c,e[0],e[1],e[3],e[4],e[2]);for(var q=0;q<e.length;q++)f[q][0]=e[q][0]+b,f[q][1]=e[q][1]+c,f[q][2]=e[q][2]+b,f[q][3]=e[q][3]+c,f[q][4]=e[q][4]+b,f[q][5]=e[q][5]+c,a.bezierCurveTo.apply(a,f[q])}})();
(function(){function d(a,b,e){if(a&&0!==a.length){var d=a.length-1,g=b?a[d][b]:a[d];if(b)for(;d--;)e(a[d][b],g)&&(g=a[d][b]);else for(;d--;)e(a[d],g)&&(g=a[d]);return g}}var a=Array.prototype.slice;Array.prototype.indexOf||(Array.prototype.indexOf=function(a){if(void 0===this||null===this)throw new TypeError;var b=Object(this),e=b.length>>>0;if(0===e)return-1;var d=0;0<arguments.length&&(d=Number(arguments[1]),d!==d?d=0:0!==d&&d!==Number.POSITIVE_INFINITY&&d!==Number.NEGATIVE_INFINITY&&(d=(0<d||-1)*
Math.floor(Math.abs(d))));if(d>=e)return-1;for(d=0<=d?d:Math.max(e-Math.abs(d),0);d<e;d++)if(d in b&&b[d]===a)return d;return-1});Array.prototype.forEach||(Array.prototype.forEach=function(a,b){for(var e=0,d=this.length>>>0;e<d;e++)e in this&&a.call(b,this[e],e,this)});Array.prototype.map||(Array.prototype.map=function(a,b){for(var e=[],d=0,g=this.length>>>0;d<g;d++)d in this&&(e[d]=a.call(b,this[d],d,this));return e});Array.prototype.every||(Array.prototype.every=function(a,b){for(var e=0,d=this.length>>>
0;e<d;e++)if(e in this&&!a.call(b,this[e],e,this))return!1;return!0});Array.prototype.some||(Array.prototype.some=function(a,b){for(var e=0,d=this.length>>>0;e<d;e++)if(e in this&&a.call(b,this[e],e,this))return!0;return!1});Array.prototype.filter||(Array.prototype.filter=function(a,b){for(var e=[],d,g=0,h=this.length>>>0;g<h;g++)g in this&&(d=this[g],a.call(b,d,g,this)&&e.push(d));return e});Array.prototype.reduce||(Array.prototype.reduce=function(a){var b=this.length>>>0,e=0,d;if(1<arguments.length)d=
arguments[1];else{do{if(e in this){d=this[e++];break}if(++e>=b)throw new TypeError;}while(1)}for(;e<b;e++)e in this&&(d=a.call(null,d,this[e],e,this));return d});fabric.util.array={invoke:function(c,b){for(var e=a.call(arguments,2),d=[],g=0,h=c.length;g<h;g++)d[g]=e.length?c[g][b].apply(c[g],e):c[g][b].call(c[g]);return d},min:function(a,b){return d(a,b,function(a,b){return a<b})},max:function(a,b){return d(a,b,function(a,b){return a>=b})}}})();
(function(){function d(a,c){for(var b in c)a[b]=c[b];return a}fabric.util.object={extend:d,clone:function(a){return d({},a)}}})();
(function(){String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")});fabric.util.string={camelize:function(d){return d.replace(/-+(.)?/g,function(a,c){return c?c.toUpperCase():""})},capitalize:function(d,a){return d.charAt(0).toUpperCase()+(a?d.slice(1):d.slice(1).toLowerCase())},escapeXml:function(d){return d.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}}})();
(function(){var d=Array.prototype.slice,a=Function.prototype.apply,c=function(){};Function.prototype.bind||(Function.prototype.bind=function(b){var e=this,f=d.call(arguments,1),g;g=f.length?function(){return a.call(e,this instanceof c?this:b,f.concat(d.call(arguments)))}:function(){return a.call(e,this instanceof c?this:b,arguments)};c.prototype=this.prototype;g.prototype=new c;return g})})();
(function(){function d(){}function a(a){var b=this.constructor.superclass.prototype[a];return 1<arguments.length?b.apply(this,c.call(arguments,1)):b.call(this)}var c=Array.prototype.slice,b=function(){},e=function(){for(var a in{toString:1})if("toString"===a)return!1;return!0}(),f=function(a,b,c){for(var d in b)d in a.prototype&&"function"===typeof a.prototype[d]&&-1<(b[d]+"").indexOf("callSuper")?a.prototype[d]=function(a){return function(){var e=this.constructor.superclass;this.constructor.superclass=
c;var g=b[a].apply(this,arguments);this.constructor.superclass=e;if("initialize"!==a)return g}}(d):a.prototype[d]=b[d],e&&(b.toString!==Object.prototype.toString&&(a.prototype.toString=b.toString),b.valueOf!==Object.prototype.valueOf&&(a.prototype.valueOf=b.valueOf))};fabric.util.createClass=function(){function e(){this.initialize.apply(this,arguments)}var h=null,n=c.call(arguments,0);"function"===typeof n[0]&&(h=n.shift());e.superclass=h;e.subclasses=[];h&&(d.prototype=h.prototype,e.prototype=new d,
h.subclasses.push(e));for(var k=0,l=n.length;k<l;k++)f(e,n[k],h);e.prototype.initialize||(e.prototype.initialize=b);e.prototype.constructor=e;e.prototype.callSuper=a;return e}})();
(function(){function d(a){var b=Array.prototype.slice.call(arguments,1),c,e,g=b.length;for(e=0;e<g;e++)if(c=typeof a[b[e]],!/^(?:function|object|unknown)$/.test(c))return!1;return!0}function a(a,b){return function(c){b.call(e(a),c||fabric.window.event)}}function c(a,b){return function(c){if(l[a]&&l[a][b])for(var e=l[a][b],g=0,d=e.length;g<d;g++)e[g].call(this,c||fabric.window.event)}}function b(a,b,c){var e="touchend"===a.type?"changedTouches":"touches";return a[e]&&a[e][0]?a[e][0][b]-(a[e][0][b]-
a[e][0][c])||a[c]:a[c]}var e,f,g=function(){var a=0;return function(b){return b.__uniqueID||(b.__uniqueID="uniqueID__"+a++)}}();(function(){var a={};e=function(b){return a[b]};f=function(b,c){a[b]=c}})();var h=d(fabric.document.documentElement,"addEventListener","removeEventListener")&&d(fabric.window,"addEventListener","removeEventListener"),n=d(fabric.document.documentElement,"attachEvent","detachEvent")&&d(fabric.window,"attachEvent","detachEvent"),k={},l={};h?(h=function(a,b,c){a.addEventListener(b,
c,!1)},n=function(a,b,c){a.removeEventListener(b,c,!1)}):n?(h=function(b,c,e){var d=g(b);f(d,b);k[d]||(k[d]={});k[d][c]||(k[d][c]=[]);e={handler:e,wrappedHandler:a(d,e)};k[d][c].push(e);b.attachEvent("on"+c,e.wrappedHandler)},n=function(a,b,c){var e=g(a),d;if(k[e]&&k[e][b])for(var f=0,h=k[e][b].length;f<h;f++)(d=k[e][b][f])&&d.handler===c&&(a.detachEvent("on"+b,d.wrappedHandler),k[e][b][f]=null)}):(h=function(a,b,e){var d=g(a);l[d]||(l[d]={});if(!l[d][b]){l[d][b]=[];var f=a["on"+b];f&&l[d][b].push(f);
a["on"+b]=c(d,b)}l[d][b].push(e)},n=function(a,b,c){a=g(a);if(l[a]&&l[a][b]){b=l[a][b];a=0;for(var e=b.length;a<e;a++)b[a]===c&&b.splice(a,1)}});fabric.util.addListener=h;fabric.util.removeListener=n;var q=function(a){return"unknown"!==typeof a.clientX?a.clientX:0},r=function(a){return"unknown"!==typeof a.clientY?a.clientY:0};fabric.isTouchSupported&&(q=function(a){return b(a,"pageX","clientX")},r=function(a){return b(a,"pageY","clientY")});fabric.util.getPointer=function(a,b){a||(a=fabric.window.event);
var c=fabric.util.getScrollLeftTop(a.target||("unknown"!==typeof a.srcElement?a.srcElement:null),b);return{x:q(a)+c.left,y:r(a)+c.top}};fabric.util.object.extend(fabric.util,fabric.Observable)})();
(function(){var d=fabric.document.createElement("div"),a="string"===typeof d.style.filter,c=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,b=function(a){return a};"string"===typeof d.style.opacity?b=function(a,b){a.style.opacity=b;return a}:a&&(b=function(a,b){var d=a.style;a.currentStyle&&!a.currentStyle.hasLayout&&(d.zoom=1);c.test(d.filter)?d.filter=d.filter.replace(c,0.9999<=b?"":"alpha(opacity="+100*b+")"):d.filter+=" alpha(opacity="+100*b+")";return a});fabric.util.setStyle=function(a,c){var d=a.style;
if(!d)return a;if("string"===typeof c)return a.style.cssText+=";"+c,-1<c.indexOf("opacity")?b(a,c.match(/opacity:\s*(\d?\.?\d*)/)[1]):a;for(var h in c)"opacity"===h?b(a,c[h]):d["float"===h||"cssFloat"===h?"undefined"===typeof d.styleFloat?"cssFloat":"styleFloat":h]=c[h];return a}})();
(function(){function d(a,b){var c=fabric.document.createElement(a),e;for(e in b)"class"===e?c.className=b[e]:"for"===e?c.htmlFor=b[e]:c.setAttribute(e,b[e]);return c}var a=Array.prototype.slice,c,b=function(b){return a.call(b,0)};try{c=b(fabric.document.childNodes)instanceof Array}catch(e){}c||(b=function(a){for(var b=Array(a.length),c=a.length;c--;)b[c]=a[c];return b});var f;f=fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle?function(a,b){return fabric.document.defaultView.getComputedStyle(a,
null)[b]}:function(a,b){var c=a.style[b];!c&&a.currentStyle&&(c=a.currentStyle[b]);return c};(function(){var a=fabric.document.documentElement.style,b="userSelect"in a?"userSelect":"MozUserSelect"in a?"MozUserSelect":"WebkitUserSelect"in a?"WebkitUserSelect":"KhtmlUserSelect"in a?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=function(a){"undefined"!==typeof a.onselectstart&&(a.onselectstart=fabric.util.falseFunction);b?a.style[b]="none":"string"===typeof a.unselectable&&(a.unselectable=
"on");return a};fabric.util.makeElementSelectable=function(a){"undefined"!==typeof a.onselectstart&&(a.onselectstart=null);b?a.style[b]="":"string"===typeof a.unselectable&&(a.unselectable="");return a}})();(function(){fabric.util.getScript=function(a,b){var c=fabric.document.getElementsByTagName("head")[0],e=fabric.document.createElement("script"),d=!0;e.onload=e.onreadystatechange=function(a){!d||"string"===typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(d=!1,
b(a||fabric.window.event),e=e.onload=e.onreadystatechange=null)};e.src=a;c.appendChild(e)}})();fabric.util.getById=function(a){return"string"===typeof a?fabric.document.getElementById(a):a};fabric.util.toArray=b;fabric.util.makeElement=d;fabric.util.addClass=function(a,b){a&&-1===(" "+a.className+" ").indexOf(" "+b+" ")&&(a.className+=(a.className?" ":"")+b)};fabric.util.wrapElement=function(a,b,c){"string"===typeof b&&(b=d(b,c));a.parentNode&&a.parentNode.replaceChild(b,a);b.appendChild(a);return b};
fabric.util.getScrollLeftTop=function(a,b){var c,e,d=0,f=0,r=fabric.document.documentElement,t=fabric.document.body||{scrollLeft:0,scrollTop:0};for(e=a;a&&a.parentNode&&!c;)a=a.parentNode,a!==fabric.document&&"fixed"===fabric.util.getElementStyle(a,"position")&&(c=a),a!==fabric.document&&e!==b&&"absolute"===fabric.util.getElementStyle(a,"position")?f=d=0:a===fabric.document?(d=t.scrollLeft||r.scrollLeft||0,f=t.scrollTop||r.scrollTop||0):(d+=a.scrollLeft||0,f+=a.scrollTop||0);return{left:d,top:f}};
fabric.util.getElementOffset=function(a){var b;b=a&&a.ownerDocument;var c={left:0,top:0},e={left:0,top:0},d={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!b)return{left:0,top:0};for(var q in d)e[d[q]]+=parseInt(f(a,q),10)||0;b=b.documentElement;"undefined"!==typeof a.getBoundingClientRect&&(c=a.getBoundingClientRect());a=fabric.util.getScrollLeftTop(a,null);return{left:c.left+a.left-(b.clientLeft||0)+e.left,top:c.top+a.top-(b.clientTop||0)+e.top}};fabric.util.getElementStyle=
f})();
(function(){function d(){}var a=function(){for(var a=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],b=a.length;b--;)try{if(a[b]())return a[b]}catch(e){}}();fabric.util.request=function(c,b){b||(b={});var e=b.method?b.method.toUpperCase():"GET",f=b.onComplete||function(){},g=a(),h;g.onreadystatechange=function(){4===g.readyState&&(f(g),
g.onreadystatechange=d)};"GET"===e&&(h=null,"string"===typeof b.parameters&&(c=c+(/\?/.test(c)?"&":"?")+b.parameters));g.open(e,c,!0);"POST"!==e&&"PUT"!==e||g.setRequestHeader("Content-Type","application/x-www-form-urlencoded");g.send(h);return g}})();fabric.log=function(){};fabric.warn=function(){};"undefined"!==typeof console&&["log","warn"].forEach(function(d){"undefined"!==typeof console[d]&&console[d].apply&&(fabric[d]=function(){return console[d].apply(console,arguments)})});
(function(d){function a(a,b){this.x=a;this.y=b}d=d.fabric||(d.fabric={});d.Point?d.warn("fabric.Point is already defined"):(d.Point=a,a.prototype={constructor:a,add:function(c){return new a(this.x+c.x,this.y+c.y)},addEquals:function(a){this.x+=a.x;this.y+=a.y;return this},scalarAdd:function(c){return new a(this.x+c,this.y+c)},scalarAddEquals:function(a){this.x+=a;this.y+=a;return this},subtract:function(c){return new a(this.x-c.x,this.y-c.y)},subtractEquals:function(a){this.x-=a.x;this.y-=a.y;return this},
scalarSubtract:function(c){return new a(this.x-c,this.y-c)},scalarSubtractEquals:function(a){this.x-=a;this.y-=a;return this},multiply:function(c){return new a(this.x*c,this.y*c)},multiplyEquals:function(a){this.x*=a;this.y*=a;return this},divide:function(c){return new a(this.x/c,this.y/c)},divideEquals:function(a){this.x/=a;this.y/=a;return this},eq:function(a){return this.x===a.x&&this.y===a.y},lt:function(a){return this.x<a.x&&this.y<a.y},lte:function(a){return this.x<=a.x&&this.y<=a.y},gt:function(a){return this.x>
a.x&&this.y>a.y},gte:function(a){return this.x>=a.x&&this.y>=a.y},lerp:function(c,b){return new a(this.x+(c.x-this.x)*b,this.y+(c.y-this.y)*b)},distanceFrom:function(a){var b=this.x-a.x;a=this.y-a.y;return Math.sqrt(b*b+a*a)},midPointFrom:function(c){return new a(this.x+(c.x-this.x)/2,this.y+(c.y-this.y)/2)},min:function(c){return new a(Math.min(this.x,c.x),Math.min(this.y,c.y))},max:function(c){return new a(Math.max(this.x,c.x),Math.max(this.y,c.y))},toString:function(){return this.x+","+this.y},
setXY:function(a,b){this.x=a;this.y=b},setFromPoint:function(a){this.x=a.x;this.y=a.y},swap:function(a){var b=this.x,e=this.y;this.x=a.x;this.y=a.y;a.x=b;a.y=e}})})("undefined"!==typeof exports?exports:this);
(function(d){function a(a){this.status=a;this.points=[]}var c=d.fabric||(d.fabric={});c.Intersection?c.warn("fabric.Intersection is already defined"):(c.Intersection=a,c.Intersection.prototype={appendPoint:function(a){this.points.push(a)},appendPoints:function(a){this.points=this.points.concat(a)}},c.Intersection.intersectLineLine=function(b,e,d,g){var h,n=(g.x-d.x)*(b.y-d.y)-(g.y-d.y)*(b.x-d.x);h=(e.x-b.x)*(b.y-d.y)-(e.y-b.y)*(b.x-d.x);d=(g.y-d.y)*(e.x-b.x)-(g.x-d.x)*(e.y-b.y);0!==d?(n/=d,h/=d,0<=
n&&1>=n&&0<=h&&1>=h?(h=new a("Intersection"),h.points.push(new c.Point(b.x+n*(e.x-b.x),b.y+n*(e.y-b.y)))):h=new a):h=0===n||0===h?new a("Coincident"):new a("Parallel");return h},c.Intersection.intersectLinePolygon=function(b,c,d){for(var g=new a,h=d.length,n=0;n<h;n++){var k=a.intersectLineLine(b,c,d[n],d[(n+1)%h]);g.appendPoints(k.points)}0<g.points.length&&(g.status="Intersection");return g},c.Intersection.intersectPolygonPolygon=function(b,c){for(var d=new a,g=b.length,h=0;h<g;h++){var n=a.intersectLinePolygon(b[h],
b[(h+1)%g],c);d.appendPoints(n.points)}0<d.points.length&&(d.status="Intersection");return d},c.Intersection.intersectPolygonRectangle=function(b,e,d){var g=e.min(d),h=e.max(d);d=new c.Point(h.x,g.y);var n=new c.Point(g.x,h.y);e=a.intersectLinePolygon(g,d,b);d=a.intersectLinePolygon(d,h,b);h=a.intersectLinePolygon(h,n,b);b=a.intersectLinePolygon(n,g,b);g=new a;g.appendPoints(e.points);g.appendPoints(d.points);g.appendPoints(h.points);g.appendPoints(b.points);0<g.points.length&&(g.status="Intersection");
return g})})("undefined"!==typeof exports?exports:this);
(function(d){function a(a){a?this._tryParsingColor(a):this.setSource([0,0,0,1])}function c(a,b,c){0>c&&(c+=1);1<c&&(c-=1);return c<1/6?a+6*(b-a)*c:0.5>c?b:c<2/3?a+6*(b-a)*(2/3-c):a}var b=d.fabric||(d.fabric={});b.Color?b.warn("fabric.Color is already defined."):(b.Color=a,b.Color.prototype={_tryParsingColor:function(b){var c;b in a.colorNameMap&&(b=a.colorNameMap[b]);"transparent"===b?this.setSource([255,255,255,0]):((c=a.sourceFromHex(b))||(c=a.sourceFromRgb(b)),c||(c=a.sourceFromHsl(b)),c&&this.setSource(c))},
_rgbToHsl:function(a,c,d){a/=255;c/=255;d/=255;var h,n,k,l=b.util.array.max([a,c,d]);n=b.util.array.min([a,c,d]);k=(l+n)/2;if(l===n)h=n=0;else{var q=l-n;n=0.5<k?q/(2-l-n):q/(l+n);switch(l){case a:h=(c-d)/q+(c<d?6:0);break;case c:h=(d-a)/q+2;break;case d:h=(a-c)/q+4}h/=6}return[Math.round(360*h),Math.round(100*n),Math.round(100*k)]},getSource:function(){return this._source},setSource:function(a){this._source=a},toRgb:function(){var a=this.getSource();return"rgb("+a[0]+","+a[1]+","+a[2]+")"},toRgba:function(){var a=
this.getSource();return"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")"},toHsl:function(){var a=this.getSource(),a=this._rgbToHsl(a[0],a[1],a[2]);return"hsl("+a[0]+","+a[1]+"%,"+a[2]+"%)"},toHsla:function(){var a=this.getSource(),b=this._rgbToHsl(a[0],a[1],a[2]);return"hsla("+b[0]+","+b[1]+"%,"+b[2]+"%,"+a[3]+")"},toHex:function(){var a=this.getSource(),b,c;b=a[0].toString(16);b=1===b.length?"0"+b:b;c=a[1].toString(16);c=1===c.length?"0"+c:c;a=a[2].toString(16);a=1===a.length?"0"+a:a;return b.toUpperCase()+
c.toUpperCase()+a.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(a){var b=this.getSource();b[3]=a;this.setSource(b);return this},toGrayscale:function(){var a=this.getSource(),b=parseInt((0.3*a[0]+0.59*a[1]+0.11*a[2]).toFixed(0),10);this.setSource([b,b,b,a[3]]);return this},toBlackWhite:function(a){var b=this.getSource(),c=(0.3*b[0]+0.59*b[1]+0.11*b[2]).toFixed(0),b=b[3],c=Number(c)<Number(a||127)?0:255;this.setSource([c,c,c,b]);return this},overlayWith:function(b){b instanceof
a||(b=new a(b));var c=[],d=this.getAlpha(),h=this.getSource();b=b.getSource();for(var n=0;3>n;n++)c.push(Math.round(0.5*h[n]+0.5*b[n]));c[3]=d;this.setSource(c);return this}},b.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,b.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,b.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i,b.Color.colorNameMap={aqua:"#00FFFF",
black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},b.Color.fromRgb=function(b){return a.fromSource(a.sourceFromRgb(b))},b.Color.sourceFromRgb=function(b){if(b=b.match(a.reRGBa)){var c=parseInt(b[1],10)/(/%$/.test(b[1])?100:1)*(/%$/.test(b[1])?255:1),d=parseInt(b[2],10)/(/%$/.test(b[2])?100:1)*(/%$/.test(b[2])?
255:1),h=parseInt(b[3],10)/(/%$/.test(b[3])?100:1)*(/%$/.test(b[3])?255:1);return[parseInt(c,10),parseInt(d,10),parseInt(h,10),b[4]?parseFloat(b[4]):1]}},b.Color.fromRgba=a.fromRgb,b.Color.fromHsl=function(b){return a.fromSource(a.sourceFromHsl(b))},b.Color.sourceFromHsl=function(b){if(b=b.match(a.reHSLa)){var d=(parseFloat(b[1])%360+360)%360/360,g=parseFloat(b[2])/(/%$/.test(b[2])?100:1),h=parseFloat(b[3])/(/%$/.test(b[3])?100:1);if(0===g)h=g=d=h;else var n=0.5>=h?h*(g+1):h+g-h*g,k=2*h-n,h=c(k,n,
d+1/3),g=c(k,n,d),d=c(k,n,d-1/3);return[Math.round(255*h),Math.round(255*g),Math.round(255*d),b[4]?parseFloat(b[4]):1]}},b.Color.fromHsla=a.fromHsl,b.Color.fromHex=function(b){return a.fromSource(a.sourceFromHex(b))},b.Color.sourceFromHex=function(b){if(b.match(a.reHex)){var c=b.slice(b.indexOf("#")+1),d=3===c.length;b=d?c.charAt(0)+c.charAt(0):c.substring(0,2);var h=d?c.charAt(1)+c.charAt(1):c.substring(2,4),c=d?c.charAt(2)+c.charAt(2):c.substring(4,6);return[parseInt(b,16),parseInt(h,16),parseInt(c,
16),1]}},b.Color.fromSource=function(b){var c=new a;c.setSource(b);return c})})("undefined"!==typeof exports?exports:this);
(function(){if(fabric.StaticCanvas)fabric.warn("fabric.StaticCanvas is already defined.");else{var d=fabric.util.object.extend,a=fabric.util.getElementOffset,c=fabric.util.removeFromArray,b=Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass({initialize:function(a,b){b||(b={});this._initStatic(a,b);fabric.StaticCanvas.activeInstance=this},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!0,renderOnAddRemove:!0,
clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:[1,0,0,1,0,0],onBeforeScaleRotate:function(){},_initStatic:function(a,b){this._objects=[];this._createLowerCanvas(a);this._initOptions(b);this._setImageSmoothing();b.overlayImage&&this.setOverlayImage(b.overlayImage,this.renderAll.bind(this));b.backgroundImage&&this.setBackgroundImage(b.backgroundImage,this.renderAll.bind(this));b.backgroundColor&&this.setBackgroundColor(b.backgroundColor,this.renderAll.bind(this));
b.overlayColor&&this.setOverlayColor(b.overlayColor,this.renderAll.bind(this));this.calcOffset()},calcOffset:function(){this._offset=a(this.lowerCanvasEl);return this},setOverlayImage:function(a,b,c){return this.__setBgOverlayImage("overlayImage",a,b,c)},setBackgroundImage:function(a,b,c){return this.__setBgOverlayImage("backgroundImage",a,b,c)},setOverlayColor:function(a,b){return this.__setBgOverlayColor("overlayColor",a,b)},setBackgroundColor:function(a,b){return this.__setBgOverlayColor("backgroundColor",
a,b)},_setImageSmoothing:function(){var a=this.getContext();a.imageSmoothingEnabled=this.imageSmoothingEnabled;a.webkitImageSmoothingEnabled=this.imageSmoothingEnabled;a.mozImageSmoothingEnabled=this.imageSmoothingEnabled;a.msImageSmoothingEnabled=this.imageSmoothingEnabled;a.oImageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(a,b,c,d){"string"===typeof b?fabric.util.loadImage(b,function(b){this[a]=new fabric.Image(b,d);c&&c()},this):(this[a]=b,c&&c());return this},__setBgOverlayColor:function(a,
b,c){if(b&&b.source){var d=this;fabric.util.loadImage(b.source,function(n){d[a]=new fabric.Pattern({source:n,repeat:b.repeat,offsetX:b.offsetX,offsetY:b.offsetY});c&&c()})}else this[a]=b,c&&c();return this},_createCanvasElement:function(){var a=fabric.document.createElement("canvas");a.style||(a.style={});if(!a)throw b;this._initCanvasElement(a);return a},_initCanvasElement:function(a){fabric.util.createCanvasElement(a);if("undefined"===typeof a.getContext)throw b;},_initOptions:function(a){for(var b in a)this[b]=
a[b];this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0;this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0;this.lowerCanvasEl.style&&(this.lowerCanvasEl.width=this.width,this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(a){this.lowerCanvasEl=fabric.util.getById(a)||this._createCanvasElement();this._initCanvasElement(this.lowerCanvasEl);
fabric.util.addClass(this.lowerCanvasEl,"lower-canvas");this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl);this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(a,b){return this.setDimensions({width:a},b)},setHeight:function(a,b){return this.setDimensions({height:a},b)},setDimensions:function(a,b){var c;b=b||{};for(var d in a)c=a[d],b.cssOnly||(this._setBackstoreDimension(d,a[d]),c+="px"),
b.backstoreOnly||this._setCssDimension(d,c);b.cssOnly||this.renderAll();this.calcOffset();return this},_setBackstoreDimension:function(a,b){this.lowerCanvasEl[a]=b;this.upperCanvasEl&&(this.upperCanvasEl[a]=b);this.cacheCanvasEl&&(this.cacheCanvasEl[a]=b);this[a]=b;return this},_setCssDimension:function(a,b){this.lowerCanvasEl.style[a]=b;this.upperCanvasEl&&(this.upperCanvasEl.style[a]=b);this.wrapperEl&&(this.wrapperEl.style[a]=b);return this},getZoom:function(){return Math.sqrt(this.viewportTransform[0]*
this.viewportTransform[3])},setViewportTransform:function(a){this.viewportTransform=a;this.renderAll();a=0;for(var b=this._objects.length;a<b;a++)this._objects[a].setCoords();return this},zoomToPoint:function(a,b){var c=a;a=fabric.util.transformPoint(a,fabric.util.invertTransform(this.viewportTransform));this.viewportTransform[0]=b;this.viewportTransform[3]=b;var d=fabric.util.transformPoint(a,this.viewportTransform);this.viewportTransform[4]+=c.x-d.x;this.viewportTransform[5]+=c.y-d.y;this.renderAll();
c=0;for(d=this._objects.length;c<d;c++)this._objects[c].setCoords();return this},setZoom:function(a){this.zoomToPoint(new fabric.Point(0,0),a);return this},absolutePan:function(a){this.viewportTransform[4]=-a.x;this.viewportTransform[5]=-a.y;this.renderAll();a=0;for(var b=this._objects.length;a<b;a++)this._objects[a].setCoords();return this},relativePan:function(a){return this.absolutePan(new fabric.Point(-a.x-this.viewportTransform[4],-a.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},
getActiveObject:function(){return null},getActiveGroup:function(){return null},_draw:function(a,b){if(b){a.save();var c=this.viewportTransform;a.transform(c[0],c[1],c[2],c[3],c[4],c[5]);b.render(a);a.restore();this.controlsAboveOverlay||b._renderControls(a)}},_onObjectAdded:function(a){this.stateful&&a.setupState();a.canvas=this;a.setCoords();this.fire("object:added",{target:a});a.fire("added")},_onObjectRemoved:function(a){this.getActiveObject()===a&&(this.fire("before:selection:cleared",{target:a}),
this._discardActiveObject(),this.fire("selection:cleared"));this.fire("object:removed",{target:a});a.fire("removed")},clearContext:function(a){a.clearRect(0,0,this.width,this.height);return this},getContext:function(){return this.contextContainer},clear:function(){this._objects.length=0;this.discardActiveGroup&&this.discardActiveGroup();this.discardActiveObject&&this.discardActiveObject();this.clearContext(this.contextContainer);this.contextTop&&this.clearContext(this.contextTop);this.fire("canvas:cleared");
this.renderAll();return this},renderAll:function(a){var b=this[!0===a&&this.interactive?"contextTop":"contextContainer"],c=this.getActiveGroup();this.contextTop&&this.selection&&!this._groupSelector&&this.clearContext(this.contextTop);a||this.clearContext(b);this.fire("before:render");this.clipTo&&fabric.util.clipContext(this,b);this._renderBackground(b);this._renderObjects(b,c);this._renderActiveGroup(b,c);this.clipTo&&b.restore();this._renderOverlay(b);this.controlsAboveOverlay&&this.interactive&&
this.drawControls(b);this.fire("after:render");return this},_renderObjects:function(a,b){var c,d;if(b)for(c=0,d=this._objects.length;c<d;++c)this._objects[c]&&!b.contains(this._objects[c])&&this._draw(a,this._objects[c]);else for(c=0,d=this._objects.length;c<d;++c)this._draw(a,this._objects[c])},_renderActiveGroup:function(a,b){if(b){var c=[];this.forEachObject(function(a){b.contains(a)&&c.push(a)});b._set("objects",c);this._draw(a,b)}},_renderBackground:function(a){this.backgroundColor&&(a.fillStyle=
this.backgroundColor.toLive?this.backgroundColor.toLive(a):this.backgroundColor,a.fillRect(this.backgroundColor.offsetX||0,this.backgroundColor.offsetY||0,this.width,this.height));this.backgroundImage&&this._draw(a,this.backgroundImage)},_renderOverlay:function(a){this.overlayColor&&(a.fillStyle=this.overlayColor.toLive?this.overlayColor.toLive(a):this.overlayColor,a.fillRect(this.overlayColor.offsetX||0,this.overlayColor.offsetY||0,this.width,this.height));this.overlayImage&&this._draw(a,this.overlayImage)},
renderTop:function(){var a=this.contextTop||this.contextContainer;this.clearContext(a);this.selection&&this._groupSelector&&this._drawSelection();var b=this.getActiveGroup();b&&b.render(a);this._renderOverlay(a);this.fire("after:render");return this},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(a){this._centerObject(a,new fabric.Point(this.getCenter().left,a.getCenterPoint().y));this.renderAll();return this},centerObjectV:function(a){this._centerObject(a,
new fabric.Point(a.getCenterPoint().x,this.getCenter().top));this.renderAll();return this},centerObject:function(a){var b=this.getCenter();this._centerObject(a,new fabric.Point(b.left,b.top));this.renderAll();return this},_centerObject:function(a,b){a.setPositionByOrigin(b,"center","center");return this},toDatalessJSON:function(a){return this.toDatalessObject(a)},toObject:function(a){return this._toObjectMethod("toObject",a)},toDatalessObject:function(a){return this._toObjectMethod("toDatalessObject",
a)},_toObjectMethod:function(a,b){var c=this.getActiveGroup();c&&this.discardActiveGroup();var h={objects:this._toObjects(a,b)};d(h,this.__serializeBgOverlay());fabric.util.populateWithProperties(this,h,b);c&&(this.setActiveGroup(new fabric.Group(c.getObjects(),{originX:"center",originY:"center"})),c.forEachObject(function(a){a.set("active",!0)}),this._currentTransform&&(this._currentTransform.target=this.getActiveGroup()));return h},_toObjects:function(a,b){return this.getObjects().map(function(c){return this._toObject(c,
a,b)},this)},_toObject:function(a,b,c){var d;this.includeDefaultValues||(d=a.includeDefaultValues,a.includeDefaultValues=!1);b=a[b](c);this.includeDefaultValues||(a.includeDefaultValues=d);return b},__serializeBgOverlay:function(){var a={background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject():this.backgroundColor};this.overlayColor&&(a.overlay=this.overlayColor.toObject?this.overlayColor.toObject():this.overlayColor);this.backgroundImage&&(a.backgroundImage=
this.backgroundImage.toObject());this.overlayImage&&(a.overlayImage=this.overlayImage.toObject());return a},toSVG:function(a,b){a||(a={});var c=[];this._setSVGPreamble(c,a);this._setSVGHeader(c,a);this._setSVGBgOverlayColor(c,"backgroundColor");this._setSVGBgOverlayImage(c,"backgroundImage");this._setSVGObjects(c,b);this._setSVGBgOverlayColor(c,"overlayColor");this._setSVGBgOverlayImage(c,"overlayImage");c.push("</svg>");return c.join("")},_setSVGPreamble:function(a,b){b.suppressPreamble||a.push('<?xml version="1.0" encoding="',
b.encoding||"UTF-8",'" standalone="no" ?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(a,b){a.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',b.viewBox?b.viewBox.width:this.width,'" ','height="',b.viewBox?b.viewBox.height:this.height,'" ',this.backgroundColor&&!this.backgroundColor.toLive?'style="background-color: '+this.backgroundColor+
'" ':null,b.viewBox?'viewBox="'+b.viewBox.x+" "+b.viewBox.y+" "+b.viewBox.width+" "+b.viewBox.height+'" ':null,'xml:space="preserve">',"<desc>Created with Fabric.js ",fabric.version,"</desc>","<defs>",fabric.createSVGFontFacesMarkup(this.getObjects()),fabric.createSVGRefElementsMarkup(this),"</defs>")},_setSVGObjects:function(a,b){var c=this.getActiveGroup();c&&this.discardActiveGroup();for(var d=0,n=this.getObjects(),k=n.length;d<k;d++)a.push(n[d].toSVG(b));c&&(this.setActiveGroup(new fabric.Group(c.getObjects())),
c.forEachObject(function(a){a.set("active",!0)}))},_setSVGBgOverlayImage:function(a,b){this[b]&&this[b].toSVG&&a.push(this[b].toSVG())},_setSVGBgOverlayColor:function(a,b){this[b]&&this[b].source?a.push('<rect x="',this[b].offsetX,'" y="',this[b].offsetY,'" ','width="',"repeat-y"===this[b].repeat||"no-repeat"===this[b].repeat?this[b].source.width:this.width,'" height="',"repeat-x"===this[b].repeat||"no-repeat"===this[b].repeat?this[b].source.height:this.height,'" fill="url(#'+b+'Pattern)"',"></rect>"):
this[b]&&"overlayColor"===b&&a.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[b],'"',"></rect>")},sendToBack:function(a){c(this._objects,a);this._objects.unshift(a);return this.renderAll&&this.renderAll()},bringToFront:function(a){c(this._objects,a);this._objects.push(a);return this.renderAll&&this.renderAll()},sendBackwards:function(a,b){var d=this._objects.indexOf(a);0!==d&&(d=this._findNewLowerIndex(a,d,b),c(this._objects,a),this._objects.splice(d,0,a),
this.renderAll&&this.renderAll());return this},_findNewLowerIndex:function(a,b,c){if(c)for(c=b,b-=1;0<=b;--b){if(a.intersectsWithObject(this._objects[b])||a.isContainedWithinObject(this._objects[b])||this._objects[b].isContainedWithinObject(a)){c=b;break}}else c=b-1;return c},bringForward:function(a,b){var d=this._objects.indexOf(a);d!==this._objects.length-1&&(d=this._findNewUpperIndex(a,d,b),c(this._objects,a),this._objects.splice(d,0,a),this.renderAll&&this.renderAll());return this},_findNewUpperIndex:function(a,
b,c){if(c)for(c=b,b+=1;b<this._objects.length;++b){if(a.intersectsWithObject(this._objects[b])||a.isContainedWithinObject(this._objects[b])||this._objects[b].isContainedWithinObject(a)){c=b;break}}else c=b+1;return c},moveTo:function(a,b){c(this._objects,a);this._objects.splice(b,0,a);return this.renderAll&&this.renderAll()},dispose:function(){this.clear();this.interactive&&this.removeListeners();return this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+
" }>"}});d(fabric.StaticCanvas.prototype,fabric.Observable);d(fabric.StaticCanvas.prototype,fabric.Collection);d(fabric.StaticCanvas.prototype,fabric.DataURLExporter);d(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(a){var b=fabric.util.createCanvasElement();if(!b||!b.getContext)return null;var c=b.getContext("2d");if(!c)return null;switch(a){case "getImageData":return"undefined"!==typeof c.getImageData;case "setLineDash":return"undefined"!==typeof c.setLineDash;
case "toDataURL":return"undefined"!==typeof b.toDataURL;case "toDataURLWithQuality":try{return b.toDataURL("image/jpeg",0),!0}catch(d){}return!1;default:return null}}});fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject}})();
fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",setShadow:function(d){this.shadow=new fabric.Shadow(d);return this},_setBrushStyles:function(){var d=this.canvas.contextTop;d.strokeStyle=this.color;d.lineWidth=this.width;d.lineCap=this.strokeLineCap;d.lineJoin=this.strokeLineJoin},_setShadow:function(){if(this.shadow){var d=this.canvas.contextTop;d.shadowColor=this.shadow.color;d.shadowBlur=this.shadow.blur;d.shadowOffsetX=
this.shadow.offsetX;d.shadowOffsetY=this.shadow.offsetY}},_resetShadow:function(){var d=this.canvas.contextTop;d.shadowColor="";d.shadowBlur=d.shadowOffsetX=d.shadowOffsetY=0}});
(function(){var d=fabric.util.array.min,a=fabric.util.array.max;fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(a){this.canvas=a;this._points=[]},onMouseDown:function(a){this._prepareForDrawing(a);this._captureDrawingPath(a);this._render()},onMouseMove:function(a){this._captureDrawingPath(a);this.canvas.clearContext(this.canvas.contextTop);this._render()},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(a){a=new fabric.Point(a.x,a.y);this._reset();
this._addPoint(a);this.canvas.contextTop.moveTo(a.x,a.y)},_addPoint:function(a){this._points.push(a)},_reset:function(){this._points.length=0;this._setBrushStyles();this._setShadow()},_captureDrawingPath:function(a){a=new fabric.Point(a.x,a.y);this._addPoint(a)},_render:function(){var a=this.canvas.contextTop,b=this.canvas.viewportTransform,d=this._points[0],f=this._points[1];a.save();a.transform(b[0],b[1],b[2],b[3],b[4],b[5]);a.beginPath();2===this._points.length&&d.x===f.x&&d.y===f.y&&(d.x-=0.5,
f.x+=0.5);a.moveTo(d.x,d.y);for(var b=1,g=this._points.length;b<g;b++)f=d.midPointFrom(f),a.quadraticCurveTo(d.x,d.y,f.x,f.y),d=this._points[b],f=this._points[b+1];a.lineTo(d.x,d.y);a.stroke();a.restore()},_getSVGPathData:function(){this.box=this.getPathBoundingBox(this._points);return this.convertPointsToSVGPath(this._points,this.box.minX,this.box.minY)},getPathBoundingBox:function(c){for(var b=[],e=[],f=c[0],g=c[1],h=f,n=1,k=c.length;n<k;n++){var l=f.midPointFrom(g);b.push(h.x);b.push(l.x);e.push(h.y);
e.push(l.y);f=c[n];g=c[n+1];h=l}b.push(f.x);e.push(f.y);return{minX:d(b),minY:d(e),maxX:a(b),maxY:a(e)}},convertPointsToSVGPath:function(a,b,d){var f=[],g=new fabric.Point(a[0].x-b,a[0].y-d),h=new fabric.Point(a[1].x-b,a[1].y-d);f.push("M ",a[0].x-b," ",a[0].y-d," ");for(var n=1,k=a.length;n<k;n++){var l=g.midPointFrom(h);f.push("Q ",g.x," ",g.y," ",l.x," ",l.y," ");g=new fabric.Point(a[n].x-b,a[n].y-d);n+1<a.length&&(h=new fabric.Point(a[n+1].x-b,a[n+1].y-d))}f.push("L ",g.x," ",g.y," ");return f},
createPath:function(a){a=new fabric.Path(a);a.fill=null;a.stroke=this.color;a.strokeWidth=this.width;a.strokeLineCap=this.strokeLineCap;a.strokeLineJoin=this.strokeLineJoin;this.shadow&&(this.shadow.affectStroke=!0,a.setShadow(this.shadow));return a},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath();var a=this._getSVGPathData().join("");if("M 0 0 Q 0 0 0 0 L 0 0"===a)this.canvas.renderAll();else{var b=this.box.minX+(this.box.maxX-this.box.minX)/2,d=this.box.minY+(this.box.maxY-this.box.minY)/
2;this.canvas.contextTop.arc(b,d,3,0,2*Math.PI,!1);a=this.createPath(a);a.set({left:b,top:d,originX:"center",originY:"center"});this.canvas.add(a);a.setCoords();this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderAll();this.canvas.fire("path:created",{path:a})}}})})();
fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(d){this.canvas=d;this.points=[]},drawDot:function(d){d=this.addPoint(d);var a=this.canvas.contextTop,c=this.canvas.viewportTransform;a.save();a.transform(c[0],c[1],c[2],c[3],c[4],c[5]);a.fillStyle=d.fill;a.beginPath();a.arc(d.x,d.y,d.radius,0,2*Math.PI,!1);a.closePath();a.fill();a.restore()},onMouseDown:function(d){this.points.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.drawDot(d)},
onMouseMove:function(d){this.drawDot(d)},onMouseUp:function(){var d=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var a=[],c=0,b=this.points.length;c<b;c++){var e=this.points[c],e=new fabric.Circle({radius:e.radius,left:e.x,top:e.y,originX:"center",originY:"center",fill:e.fill});this.shadow&&e.setShadow(this.shadow);a.push(e)}a=new fabric.Group(a,{originX:"center",originY:"center"});a.canvas=this.canvas;this.canvas.add(a);this.canvas.fire("path:created",{path:a});this.canvas.clearContext(this.canvas.contextTop);
this._resetShadow();this.canvas.renderOnAddRemove=d;this.canvas.renderAll()},addPoint:function(d){d=new fabric.Point(d.x,d.y);var a=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,c=(new fabric.Color(this.color)).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();d.radius=a;d.fill=c;this.points.push(d);return d}});
fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(d){this.canvas=d;this.sprayChunks=[]},onMouseDown:function(d){this.sprayChunks.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.addSprayChunk(d);this.render()},onMouseMove:function(d){this.addSprayChunk(d);this.render()},onMouseUp:function(){var d=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=
!1;for(var a=[],c=0,b=this.sprayChunks.length;c<b;c++)for(var e=this.sprayChunks[c],f=0,g=e.length;f<g;f++){var h=new fabric.Rect({width:e[f].width,height:e[f].width,left:e[f].x+1,top:e[f].y+1,originX:"center",originY:"center",fill:this.color});this.shadow&&h.setShadow(this.shadow);a.push(h)}this.optimizeOverlapping&&(a=this._getOptimizedRects(a));a=new fabric.Group(a,{originX:"center",originY:"center"});a.canvas=this.canvas;this.canvas.add(a);this.canvas.fire("path:created",{path:a});this.canvas.clearContext(this.canvas.contextTop);
this._resetShadow();this.canvas.renderOnAddRemove=d;this.canvas.renderAll()},_getOptimizedRects:function(d){for(var a={},c,b=0,e=d.length;b<e;b++)c=d[b].left+""+d[b].top,a[c]||(a[c]=d[b]);d=[];for(c in a)d.push(a[c]);return d},render:function(){var d=this.canvas.contextTop;d.fillStyle=this.color;var a=this.canvas.viewportTransform;d.save();d.transform(a[0],a[1],a[2],a[3],a[4],a[5]);for(var a=0,c=this.sprayChunkPoints.length;a<c;a++){var b=this.sprayChunkPoints[a];"undefined"!==typeof b.opacity&&(d.globalAlpha=
b.opacity);d.fillRect(b.x,b.y,b.width,b.width)}d.restore()},addSprayChunk:function(d){this.sprayChunkPoints=[];for(var a,c,b,e=this.width/2,f=0;f<this.density;f++)a=fabric.util.getRandomInt(d.x-e,d.x+e),c=fabric.util.getRandomInt(d.y-e,d.y+e),b=this.dotWidthVariance?fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth,a=new fabric.Point(a,c),a.width=b,this.randomOpacity&&(a.opacity=fabric.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(a);
this.sprayChunks.push(this.sprayChunkPoints)}});
fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var d=fabric.document.createElement("canvas"),a=d.getContext("2d");d.width=d.height=25;a.fillStyle=this.color;a.beginPath();a.arc(10,10,10,0,2*Math.PI,!1);a.closePath();a.fill();return d},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles");
this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(d){d=this.callSuper("createPath",d);d.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction()});return d}});
(function(){var d=fabric.util.getPointer,a=fabric.util.degreesToRadians,c=fabric.util.radiansToDegrees,b=Math.atan2,e=Math.abs;fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(a,b){b||(b={});this._initStatic(a,b);this._initInteractive();this._createCacheCanvas();fabric.Canvas.activeInstance=this},uniScaleTransform:!1,centeredScaling:!1,centeredRotation:!1,interactive:!0,selection:!0,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",
selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,_initInteractive:function(){this._groupSelector=this._currentTransform=null;this._initWrapperElement();this._createUpperCanvas();this._initEventListeners();this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this);this.calcOffset()},_resetCurrentTransform:function(a){var b=
this._currentTransform;b.target.set({scaleX:b.original.scaleX,scaleY:b.original.scaleY,left:b.original.left,top:b.original.top});this._shouldCenterTransform(a,b.target)?"rotate"===b.action?this._setOriginToCenter(b.target):("center"!==b.originX&&(b.mouseXSign="right"===b.originX?-1:1),"center"!==b.originY&&(b.mouseYSign="bottom"===b.originY?-1:1),b.originX="center",b.originY="center"):(b.originX=b.original.originX,b.originY=b.original.originY)},containsPoint:function(a,b){var c=this.getPointer(a,
!0),d=this._normalizePointer(b,c);return b.containsPoint(d)||b._findTargetCorner(c)},_normalizePointer:function(a,b){var c=this.getActiveGroup(),d=b.x,e=b.y;c&&"group"!==a.type&&c.contains(a)&&(c=new fabric.Point(c.left,c.top),c=fabric.util.transformPoint(c,this.viewportTransform,!0),d-=c.x,e-=c.y);return{x:d,y:e}},isTargetTransparent:function(a,b,c){var d=a.hasBorders,e=a.transparentCorners;a.hasBorders=a.transparentCorners=!1;this._draw(this.contextCache,a);a.hasBorders=d;a.transparentCorners=e;
a=fabric.util.isTransparent(this.contextCache,b,c,this.targetFindTolerance);this.clearContext(this.contextCache);return a},_shouldClearSelection:function(a,b){var c=this.getActiveGroup(),d=this.getActiveObject();return!b||b&&c&&!c.contains(b)&&c!==b&&!a.shiftKey||b&&!b.evented||b&&!b.selectable&&d&&d!==b},_shouldCenterTransform:function(a,b){if(b){var c=this._currentTransform,d;"scale"===c.action||"scaleX"===c.action||"scaleY"===c.action?d=this.centeredScaling||b.centeredScaling:"rotate"===c.action&&
(d=this.centeredRotation||b.centeredRotation);return d?!a.altKey:a.altKey}},_getOriginFromCorner:function(a,b){var c={x:a.originX,y:a.originY};if("ml"===b||"tl"===b||"bl"===b)c.x="right";else if("mr"===b||"tr"===b||"br"===b)c.x="left";if("tl"===b||"mt"===b||"tr"===b)c.y="bottom";else if("bl"===b||"mb"===b||"br"===b)c.y="top";return c},_getActionFromCorner:function(a,b){var c="drag";b&&(c="ml"===b||"mr"===b?"scaleX":"mt"===b||"mb"===b?"scaleY":"mtr"===b?"rotate":"scale");return c},_setupCurrentTransform:function(b,
c){if(c){var d=this.getPointer(b),e=c._findTargetCorner(this.getPointer(b,!0)),f=this._getActionFromCorner(c,e),e=this._getOriginFromCorner(c,e);this._currentTransform={target:c,action:f,scaleX:c.scaleX,scaleY:c.scaleY,offsetX:d.x-c.left,offsetY:d.y-c.top,originX:e.x,originY:e.y,ex:d.x,ey:d.y,left:c.left,top:c.top,theta:a(c.angle),width:c.width*c.scaleX,mouseXSign:1,mouseYSign:1};this._currentTransform.original={left:c.left,top:c.top,scaleX:c.scaleX,scaleY:c.scaleY,originX:e.x,originY:e.y};this._resetCurrentTransform(b)}},
_translateObject:function(a,b){var c=this._currentTransform.target;c.get("lockMovementX")||c.set("left",a-this._currentTransform.offsetX);c.get("lockMovementY")||c.set("top",b-this._currentTransform.offsetY)},_scaleObject:function(a,b,c){var d=this._currentTransform,e=d.target,f=e.get("lockScalingX"),r=e.get("lockScalingY"),t=e.get("lockScalingFlip");if(!f||!r){var w=e.translateToOriginPoint(e.getCenterPoint(),d.originX,d.originY);a=e.toLocalPoint(new fabric.Point(a,b),d.originX,d.originY);this._setLocalMouse(a,
d);this._setObjectScale(a,d,f,r,c,t);e.setPositionByOrigin(w,d.originX,d.originY)}},_setObjectScale:function(a,b,c,d,e,f){var r=b.target,t=!1,w=!1;b.newScaleX=a.x/(r.width+r.strokeWidth);b.newScaleY=a.y/(r.height+r.strokeWidth);f&&0>=b.newScaleX&&b.newScaleX<r.scaleX&&(t=!0);f&&0>=b.newScaleY&&b.newScaleY<r.scaleY&&(w=!0);"equally"!==e||c||d?e?"x"!==e||r.get("lockUniScaling")?"y"!==e||r.get("lockUniScaling")||w||d||r.set("scaleY",b.newScaleY):t||c||r.set("scaleX",b.newScaleX):(t||c||r.set("scaleX",
b.newScaleX),w||d||r.set("scaleY",b.newScaleY)):t||w||this._scaleObjectEqually(a,r,b);t||w||this._flipObject(b)},_scaleObjectEqually:function(a,b,c){a=a.y+a.x;var d=(b.height+b.strokeWidth)*c.original.scaleY+(b.width+b.strokeWidth)*c.original.scaleX;c.newScaleX=c.original.scaleX*a/d;c.newScaleY=c.original.scaleY*a/d;b.set("scaleX",c.newScaleX);b.set("scaleY",c.newScaleY)},_flipObject:function(a){0>a.newScaleX&&("left"===a.originX?a.originX="right":"right"===a.originX&&(a.originX="left"));0>a.newScaleY&&
("top"===a.originY?a.originY="bottom":"bottom"===a.originY&&(a.originY="top"))},_setLocalMouse:function(a,b){var c=b.target;"right"===b.originX?a.x*=-1:"center"===b.originX&&(a.x=2*a.x*b.mouseXSign,0>a.x&&(b.mouseXSign=-b.mouseXSign));"bottom"===b.originY?a.y*=-1:"center"===b.originY&&(a.y=2*a.y*b.mouseYSign,0>a.y&&(b.mouseYSign=-b.mouseYSign));e(a.x)>c.padding?a.x=0>a.x?a.x+c.padding:a.x-c.padding:a.x=0;e(a.y)>c.padding?a.y=0>a.y?a.y+c.padding:a.y-c.padding:a.y=0},_rotateObject:function(a,d){var e=
this._currentTransform;if(!e.target.get("lockRotation")){var f=b(e.ey-e.top,e.ex-e.left),l=b(d-e.top,a-e.left),f=c(l-f+e.theta);0>f&&(f=360+f);e.target.angle=f}},setCursor:function(a){this.upperCanvasEl.style.cursor=a},_resetObjectTransform:function(a){a.scaleX=1;a.scaleY=1;a.setAngle(0)},_drawSelection:function(){var a=this.contextTop,b=this._groupSelector,c=b.left,d=b.top,f=e(c),q=e(d);a.fillStyle=this.selectionColor;a.fillRect(b.ex-(0<c?0:-c),b.ey-(0<d?0:-d),f,q);a.lineWidth=this.selectionLineWidth;
a.strokeStyle=this.selectionBorderColor;1<this.selectionDashArray.length?(c=b.ex+0.5-(0<c?0:f),b=b.ey+0.5-(0<d?0:q),a.beginPath(),fabric.util.drawDashedLine(a,c,b,c+f,b,this.selectionDashArray),fabric.util.drawDashedLine(a,c,b+q-1,c+f,b+q-1,this.selectionDashArray),fabric.util.drawDashedLine(a,c,b,c,b+q,this.selectionDashArray),fabric.util.drawDashedLine(a,c+f-1,b,c+f-1,b+q,this.selectionDashArray),a.closePath(),a.stroke()):a.strokeRect(b.ex+0.5-(0<c?0:f),b.ey+0.5-(0<d?0:q),f,q)},_isLastRenderedObject:function(a){return this.controlsAboveOverlay&&
this.lastRenderedObjectWithControlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay.visible&&this.containsPoint(a,this.lastRenderedObjectWithControlsAboveOverlay)&&this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(this.getPointer(a,!0))},findTarget:function(a,b){if(!this.skipTargetFind){if(this._isLastRenderedObject(a))return this.lastRenderedObjectWithControlsAboveOverlay;var c=this.getActiveGroup();if(c&&!b&&this.containsPoint(a,c))return c;c=this._searchPossibleTargets(a);
this._fireOverOutEvents(c);return c}},_fireOverOutEvents:function(a){a?this._hoveredTarget!==a&&(this.fire("mouse:over",{target:a}),a.fire("mouseover"),this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout")),this._hoveredTarget=a):this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout"),this._hoveredTarget=null)},_checkTarget:function(a,b,c){if(b&&b.visible&&b.evented&&this.containsPoint(a,
b)&&(!this.perPixelTargetFind&&!b.perPixelTargetFind||b.isEditing||!this.isTargetTransparent(b,c.x,c.y)))return!0},_searchPossibleTargets:function(a){for(var b,c=this.getPointer(a,!0),d=this._objects.length;d--;)if(this._checkTarget(a,this._objects[d],c)){this.relatedTarget=this._objects[d];b=this._objects[d];break}return b},getPointer:function(a,b,c){c||(c=this.upperCanvasEl);a=d(a,c);var e=c.getBoundingClientRect();this.calcOffset();a.x-=this._offset.left;a.y-=this._offset.top;b||(a=fabric.util.transformPoint(a,
fabric.util.invertTransform(this.viewportTransform)));0===e.width||0===e.height?c=b=1:(b=c.width/e.width,c=c.height/e.height);return{x:a.x*b,y:a.y*c}},_createUpperCanvas:function(){var a=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement();fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+a);this.wrapperEl.appendChild(this.upperCanvasEl);this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl);this._applyCanvasStyle(this.upperCanvasEl);
this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement();this.cacheCanvasEl.setAttribute("width",this.width);this.cacheCanvasEl.setAttribute("height",this.height);this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass});fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+
"px",position:"relative"});fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(a){var b=this.getWidth()||a.width,c=this.getHeight()||a.height;fabric.util.setStyle(a,{position:"absolute",width:b+"px",height:c+"px",left:0,top:0});a.width=b;a.height=c;fabric.util.makeElementUnselectable(a)},_copyCanvasStyle:function(a,b){b.style.cssText=a.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(a){this._activeObject&&
this._activeObject.set("active",!1);this._activeObject=a;a.set("active",!0)},setActiveObject:function(a,b){this._setActiveObject(a);this.renderAll();this.fire("object:selected",{target:a,e:b});a.fire("selected",{e:b});return this},getActiveObject:function(){return this._activeObject},_discardActiveObject:function(){this._activeObject&&this._activeObject.set("active",!1);this._activeObject=null},discardActiveObject:function(a){this._discardActiveObject();this.renderAll();this.fire("selection:cleared",
{e:a});return this},_setActiveGroup:function(a){(this._activeGroup=a)&&a.set("active",!0)},setActiveGroup:function(a,b){this._setActiveGroup(a);a&&(this.fire("object:selected",{target:a,e:b}),a.fire("selected",{e:b}));return this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var a=this.getActiveGroup();a&&a.destroy();this.setActiveGroup(null)},discardActiveGroup:function(a){this._discardActiveGroup();this.fire("selection:cleared",{e:a});return this},deactivateAll:function(){for(var a=
this.getObjects(),b=0,c=a.length;b<c;b++)a[b].set("active",!1);this._discardActiveGroup();this._discardActiveObject();return this},deactivateAllWithDispatch:function(a){var b=this.getActiveGroup()||this.getActiveObject();b&&this.fire("before:selection:cleared",{target:b,e:a});this.deactivateAll();b&&this.fire("selection:cleared",{e:a});return this},drawControls:function(a){var b=this.getActiveGroup();b?this._drawGroupControls(a,b):this._drawObjectsControls(a)},_drawGroupControls:function(a,b){b._renderControls(a)},
_drawObjectsControls:function(a){for(var b=0,c=this._objects.length;b<c;++b)this._objects[b]&&this._objects[b].active&&(this._objects[b]._renderControls(a),this.lastRenderedObjectWithControlsAboveOverlay=this._objects[b])}});for(var f in fabric.StaticCanvas)"prototype"!==f&&(fabric.Canvas[f]=fabric.StaticCanvas[f]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){});fabric.Element=fabric.Canvas})();
(function(){var d={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},a=fabric.util.addListener,c=fabric.util.removeListener;fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:"n-resize ne-resize e-resize se-resize s-resize sw-resize w-resize nw-resize".split(" "),_initEventListeners:function(){this._bindEvents();a(fabric.window,"resize",this._onResize);a(this.upperCanvasEl,"mousedown",this._onMouseDown);a(this.upperCanvasEl,"mousemove",this._onMouseMove);a(this.upperCanvasEl,"mousewheel",this._onMouseWheel);
a(this.upperCanvasEl,"touchstart",this._onMouseDown);a(this.upperCanvasEl,"touchmove",this._onMouseMove);"undefined"!==typeof Event&&"add"in Event&&(Event.add(this.upperCanvasEl,"gesture",this._onGesture),Event.add(this.upperCanvasEl,"drag",this._onDrag),Event.add(this.upperCanvasEl,"orientation",this._onOrientationChange),Event.add(this.upperCanvasEl,"shake",this._onShake))},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this);this._onMouseMove=this._onMouseMove.bind(this);this._onMouseUp=
this._onMouseUp.bind(this);this._onResize=this._onResize.bind(this);this._onGesture=this._onGesture.bind(this);this._onDrag=this._onDrag.bind(this);this._onShake=this._onShake.bind(this);this._onOrientationChange=this._onOrientationChange.bind(this);this._onMouseWheel=this._onMouseWheel.bind(this)},removeListeners:function(){c(fabric.window,"resize",this._onResize);c(this.upperCanvasEl,"mousedown",this._onMouseDown);c(this.upperCanvasEl,"mousemove",this._onMouseMove);c(this.upperCanvasEl,"mousewheel",
this._onMouseWheel);c(this.upperCanvasEl,"touchstart",this._onMouseDown);c(this.upperCanvasEl,"touchmove",this._onMouseMove);"undefined"!==typeof Event&&"remove"in Event&&(Event.remove(this.upperCanvasEl,"gesture",this._onGesture),Event.remove(this.upperCanvasEl,"drag",this._onDrag),Event.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),Event.remove(this.upperCanvasEl,"shake",this._onShake))},_onGesture:function(a,c){this.__onTransformGesture&&this.__onTransformGesture(a,c)},_onDrag:function(a,
c){this.__onDrag&&this.__onDrag(a,c)},_onMouseWheel:function(a,c){this.__onMouseWheel&&this.__onMouseWheel(a,c)},_onOrientationChange:function(a,c){this.__onOrientationChange&&this.__onOrientationChange(a,c)},_onShake:function(a,c){this.__onShake&&this.__onShake(a,c)},_onMouseDown:function(b){this.__onMouseDown(b);a(fabric.document,"touchend",this._onMouseUp);a(fabric.document,"touchmove",this._onMouseMove);c(this.upperCanvasEl,"mousemove",this._onMouseMove);c(this.upperCanvasEl,"touchmove",this._onMouseMove);
"touchstart"===b.type?c(this.upperCanvasEl,"mousedown",this._onMouseDown):(a(fabric.document,"mouseup",this._onMouseUp),a(fabric.document,"mousemove",this._onMouseMove))},_onMouseUp:function(b){this.__onMouseUp(b);c(fabric.document,"mouseup",this._onMouseUp);c(fabric.document,"touchend",this._onMouseUp);c(fabric.document,"mousemove",this._onMouseMove);c(fabric.document,"touchmove",this._onMouseMove);a(this.upperCanvasEl,"mousemove",this._onMouseMove);a(this.upperCanvasEl,"touchmove",this._onMouseMove);
if("touchend"===b.type){var d=this;setTimeout(function(){a(d.upperCanvasEl,"mousedown",d._onMouseDown)},400)}},_onMouseMove:function(a){!this.allowTouchScrolling&&a.preventDefault&&a.preventDefault();this.__onMouseMove(a)},_onResize:function(){this.calcOffset()},_shouldRender:function(a,c){var d=this.getActiveGroup()||this.getActiveObject();return!!(a&&(a.isMoving||a!==d)||!a&&d||!a&&!d&&!this._groupSelector||c&&this._previousPointer&&this.selection&&(c.x!==this._previousPointer.x||c.y!==this._previousPointer.y))},
__onMouseUp:function(a){var c;if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(a);else{this._currentTransform?(this._finalizeCurrentTransform(),c=this._currentTransform.target):c=this.findTarget(a,!0);var d=this._shouldRender(c,this.getPointer(a));this._maybeGroupObjects(a);c&&(c.isMoving=!1);d&&this.renderAll();this._handleCursorAndEvent(a,c)}},_handleCursorAndEvent:function(a,c){this._setCursorFromEvent(a,c);var d=this;setTimeout(function(){d._setCursorFromEvent(a,c)},
50);this.fire("mouse:up",{target:c,e:a});c&&c.fire("mouseup",{e:a})},_finalizeCurrentTransform:function(){var a=this._currentTransform.target;a._scaling&&(a._scaling=!1);a.setCoords();this.stateful&&a.hasStateChanged()&&(this.fire("object:modified",{target:a}),a.fire("modified"));this._restoreOriginXY(a)},_restoreOriginXY:function(a){if(this._previousOriginX&&this._previousOriginY){var c=a.translateToOriginPoint(a.getCenterPoint(),this._previousOriginX,this._previousOriginY);a.originX=this._previousOriginX;
a.originY=this._previousOriginY;a.left=c.x;a.top=c.y;this._previousOriginY=this._previousOriginX=null}},_onMouseDownInDrawingMode:function(a){this._isCurrentlyDrawing=!0;this.discardActiveObject(a).renderAll();this.clipTo&&fabric.util.clipContext(this,this.contextTop);var c=fabric.util.invertTransform(this.viewportTransform),c=fabric.util.transformPoint(this.getPointer(a,!0),c);this.freeDrawingBrush.onMouseDown(c);this.fire("mouse:down",{e:a})},_onMouseMoveInDrawingMode:function(a){if(this._isCurrentlyDrawing){var c=
fabric.util.invertTransform(this.viewportTransform),c=fabric.util.transformPoint(this.getPointer(a,!0),c);this.freeDrawingBrush.onMouseMove(c)}this.setCursor(this.freeDrawingCursor);this.fire("mouse:move",{e:a})},_onMouseUpInDrawingMode:function(a){this._isCurrentlyDrawing=!1;this.clipTo&&this.contextTop.restore();this.freeDrawingBrush.onMouseUp();this.fire("mouse:up",{e:a})},__onMouseDown:function(a){if(("which"in a?1===a.which:1===a.button)||fabric.isTouchSupported)if(this.isDrawingMode)this._onMouseDownInDrawingMode(a);
else if(!this._currentTransform){var c=this.findTarget(a),d=this.getPointer(a,!0);this._previousPointer=d;var g=this._shouldRender(c,d),h=this._shouldGroup(a,c);this._shouldClearSelection(a,c)?this._clearSelection(a,c,d):h&&(this._handleGrouping(a,c),c=this.getActiveGroup());c&&c.selectable&&!h&&(this._beforeTransform(a,c),this._setupCurrentTransform(a,c));g&&this.renderAll();this.fire("mouse:down",{target:c,e:a});c&&c.fire("mousedown",{e:a})}},_beforeTransform:function(a,c){this.stateful&&c.saveState();
if(c._findTargetCorner(this.getPointer(a)))this.onBeforeScaleRotate(c);c!==this.getActiveGroup()&&c!==this.getActiveObject()&&(this.deactivateAll(),this.setActiveObject(c,a))},_clearSelection:function(a,c,d){this.deactivateAllWithDispatch(a);c&&c.selectable?this.setActiveObject(c,a):this.selection&&(this._groupSelector={ex:d.x,ey:d.y,top:0,left:0})},_setOriginToCenter:function(a){this._previousOriginX=this._currentTransform.target.originX;this._previousOriginY=this._currentTransform.target.originY;
var c=a.getCenterPoint();a.originX="center";a.originY="center";a.left=c.x;a.top=c.y;this._currentTransform.left=a.left;this._currentTransform.top=a.top},_setCenterToOrigin:function(a){var c=a.translateToOriginPoint(a.getCenterPoint(),this._previousOriginX,this._previousOriginY);a.originX=this._previousOriginX;a.originY=this._previousOriginY;a.left=c.x;a.top=c.y;this._previousOriginY=this._previousOriginX=null},__onMouseMove:function(a){var c,d;if(this.isDrawingMode)this._onMouseMoveInDrawingMode(a);
else{var g=this._groupSelector;g?(d=this.getPointer(a,!0),g.left=d.x-g.ex,g.top=d.y-g.ey,this.renderTop()):this._currentTransform?this._transformObject(a):(c=this.findTarget(a),!c||c&&!c.selectable?this.setCursor(this.defaultCursor):this._setCursorFromEvent(a,c));this.fire("mouse:move",{target:c,e:a});c&&c.fire("mousemove",{e:a})}},_transformObject:function(a){var c=this.getPointer(a),d=this._currentTransform;d.reset=!1;d.target.isMoving=!0;this._beforeScaleTransform(a,d);this._performTransformAction(a,
d,c);this.renderAll()},_performTransformAction:function(a,c,d){var g=d.x;d=d.y;var h=c.target,n=c.action;"rotate"===n?(this._rotateObject(g,d),this._fire("rotating",h,a)):"scale"===n?(this._onScale(a,c,g,d),this._fire("scaling",h,a)):"scaleX"===n?(this._scaleObject(g,d,"x"),this._fire("scaling",h,a)):"scaleY"===n?(this._scaleObject(g,d,"y"),this._fire("scaling",h,a)):(this._translateObject(g,d),this._fire("moving",h,a),this.setCursor(this.moveCursor))},_fire:function(a,c,d){this.fire("object:"+a,
{target:c,e:d});c.fire(a,{e:d})},_beforeScaleTransform:function(a,c){if("scale"===c.action||"scaleX"===c.action||"scaleY"===c.action){var d=this._shouldCenterTransform(a,c.target);if(d&&("center"!==c.originX||"center"!==c.originY)||!d&&"center"===c.originX&&"center"===c.originY)this._resetCurrentTransform(a),c.reset=!0}},_onScale:function(a,c,d,g){!a.shiftKey&&!this.uniScaleTransform||c.target.get("lockUniScaling")?(c.reset||"scale"!==c.currentAction||this._resetCurrentTransform(a,c.target),c.currentAction=
"scaleEqually",this._scaleObject(d,g,"equally")):(c.currentAction="scale",this._scaleObject(d,g))},_setCursorFromEvent:function(a,c){if(c&&c.selectable){var d=this.getActiveGroup();(d=c._findTargetCorner&&(!d||!d.contains(c))&&c._findTargetCorner(this.getPointer(a,!0)))?this._setCornerCursor(d,c):this.setCursor(c.hoverCursor||this.hoverCursor)}else return this.setCursor(this.defaultCursor),!1;return!0},_setCornerCursor:function(a,c){if(a in d)this.setCursor(this._getRotatedCornerCursor(a,c));else if("mtr"===
a&&c.hasRotatingPoint)this.setCursor(this.rotationCursor);else return this.setCursor(this.defaultCursor),!1},_getRotatedCornerCursor:function(a,c){var f=Math.round(c.getAngle()%360/45);0>f&&(f+=8);f+=d[a];return this.cursorMap[f%8]}})})();
(function(){var d=Math.min,a=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(a,b){var d=this.getActiveObject();return a.shiftKey&&(this.getActiveGroup()||d&&d!==b)&&this.selection},_handleGrouping:function(a,b){if(b===this.getActiveGroup()&&(b=this.findTarget(a,!0),!b||b.isType("group")))return;this.getActiveGroup()?this._updateActiveGroup(b,a):this._createActiveGroup(b,a);this._activeGroup&&this._activeGroup.saveCoords()},_updateActiveGroup:function(a,b){var d=this.getActiveGroup();
if(d.contains(a)){if(d.removeWithUpdate(a),this._resetObjectTransform(d),a.set("active",!1),1===d.size()){this.discardActiveGroup(b);this.setActiveObject(d.item(0));return}}else d.addWithUpdate(a),this._resetObjectTransform(d);this.fire("selection:created",{target:d,e:b});d.set("active",!0)},_createActiveGroup:function(a,b){if(this._activeObject&&a!==this._activeObject){var d=this._createGroup(a);d.addWithUpdate();this.setActiveGroup(d);this._activeObject=null;this.fire("selection:created",{target:d,
e:b})}a.set("active",!0)},_createGroup:function(a){var b=this.getObjects();a=b.indexOf(this._activeObject)<b.indexOf(a)?[this._activeObject,a]:[a,this._activeObject];return new fabric.Group(a,{originX:"center",originY:"center",canvas:this})},_groupSelectedObjects:function(a){var b=this._collectObjects();1===b.length?this.setActiveObject(b[0],a):1<b.length&&(b=new fabric.Group(b.reverse(),{originX:"center",originY:"center",canvas:this}),b.addWithUpdate(),this.setActiveGroup(b,a),b.saveCoords(),this.fire("selection:created",
{target:b}),this.renderAll())},_collectObjects:function(){var c=[],b;b=this._groupSelector.ex;for(var e=this._groupSelector.ey,f=b+this._groupSelector.left,g=e+this._groupSelector.top,h=new fabric.Point(d(b,f),d(e,g)),n=new fabric.Point(a(b,f),a(e,g)),e=b===f&&e===g,f=this._objects.length;f--&&!((b=this._objects[f])&&b.selectable&&b.visible&&(b.intersectsWithRect(h,n)||b.isContainedWithinRect(h,n)||b.containsPoint(h)||b.containsPoint(n))&&(b.set("active",!0),c.push(b),e)););return c},_maybeGroupObjects:function(a){this.selection&&
this._groupSelector&&this._groupSelectedObjects(a);if(a=this.getActiveGroup())a.setObjectsCoords().setCoords(),a.isMoving=!1,this.setCursor(this.defaultCursor);this._currentTransform=this._groupSelector=null}})})();
fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(d){d||(d={});var a=d.format||"png",c=d.quality||1,b=d.multiplier||1;d={left:d.left,top:d.top,width:d.width,height:d.height};return 1!==b?this.__toDataURLWithMultiplier(a,c,d,b):this.__toDataURL(a,c,d)},__toDataURL:function(d,a,c){this.renderAll(!0);var b=this.upperCanvasEl||this.lowerCanvasEl;c=this.__getCroppedCanvas(b,c);"jpg"===d&&(d="jpeg");d=fabric.StaticCanvas.supports("toDataURLWithQuality")?(c||b).toDataURL("image/"+
d,a):(c||b).toDataURL("image/"+d);this.contextTop&&this.clearContext(this.contextTop);this.renderAll();return d},__getCroppedCanvas:function(d,a){var c,b;if("left"in a||"top"in a||"width"in a||"height"in a)c=fabric.util.createCanvasElement(),b=c.getContext("2d"),c.width=a.width||this.width,c.height=a.height||this.height,b.drawImage(d,-a.left||0,-a.top||0);return c},__toDataURLWithMultiplier:function(d,a,c,b){var e=this.getWidth(),f=this.getHeight(),g=e*b,h=f*b,n=this.getActiveObject(),k=this.getActiveGroup(),
l=this.contextTop||this.contextContainer;1<b&&this.setWidth(g).setHeight(h);l.scale(b,b);c.left&&(c.left*=b);c.top&&(c.top*=b);c.width?c.width*=b:1>b&&(c.width=g);c.height?c.height*=b:1>b&&(c.height=h);k?this._tempRemoveBordersControlsFromGroup(k):n&&this.deactivateAll&&this.deactivateAll();this.renderAll(!0);d=this.__toDataURL(d,a,c);this.width=e;this.height=f;l.scale(1/b,1/b);this.setWidth(e).setHeight(f);k?this._restoreBordersControlsOnGroup(k):n&&this.setActiveObject&&this.setActiveObject(n);
this.contextTop&&this.clearContext(this.contextTop);this.renderAll();return d},toDataURLWithMultiplier:function(d,a,c){return this.toDataURL({format:d,multiplier:a,quality:c})},_tempRemoveBordersControlsFromGroup:function(d){d.origHasControls=d.hasControls;d.origBorderColor=d.borderColor;d.hasControls=!0;d.borderColor="rgba(0,0,0,0)";d.forEachObject(function(a){a.origBorderColor=a.borderColor;a.borderColor="rgba(0,0,0,0)"})},_restoreBordersControlsOnGroup:function(d){d.hideControls=d.origHideControls;
d.borderColor=d.origBorderColor;d.forEachObject(function(a){a.borderColor=a.origBorderColor;delete a.origBorderColor})}});
fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(d,a,c){return this.loadFromJSON(d,a,c)},loadFromJSON:function(d,a,c){if(d){var b="string"===typeof d?JSON.parse(d):d;this.clear();var e=this;this._enlivenObjects(b.objects,function(){e._setBgOverlay(b,a)},c);return this}},_setBgOverlay:function(d,a){var c=this,b={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(d.backgroundImage||d.overlayImage||d.background||d.overlay){var e=function(){b.backgroundImage&&
b.overlayImage&&b.backgroundColor&&b.overlayColor&&(c.renderAll(),a&&a())};this.__setBgOverlay("backgroundImage",d.backgroundImage,b,e);this.__setBgOverlay("overlayImage",d.overlayImage,b,e);this.__setBgOverlay("backgroundColor",d.background,b,e);this.__setBgOverlay("overlayColor",d.overlay,b,e);e()}else a&&a()},__setBgOverlay:function(d,a,c,b){var e=this;if(a)if("backgroundImage"===d||"overlayImage"===d)fabric.Image.fromObject(a,function(a){e[d]=a;c[d]=!0;b&&b()});else this["set"+fabric.util.string.capitalize(d,
!0)](a,function(){c[d]=!0;b&&b()});else c[d]=!0},_enlivenObjects:function(d,a,c){var b=this;if(d&&0!==d.length){var e=this.renderOnAddRemove;this.renderOnAddRemove=!1;fabric.util.enlivenObjects(d,function(c){c.forEach(function(a,c){b.insertAt(a,c,!0)});b.renderOnAddRemove=e;a&&a()},null,c)}else a&&a()},_toDataURL:function(d,a){this.clone(function(c){a(c.toDataURL(d))})},_toDataURLWithMultiplier:function(d,a,c){this.clone(function(b){c(b.toDataURLWithMultiplier(d,a))})},clone:function(d,a){var c=JSON.stringify(this.toJSON(a));
this.cloneWithoutData(function(a){a.loadFromJSON(c,function(){d&&d(a)})})},cloneWithoutData:function(d){var a=fabric.document.createElement("canvas");a.width=this.getWidth();a.height=this.getHeight();var c=new fabric.Canvas(a);c.clipTo=this.clipTo;this.backgroundImage?(c.setBackgroundImage(this.backgroundImage.src,function(){c.renderAll();d&&d(c)}),c.backgroundImageOpacity=this.backgroundImageOpacity,c.backgroundImageStretch=this.backgroundImageStretch):d&&d(c)}});
(function(d){var a=d.fabric||(d.fabric={});d=a.util.object.extend;var c=a.util.toFixed,b=a.util.string.capitalize,e=a.util.degreesToRadians,f=a.StaticCanvas.supports("setLineDash");a.Object||(a.Object=a.util.createClass({type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,cornerSize:12,transparentCorners:!0,hoverCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",centeredScaling:!1,
centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"source-over",backgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:0.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:0.01,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,
lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockScalingFlip:!1,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule shadow clipTo visible backgroundColor".split(" "),initialize:function(a){a&&this.setOptions(a)},_initGradient:function(b){!b.fill||!b.fill.colorStops||b.fill instanceof a.Gradient||this.set("fill",new a.Gradient(b.fill))},_initPattern:function(b){!b.fill||
!b.fill.source||b.fill instanceof a.Pattern||this.set("fill",new a.Pattern(b.fill));!b.stroke||!b.stroke.source||b.stroke instanceof a.Pattern||this.set("stroke",new a.Pattern(b.stroke))},_initClipping:function(b){b.clipTo&&"string"===typeof b.clipTo&&(b=a.util.getFunctionBody(b.clipTo),"undefined"!==typeof b&&(this.clipTo=new Function("ctx",b)))},setOptions:function(a){for(var b in a)this.set(b,a[b]);this._initGradient(a);this._initPattern(a);this._initClipping(a)},transform:function(a,b){this.group&&
this.group.transform(a,b);a.globalAlpha=this.opacity;var c=b?this._getLeftTopCoords():this.getCenterPoint();a.translate(c.x,c.y);a.rotate(e(this.angle));a.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(b){var d=a.Object.NUM_FRACTION_DIGITS,d={type:this.type,originX:this.originX,originY:this.originY,left:c(this.left,d),top:c(this.top,d),width:c(this.width,d),height:c(this.height,d),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&
this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:c(this.strokeWidth,d),strokeDashArray:this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:c(this.strokeMiterLimit,d),scaleX:c(this.scaleX,d),scaleY:c(this.scaleY,d),angle:c(this.getAngle(),d),flipX:this.flipX,flipY:this.flipY,opacity:c(this.opacity,d),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),
backgroundColor:this.backgroundColor};this.includeDefaultValues||(d=this._removeDefaultValues(d));a.util.populateWithProperties(this,d,b);return d},toDatalessObject:function(a){return this.toObject(a)},_removeDefaultValues:function(b){var c=a.util.getKlass(b.type).prototype;c.stateProperties.forEach(function(a){b[a]===c[a]&&delete b[a]});return b},toString:function(){return"#<fabric."+b(this.type)+">"},get:function(a){return this[a]},_setObject:function(a){for(var b in a)this._set(b,a[b])},set:function(a,
b){"object"===typeof a?this._setObject(a):"function"===typeof b&&"clipTo"!==a?this._set(a,b(this.get(a))):this._set(a,b);return this},_set:function(b,d){if("scaleX"===b||"scaleY"===b)d=this._constrainScale(d);"scaleX"===b&&0>d?(this.flipX=!this.flipX,d*=-1):"scaleY"===b&&0>d?(this.flipY=!this.flipY,d*=-1):"width"===b||"height"===b?this.minScaleLimit=c(Math.min(0.1,1/Math.max(this.width,this.height)),2):"shadow"!==b||!d||d instanceof a.Shadow||(d=new a.Shadow(d));this[b]=d;return this},toggle:function(a){var b=
this.get(a);"boolean"===typeof b&&this.set(a,!b);return this},setSourcePath:function(a){this.sourcePath=a;return this},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:[1,0,0,1,0,0]},render:function(b,c){if(0!==this.width&&0!==this.height&&this.visible){b.save();this._setupFillRule(b);this._transform(b,c);this._setStrokeStyles(b);this._setFillStyles(b);if(this.group&&"path-group"===this.group.type){b.translate(-this.group.width/2,-this.group.height/
2);var d=this.transformMatrix;d&&b.transform.apply(b,d)}b.globalAlpha=this.group?b.globalAlpha*this.opacity:this.opacity;this._setShadow(b);this.clipTo&&a.util.clipContext(this,b);this._render(b,c);this.clipTo&&b.restore();this._removeShadow(b);this._restoreFillRule(b);b.restore()}},_transform:function(a,b){var c=this.transformMatrix;c&&!this.group&&a.setTransform.apply(a,c);b||this.transform(a)},_setStrokeStyles:function(a){this.stroke&&(a.lineWidth=this.strokeWidth,a.lineCap=this.strokeLineCap,
a.lineJoin=this.strokeLineJoin,a.miterLimit=this.strokeMiterLimit,a.strokeStyle=this.stroke.toLive?this.stroke.toLive(a):this.stroke)},_setFillStyles:function(a){this.fill&&(a.fillStyle=this.fill.toLive?this.fill.toLive(a):this.fill)},_renderControls:function(b,c){var d=this.getViewportTransform();b.save();if(this.active&&!c){var f;this.group&&(f=a.util.transformPoint(this.group.getCenterPoint(),d),b.translate(f.x,f.y),b.rotate(e(this.group.angle)));f=a.util.transformPoint(this.getCenterPoint(),d,
null!=this.group);this.group&&(f.x*=this.group.scaleX,f.y*=this.group.scaleY);b.translate(f.x,f.y);b.rotate(e(this.angle));this.drawBorders(b);this.drawControls(b)}b.restore()},_setShadow:function(a){this.shadow&&(a.shadowColor=this.shadow.color,a.shadowBlur=this.shadow.blur,a.shadowOffsetX=this.shadow.offsetX,a.shadowOffsetY=this.shadow.offsetY)},_removeShadow:function(a){this.shadow&&(a.shadowColor="",a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0)},_renderFill:function(a){this.fill&&(a.save(),
this.fill.toLive&&a.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0),this.fill.gradientTransform&&a.transform.apply(a,this.fill.gradientTransform),"destination-over"===this.fillRule?a.fill("evenodd"):a.fill(),a.restore(),this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a))},_renderStroke:function(a){this.stroke&&0!==this.strokeWidth&&(a.save(),this.strokeDashArray?(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),
f?(a.setLineDash(this.strokeDashArray),this._stroke&&this._stroke(a)):this._renderDashedStroke&&this._renderDashedStroke(a),a.stroke()):(this.stroke.gradientTransform&&a.transform.apply(a,this.stroke.gradientTransform),this._stroke?this._stroke(a):a.stroke()),this._removeShadow(a),a.restore())},clone:function(b,c){return this.constructor.fromObject?this.constructor.fromObject(this.toObject(c),b):new a.Object(this.toObject(c))},cloneAsImage:function(b){var c=this.toDataURL();a.util.loadImage(c,function(c){b&&
b(new a.Image(c))});return this},toDataURL:function(b){b||(b={});var c=a.util.createCanvasElement(),d=this.getBoundingRect();c.width=d.width;c.height=d.height;a.util.wrapElement(c,"div");d=new a.Canvas(c);"jpg"===b.format&&(b.format="jpeg");"jpeg"===b.format&&(d.backgroundColor="#fff");var e={active:this.get("active"),left:this.getLeft(),top:this.getTop()};this.set("active",!1);this.setPositionByOrigin(new a.Point(c.width/2,c.height/2),"center","center");c=this.canvas;d.add(this);b=d.toDataURL(b);
this.set(e).setCoords();this.canvas=c;d.dispose();return b},isType:function(a){return this.type===a},complexity:function(){return 0},toJSON:function(a){return this.toObject(a)},setGradient:function(b,c){c||(c={});var d={colorStops:[]};d.type=c.type||(c.r1||c.r2?"radial":"linear");d.coords={x1:c.x1,y1:c.y1,x2:c.x2,y2:c.y2};if(c.r1||c.r2)d.coords.r1=c.r1,d.coords.r2=c.r2;for(var e in c.colorStops){var f=new a.Color(c.colorStops[e]);d.colorStops.push({offset:e,color:f.toRgb(),opacity:f.getAlpha()})}return this.set(b,
a.Gradient.forObject(this,d))},setPatternFill:function(b){return this.set("fill",new a.Pattern(b))},setShadow:function(b){return this.set("shadow",b?new a.Shadow(b):null)},setColor:function(a){this.set("fill",a);return this},setAngle:function(a){var b=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;b&&this._setOriginToCenter();this.set("angle",a);b&&this._resetOrigin();return this},centerH:function(){this.canvas.centerObjectH(this);return this},centerV:function(){this.canvas.centerObjectV(this);
return this},center:function(){this.canvas.centerObject(this);return this},remove:function(){this.canvas.remove(this);return this},getLocalPointer:function(a,b){b=b||this.canvas.getPointer(a);var c=this.translateToOriginPoint(this.getCenterPoint(),"left","top");return{x:b.x-c.x,y:b.y-c.y}},_setupFillRule:function(a){this.fillRule&&(this._prevFillRule=a.globalCompositeOperation,a.globalCompositeOperation=this.fillRule)},_restoreFillRule:function(a){this.fillRule&&this._prevFillRule&&(a.globalCompositeOperation=
this._prevFillRule)}}),a.util.createAccessors(a.Object),a.Object.prototype.rotate=a.Object.prototype.setAngle,d(a.Object.prototype,a.Observable),a.Object.NUM_FRACTION_DIGITS=2,a.Object.__uid=0)})("undefined"!==typeof exports?exports:this);
(function(){var d=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{translateToCenterPoint:function(a,c,b){var e=a.x,f=a.y,g=this.stroke?this.strokeWidth:0;"left"===c?e=a.x+(this.getWidth()+g*this.scaleX)/2:"right"===c&&(e=a.x-(this.getWidth()+g*this.scaleX)/2);"top"===b?f=a.y+(this.getHeight()+g*this.scaleY)/2:"bottom"===b&&(f=a.y-(this.getHeight()+g*this.scaleY)/2);return fabric.util.rotatePoint(new fabric.Point(e,f),a,d(this.angle))},translateToOriginPoint:function(a,
c,b){var e=a.x,f=a.y,g=this.stroke?this.strokeWidth:0;"left"===c?e=a.x-(this.getWidth()+g*this.scaleX)/2:"right"===c&&(e=a.x+(this.getWidth()+g*this.scaleX)/2);"top"===b?f=a.y-(this.getHeight()+g*this.scaleY)/2:"bottom"===b&&(f=a.y+(this.getHeight()+g*this.scaleY)/2);return fabric.util.rotatePoint(new fabric.Point(e,f),a,d(this.angle))},getCenterPoint:function(){var a=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(a,this.originX,this.originY)},getPointByOrigin:function(a,
c){var b=this.getCenterPoint();return this.translateToOriginPoint(b,a,c)},toLocalPoint:function(a,c,b){var e=this.getCenterPoint(),f=this.stroke?this.strokeWidth:0;c&&b?(c="left"===c?e.x-(this.getWidth()+f*this.scaleX)/2:"right"===c?e.x+(this.getWidth()+f*this.scaleX)/2:e.x,b="top"===b?e.y-(this.getHeight()+f*this.scaleY)/2:"bottom"===b?e.y+(this.getHeight()+f*this.scaleY)/2:e.y):(c=this.left,b=this.top);return fabric.util.rotatePoint(new fabric.Point(a.x,a.y),e,-d(this.angle)).subtractEquals(new fabric.Point(c,
b))},setPositionByOrigin:function(a,c,b){a=this.translateToCenterPoint(a,c,b);a=this.translateToOriginPoint(a,this.originX,this.originY);this.set("left",a.x);this.set("top",a.y)},adjustPosition:function(a){var c=d(this.angle),b=this.getWidth()/2,e=Math.cos(c)*b,b=Math.sin(c)*b,f=this.getWidth(),g=Math.cos(c)*f,c=Math.sin(c)*f;"center"===this.originX&&"left"===a||"right"===this.originX&&"center"===a?(this.left-=e,this.top-=b):"left"===this.originX&&"center"===a||"center"===this.originX&&"right"===
a?(this.left+=e,this.top+=b):"left"===this.originX&&"right"===a?(this.left+=g,this.top+=c):"right"===this.originX&&"left"===a&&(this.left-=g,this.top-=c);this.setCoords();this.originX=a},_setOriginToCenter:function(){this._originalOriginX=this.originX;this._originalOriginY=this.originY;var a=this.getCenterPoint();this.originY=this.originX="center";this.left=a.x;this.top=a.y},_resetOrigin:function(){var a=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);
this.originX=this._originalOriginX;this.originY=this._originalOriginY;this.left=a.x;this.top=a.y;this._originalOriginY=this._originalOriginX=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","center")}})})();
(function(){var d=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,intersectsWithRect:function(a,c){var b=this.oCoords,d=new fabric.Point(b.tl.x,b.tl.y),f=new fabric.Point(b.tr.x,b.tr.y),g=new fabric.Point(b.bl.x,b.bl.y),b=new fabric.Point(b.br.x,b.br.y);return"Intersection"===fabric.Intersection.intersectPolygonRectangle([d,f,b,g],a,c).status},intersectsWithObject:function(a){function c(a){return{tl:new fabric.Point(a.tl.x,a.tl.y),tr:new fabric.Point(a.tr.x,
a.tr.y),bl:new fabric.Point(a.bl.x,a.bl.y),br:new fabric.Point(a.br.x,a.br.y)}}var b=c(this.oCoords);a=c(a.oCoords);return"Intersection"===fabric.Intersection.intersectPolygonPolygon([b.tl,b.tr,b.br,b.bl],[a.tl,a.tr,a.br,a.bl]).status},isContainedWithinObject:function(a){var c=a.getBoundingRect();a=new fabric.Point(c.left,c.top);c=new fabric.Point(c.left+c.width,c.top+c.height);return this.isContainedWithinRect(a,c)},isContainedWithinRect:function(a,c){var b=this.getBoundingRect();return b.left>=
a.x&&b.left+b.width<=c.x&&b.top>=a.y&&b.top+b.height<=c.y},containsPoint:function(a){var c=this._getImageLines(this.oCoords);a=this._findCrossPoints(a,c);return 0!==a&&1===a%2},_getImageLines:function(a){return{topline:{o:a.tl,d:a.tr},rightline:{o:a.tr,d:a.br},bottomline:{o:a.br,d:a.bl},leftline:{o:a.bl,d:a.tl}}},_findCrossPoints:function(a,c){var b,d,f,g=0,h;for(h in c)if(f=c[h],!(f.o.y<a.y&&f.d.y<a.y||f.o.y>=a.y&&f.d.y>=a.y)&&(f.o.x===f.d.x&&f.o.x>=a.x?b=f.o.x:(b=(f.d.y-f.o.y)/(f.d.x-f.o.x),d=a.y-
0*a.x,f=f.o.y-b*f.o.x,b=-(d-f)/(0-b)),b>=a.x&&(g+=1),2===g))break;return g},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||this.setCoords();var a=[this.oCoords.tl.x,this.oCoords.tr.x,this.oCoords.br.x,this.oCoords.bl.x],c=fabric.util.array.min(a),a=fabric.util.array.max(a),a=Math.abs(c-a),b=[this.oCoords.tl.y,this.oCoords.tr.y,this.oCoords.br.y,this.oCoords.bl.y],d=
fabric.util.array.min(b),b=fabric.util.array.max(b),b=Math.abs(d-b);return{left:c,top:d,width:a,height:b}},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*this.scaleY},_constrainScale:function(a){return Math.abs(a)<this.minScaleLimit?0>a?-this.minScaleLimit:this.minScaleLimit:a},scale:function(a){a=this._constrainScale(a);0>a&&(this.flipX=!this.flipX,this.flipY=!this.flipY,a*=-1);this.scaleY=this.scaleX=a;this.setCoords();return this},scaleToWidth:function(a){var c=
this.getBoundingRectWidth()/this.getWidth();return this.scale(a/this.width/c)},scaleToHeight:function(a){var c=this.getBoundingRectHeight()/this.getHeight();return this.scale(a/this.height/c)},setCoords:function(){var a=1<this.strokeWidth?this.strokeWidth:0,c=d(this.angle),b=this.getViewportTransform(),e=function(a){return fabric.util.transformPoint(a,b)},f=this.width,g=this.height,h="round"===this.strokeLineCap||"square"===this.strokeLineCap,n="line"===this.type&&1===this.width,k="line"===this.type&&
1===this.height,l=h&&k||"line"!==this.type,h=h&&n||"line"!==this.type;n?f=a:k&&(g=a);l&&(f+=a);h&&(g+=a);this.currentWidth=f*this.scaleX;this.currentHeight=g*this.scaleY;0>this.currentWidth&&(this.currentWidth=Math.abs(this.currentWidth));var g=Math.sqrt(Math.pow(this.currentWidth/2,2)+Math.pow(this.currentHeight/2,2)),a=Math.atan(isFinite(this.currentHeight/this.currentWidth)?this.currentHeight/this.currentWidth:0),f=Math.cos(a+c)*g,g=Math.sin(a+c)*g,l=Math.sin(c),h=Math.cos(c),n=this.getCenterPoint(),
q=new fabric.Point(this.currentWidth,this.currentHeight),r=new fabric.Point(n.x-f,n.y-g),t=new fabric.Point(r.x+q.x*h,r.y+q.x*l),w=new fabric.Point(r.x-q.y*l,r.y+q.y*h),D=new fabric.Point(r.x+q.x/2*h,r.y+q.x/2*l),f=e(r),g=e(t),n=e(new fabric.Point(t.x-q.y*l,t.y+q.y*h)),k=e(w),r=e(new fabric.Point(r.x-q.y/2*l,r.y+q.y/2*h)),E=e(D),t=e(new fabric.Point(t.x-q.y/2*l,t.y+q.y/2*h)),l=e(new fabric.Point(w.x+q.x/2*h,w.y+q.x/2*l)),e=e(new fabric.Point(D.x,D.y)),h=Math.cos(a+c)*this.padding*Math.sqrt(2),c=Math.sin(a+
c)*this.padding*Math.sqrt(2),f=f.add(new fabric.Point(-h,-c)),g=g.add(new fabric.Point(c,-h)),n=n.add(new fabric.Point(h,c)),k=k.add(new fabric.Point(-c,h)),r=r.add(new fabric.Point((-h-c)/2,(-c+h)/2)),E=E.add(new fabric.Point((c-h)/2,-(c+h)/2)),t=t.add(new fabric.Point((c+h)/2,(c-h)/2)),l=l.add(new fabric.Point((h-c)/2,(h+c)/2)),e=e.add(new fabric.Point((c-h)/2,-(c+h)/2));this.oCoords={tl:f,tr:g,br:n,bl:k,ml:r,mt:E,mr:t,mb:l,mtr:e};this._setCornerCoords&&this._setCornerCoords();return this}})})();
fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){this.group?fabric.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this);return this},bringToFront:function(){this.group?fabric.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this);return this},sendBackwards:function(d){this.group?fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,d):this.canvas.sendBackwards(this,d);return this},bringForward:function(d){this.group?
fabric.StaticCanvas.prototype.bringForward.call(this.group,this,d):this.canvas.bringForward(this,d);return this},moveTo:function(d){this.group?fabric.StaticCanvas.prototype.moveTo.call(this.group,this,d):this.canvas.moveTo(this,d);return this}});
fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(){var d=this.fill?this.fill.toLive?"url(#SVGID_"+this.fill.id+")":this.fill:"none",a="destination-over"===this.fillRule?"evenodd":this.fillRule,c=this.stroke?this.stroke.toLive?"url(#SVGID_"+this.stroke.id+")":this.stroke:"none",b=this.strokeWidth?this.strokeWidth:"0",e=this.strokeDashArray?this.strokeDashArray.join(" "):"";return["stroke: ",c,"; stroke-width: ",b,"; stroke-dasharray: ",e,"; stroke-linecap: ",this.strokeLineCap?
this.strokeLineCap:"butt","; stroke-linejoin: ",this.strokeLineJoin?this.strokeLineJoin:"miter","; stroke-miterlimit: ",this.strokeMiterLimit?this.strokeMiterLimit:"4","; fill: ",d,"; fill-rule: ",a,"; opacity: ","undefined"!==typeof this.opacity?this.opacity:"1",";",this.shadow&&"text"!==this.type?"filter: url(#SVGID_"+this.shadow.id+");":"",this.visible?"":" visibility: hidden;"].join("")},getSvgTransform:function(){if(this.group)return"";var d=fabric.util.toFixed,a=this.getAngle(),c=this.getViewportTransform(),
b=fabric.util.transformPoint(this.getCenterPoint(),c),e=fabric.Object.NUM_FRACTION_DIGITS,b="path-group"===this.type?"":"translate("+d(b.x,e)+" "+d(b.y,e)+")",a=0!==a?" rotate("+d(a,e)+")":"",d=1===this.scaleX&&1===this.scaleY&&1===c[0]&&1===c[3]?"":" scale("+d(this.scaleX*c[0],e)+" "+d(this.scaleY*c[3],e)+")",e="path-group"===this.type?this.width*c[0]:0,c="path-group"===this.type?this.height*c[3]:0;return[b,a,d,this.flipX?" matrix(-1 0 0 1 "+e+" 0) ":"",this.flipY?" matrix(1 0 0 -1 0 "+c+")":""].join("")},
getSvgTransformMatrix:function(){return this.transformMatrix?" matrix("+this.transformMatrix.join(" ")+")":""},_createBaseSVGMarkup:function(){var d=[];this.fill&&this.fill.toLive&&d.push(this.fill.toSVG(this,!1));this.stroke&&this.stroke.toLive&&d.push(this.stroke.toSVG(this,!1));this.shadow&&d.push(this.shadow.toSVG(this));return d}});
fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(){return this.stateProperties.some(function(d){return this.get(d)!==this.originalState[d]},this)},saveState:function(d){this.stateProperties.forEach(function(a){this.originalState[a]=this.get(a)},this);d&&d.stateProperties&&d.stateProperties.forEach(function(a){this.originalState[a]=this.get(a)},this);return this},setupState:function(){this.originalState={};this.saveState();return this}});
(function(){var d=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(a){if(!this.hasControls||!this.active)return!1;var c=a.x;a=a.y;var b,d;for(d in this.oCoords)if(this.isControlVisible(d)&&("mtr"!==d||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==d&&"mr"!==d&&"mb"!==d&&"ml"!==d)&&(b=this._getImageLines(this.oCoords[d].corner),b=this._findCrossPoints({x:c,y:a},b),0!==b&&1===b%2))return this.__corner=d;
return!1},_setCornerCoords:function(){var a=this.oCoords,c=d(this.angle),b=d(45-this.angle),e=Math.sqrt(2*Math.pow(this.cornerSize,2))/2,f=e*Math.cos(b),b=e*Math.sin(b),e=Math.sin(c),c=Math.cos(c);a.tl.corner={tl:{x:a.tl.x-b,y:a.tl.y-f},tr:{x:a.tl.x+f,y:a.tl.y-b},bl:{x:a.tl.x-f,y:a.tl.y+b},br:{x:a.tl.x+b,y:a.tl.y+f}};a.tr.corner={tl:{x:a.tr.x-b,y:a.tr.y-f},tr:{x:a.tr.x+f,y:a.tr.y-b},br:{x:a.tr.x+b,y:a.tr.y+f},bl:{x:a.tr.x-f,y:a.tr.y+b}};a.bl.corner={tl:{x:a.bl.x-b,y:a.bl.y-f},bl:{x:a.bl.x-f,y:a.bl.y+
b},br:{x:a.bl.x+b,y:a.bl.y+f},tr:{x:a.bl.x+f,y:a.bl.y-b}};a.br.corner={tr:{x:a.br.x+f,y:a.br.y-b},bl:{x:a.br.x-f,y:a.br.y+b},br:{x:a.br.x+b,y:a.br.y+f},tl:{x:a.br.x-b,y:a.br.y-f}};a.ml.corner={tl:{x:a.ml.x-b,y:a.ml.y-f},tr:{x:a.ml.x+f,y:a.ml.y-b},bl:{x:a.ml.x-f,y:a.ml.y+b},br:{x:a.ml.x+b,y:a.ml.y+f}};a.mt.corner={tl:{x:a.mt.x-b,y:a.mt.y-f},tr:{x:a.mt.x+f,y:a.mt.y-b},bl:{x:a.mt.x-f,y:a.mt.y+b},br:{x:a.mt.x+b,y:a.mt.y+f}};a.mr.corner={tl:{x:a.mr.x-b,y:a.mr.y-f},tr:{x:a.mr.x+f,y:a.mr.y-b},bl:{x:a.mr.x-
f,y:a.mr.y+b},br:{x:a.mr.x+b,y:a.mr.y+f}};a.mb.corner={tl:{x:a.mb.x-b,y:a.mb.y-f},tr:{x:a.mb.x+f,y:a.mb.y-b},bl:{x:a.mb.x-f,y:a.mb.y+b},br:{x:a.mb.x+b,y:a.mb.y+f}};a.mtr.corner={tl:{x:a.mtr.x-b+e*this.rotatingPointOffset,y:a.mtr.y-f-c*this.rotatingPointOffset},tr:{x:a.mtr.x+f+e*this.rotatingPointOffset,y:a.mtr.y-b-c*this.rotatingPointOffset},bl:{x:a.mtr.x-f+e*this.rotatingPointOffset,y:a.mtr.y+b-c*this.rotatingPointOffset},br:{x:a.mtr.x+b+e*this.rotatingPointOffset,y:a.mtr.y+f-c*this.rotatingPointOffset}}},
drawBorders:function(a){if(!this.hasBorders)return this;var c=this.padding,b=2*c,d=this.getViewportTransform();a.save();a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;a.strokeStyle=this.borderColor;var f=1/this._constrainScale(this.scaleX),g=1/this._constrainScale(this.scaleY);a.lineWidth=1/this.borderScaleFactor;var h=this.getWidth(),n=this.getHeight(),k=1<this.strokeWidth?this.strokeWidth:0,l="round"===this.strokeLineCap||"square"===this.strokeLineCap,q="line"===this.type&&1===this.width,
r="line"===this.type&&1===this.height,t=l&&r||"line"!==this.type,l=l&&q||"line"!==this.type;q?h=k/f:r&&(n=k/g);t&&(h+=k/f);l&&(n+=k/g);f=fabric.util.transformPoint(new fabric.Point(h,n),d,!0);d=f.x;f=f.y;this.group&&(d*=this.group.scaleX,f*=this.group.scaleY);a.strokeRect(~~(-(d/2)-c)-0.5,~~(-(f/2)-c)-0.5,~~(d+b)+1,~~(f+b)+1);this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls&&(c=(-f-2*c)/2,a.beginPath(),a.moveTo(0,c),a.lineTo(0,c-this.rotatingPointOffset),
a.closePath(),a.stroke());a.restore();return this},drawControls:function(a){if(!this.hasControls)return this;var c=this.cornerSize,b=c/2,d=this.getViewportTransform(),f=1<this.strokeWidth?this.strokeWidth:0,g=this.width,h=this.height,n="round"===this.strokeLineCap||"square"===this.strokeLineCap,k="line"===this.type&&1===this.width,l="line"===this.type&&1===this.height,q=n&&l||"line"!==this.type,n=n&&k||"line"!==this.type;k?g=f:l&&(h=f);q&&(g+=f);n&&(h+=f);g*=this.scaleX;h*=this.scaleY;f=fabric.util.transformPoint(new fabric.Point(g,
h),d,!0);d=f.x;f=f.y;g=-(d/2);h=-(f/2);k=this.padding;c=b-c;l=this.transparentCorners?"strokeRect":"fillRect";a.save();a.lineWidth=1;a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;a.strokeStyle=a.fillStyle=this.cornerColor;this._drawControl("tl",a,l,g-b-k,h-b-k);this._drawControl("tr",a,l,g+d-b+k,h-b-k);this._drawControl("bl",a,l,g-b-k,h+f+c+k);this._drawControl("br",a,l,g+d+c+k,h+f+c+k);this.get("lockUniScaling")||(this._drawControl("mt",a,l,g+d/2-b,h-b-k),this._drawControl("mb",a,l,
g+d/2-b,h+f+c+k),this._drawControl("mr",a,l,g+d+c+k,h+f/2-b),this._drawControl("ml",a,l,g-b-k,h+f/2-b));this.hasRotatingPoint&&this._drawControl("mtr",a,l,g+d/2-b,h-this.rotatingPointOffset-this.cornerSize/2-k);a.restore();return this},_drawControl:function(a,c,b,d,f){var g=this.cornerSize;this.isControlVisible(a)&&("undefined"!==typeof G_vmlCanvasManager||this.transparentCorners||c.clearRect(d,f,g,g),c[b](d,f,g,g))},isControlVisible:function(a){return this._getControlsVisibility()[a]},setControlVisible:function(a,
c){this._getControlsVisibility()[a]=c;return this},setControlsVisibility:function(a){a||(a={});for(var c in a)this.setControlVisible(c,a[c]);return this},_getControlsVisibility:function(){this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0});return this._controlsVisibility}})})();
(function(d){function a(a,b){var c=a.origin,d=a.axis1,e=a.axis2,f=a.dimension,r=b.nearest,t=b.center,w=b.farthest;return function(){switch(this.get(c)){case r:return Math.min(this.get(d),this.get(e));case t:return Math.min(this.get(d),this.get(e))+0.5*this.get(f);case w:return Math.max(this.get(d),this.get(e))}}}var c=d.fabric||(d.fabric={}),b=c.util.object.extend,e={x1:1,x2:1,y1:1,y2:1},f=c.StaticCanvas.supports("setLineDash");c.Line?c.warn("fabric.Line is already defined"):(c.Line=c.util.createClass(c.Object,
{type:"line",x1:0,y1:0,x2:0,y2:0,initialize:function(a,b){b=b||{};a||(a=[0,0,0,0]);this.callSuper("initialize",b);this.set("x1",a[0]);this.set("y1",a[1]);this.set("x2",a[2]);this.set("y2",a[3]);this._setWidthHeight(b)},_setWidthHeight:function(a){a||(a={});this.width=Math.abs(this.x2-this.x1)||1;this.height=Math.abs(this.y2-this.y1)||1;this.left="left"in a?a.left:this._getLeftToOriginX();this.top="top"in a?a.top:this._getTopToOriginY()},_set:function(a,b){this[a]=b;"undefined"!==typeof e[a]&&this._setWidthHeight();
return this},_getLeftToOriginX:a({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:a({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(a,b){a.beginPath();if(b){var c=this.getCenterPoint();a.translate(c.x,c.y)}if(!this.strokeDashArray||this.strokeDashArray&&f){var c=this.x1<=this.x2?-1:1,d=this.y1<=this.y2?-1:1;a.moveTo(1===this.width?0:c*this.width/
2,1===this.height?0:d*this.height/2);a.lineTo(1===this.width?0:-1*c*this.width/2,1===this.height?0:-1*d*this.height/2)}a.lineWidth=this.strokeWidth;c=a.strokeStyle;a.strokeStyle=this.stroke||a.fillStyle;this.stroke&&this._renderStroke(a);a.strokeStyle=c},_renderDashedStroke:function(a){var b=this.x1<=this.x2?-1:1,d=this.y1<=this.y2?-1:1,b=1===this.width?0:b*this.width/2,d=1===this.height?0:d*this.height/2;a.beginPath();c.util.drawDashedLine(a,b,d,-b,-d,this.strokeDashArray);a.closePath()},toObject:function(a){return b(this.callSuper("toObject",
a),{x1:this.get("x1"),y1:this.get("y1"),x2:this.get("x2"),y2:this.get("y2")})},toSVG:function(a){var b=this._createBaseSVGMarkup(),c="";this.group||(c="translate("+(-this.width/2-(this.x1>this.x2?this.x2:this.x1))+", "+(-this.height/2-(this.y1>this.y2?this.y2:this.y1))+") ");b.push("<line ",'x1="',this.x1,'" y1="',this.y1,'" x2="',this.x2,'" y2="',this.y2,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),c,this.getSvgTransformMatrix(),'"/>\n');return a?a(b.join("")):b.join("")},
complexity:function(){return 1}}),c.Line.fromObject=function(a){return new c.Line([a.x1,a.y1,a.x2,a.y2],a)})})("undefined"!==typeof exports?exports:this);
(function(d){var a=d.fabric||(d.fabric={}),c=2*Math.PI,b=a.util.object.extend;a.Circle?a.warn("fabric.Circle is already defined."):(a.Circle=a.util.createClass(a.Object,{type:"circle",radius:0,initialize:function(a){a=a||{};this.callSuper("initialize",a);this.set("radius",a.radius||0)},_set:function(a,b){this.callSuper("_set",a,b);"radius"===a&&this.setRadius(b);return this},toObject:function(a){return b(this.callSuper("toObject",a),{radius:this.get("radius")})},toSVG:function(a){var b=this._createBaseSVGMarkup(),
c=0,d=0;this.group&&(c=this.left+this.radius,d=this.top+this.radius);b.push("<circle ",'cx="'+c+'" cy="'+d+'" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n');return a?a(b.join("")):b.join("")},_render:function(a,b){a.beginPath();a.arc(b?this.left+this.radius:0,b?this.top+this.radius:0,this.radius,0,c,!1);this._renderFill(a);this._renderStroke(a)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},
getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(a){this.radius=a;this.set("width",2*a).set("height",2*a)},complexity:function(){return 1}}),a.Circle.fromObject=function(b){return new a.Circle(b)})})("undefined"!==typeof exports?exports:this);
(function(d){var a=d.fabric||(d.fabric={});a.Triangle?a.warn("fabric.Triangle is already defined"):(a.Triangle=a.util.createClass(a.Object,{type:"triangle",initialize:function(a){a=a||{};this.callSuper("initialize",a);this.set("width",a.width||100).set("height",a.height||100)},_render:function(a){var b=this.width/2,d=this.height/2;a.beginPath();a.moveTo(-b,d);a.lineTo(0,-d);a.lineTo(b,d);a.closePath();this._renderFill(a);this._renderStroke(a)},_renderDashedStroke:function(c){var b=this.width/2,d=
this.height/2;c.beginPath();a.util.drawDashedLine(c,-b,d,0,-d,this.strokeDashArray);a.util.drawDashedLine(c,0,-d,b,d,this.strokeDashArray);a.util.drawDashedLine(c,b,d,-b,d,this.strokeDashArray);c.closePath()},toSVG:function(a){var b=this._createBaseSVGMarkup(),d=this.width/2,f=this.height/2,d=[-d+" "+f,"0 "+-f,d+" "+f].join();b.push("<polygon ",'points="',d,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return a?a(b.join("")):b.join("")},complexity:function(){return 1}}),
a.Triangle.fromObject=function(c){return new a.Triangle(c)})})("undefined"!==typeof exports?exports:this);
(function(d){var a=d.fabric||(d.fabric={}),c=2*Math.PI,b=a.util.object.extend;a.Ellipse?a.warn("fabric.Ellipse is already defined."):(a.Ellipse=a.util.createClass(a.Object,{type:"ellipse",rx:0,ry:0,initialize:function(a){a=a||{};this.callSuper("initialize",a);this.set("rx",a.rx||0);this.set("ry",a.ry||0);this.set("width",2*this.get("rx"));this.set("height",2*this.get("ry"))},toObject:function(a){return b(this.callSuper("toObject",a),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(a){var b=
this._createBaseSVGMarkup(),c=0,d=0;this.group&&(c=this.left+this.rx,d=this.top+this.ry);b.push("<ellipse ",'cx="',c,'" cy="',d,'" ','rx="',this.rx,'" ry="',this.ry,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return a?a(b.join("")):b.join("")},_render:function(a,b){a.beginPath();a.save();a.transform(1,0,0,this.ry/this.rx,0,0);a.arc(b?this.left+this.rx:0,b?(this.top+this.ry)*this.rx/this.ry:0,this.rx,0,c,!1);a.restore();this._renderFill(a);
this._renderStroke(a)},complexity:function(){return 1}}),a.Ellipse.fromObject=function(b){return new a.Ellipse(b)})})("undefined"!==typeof exports?exports:this);
(function(d){var a=d.fabric||(d.fabric={}),c=a.util.object.extend;a.Rect?console.warn("fabric.Rect is already defined"):(d=a.Object.prototype.stateProperties.concat(),d.push("rx","ry","x","y"),a.Rect=a.util.createClass(a.Object,{stateProperties:d,type:"rect",rx:0,ry:0,strokeDashArray:null,initialize:function(a){a=a||{};this.callSuper("initialize",a);this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(a,c){if(1===this.width&&
1===this.height)a.fillRect(0,0,1,1);else{var d=this.rx?Math.min(this.rx,this.width/2):0,g=this.ry?Math.min(this.ry,this.height/2):0,h=this.width,n=this.height,k=c?this.left:0,l=c?this.top:0,q=0!==d||0!==g;a.beginPath();c||a.translate(-this.width/2,-this.height/2);a.moveTo(k+d,l);a.lineTo(k+h-d,l);q&&a.bezierCurveTo(k+h-0.4477152502*d,l,k+h,l+0.4477152502*g,k+h,l+g);a.lineTo(k+h,l+n-g);q&&a.bezierCurveTo(k+h,l+n-0.4477152502*g,k+h-0.4477152502*d,l+n,k+h-d,l+n);a.lineTo(k+d,l+n);q&&a.bezierCurveTo(k+
0.4477152502*d,l+n,k,l+n-0.4477152502*g,k,l+n-g);a.lineTo(k,l+g);q&&a.bezierCurveTo(k,l+0.4477152502*g,k+0.4477152502*d,l,k+d,l);a.closePath();this._renderFill(a);this._renderStroke(a)}},_renderDashedStroke:function(b){var c=-this.width/2,d=-this.height/2,g=this.width,h=this.height;b.beginPath();a.util.drawDashedLine(b,c,d,c+g,d,this.strokeDashArray);a.util.drawDashedLine(b,c+g,d,c+g,d+h,this.strokeDashArray);a.util.drawDashedLine(b,c+g,d+h,c,d+h,this.strokeDashArray);a.util.drawDashedLine(b,c,d+
h,c,d,this.strokeDashArray);b.closePath()},toObject:function(a){a=c(this.callSuper("toObject",a),{rx:this.get("rx")||0,ry:this.get("ry")||0});this.includeDefaultValues||this._removeDefaultValues(a);return a},toSVG:function(a){var c=this._createBaseSVGMarkup(),d=this.left,g=this.top;this.group||(d=-this.width/2,g=-this.height/2);c.push("<rect ",'x="',d,'" y="',g,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',
this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return a?a(c.join("")):c.join("")},complexity:function(){return 1}}),a.Rect.fromObject=function(b){return new a.Rect(b)})})("undefined"!==typeof exports?exports:this);
(function(d){var a=d.fabric||(d.fabric={}),c=a.util.toFixed;a.Polyline?a.warn("fabric.Polyline is already defined"):(a.Polyline=a.util.createClass(a.Object,{type:"polyline",points:null,initialize:function(a,c,d){c=c||{};this.set("points",a);this.callSuper("initialize",c);this._calcDimensions(d)},_calcDimensions:function(b){return a.Polygon.prototype._calcDimensions.call(this,b)},toObject:function(b){return a.Polygon.prototype.toObject.call(this,b)},toSVG:function(a){for(var d=[],f=this._createBaseSVGMarkup(),
g=0,h=this.points.length;g<h;g++)d.push(c(this.points[g].x,2),",",c(this.points[g].y,2)," ");f.push("<polyline ",'points="',d.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n');return a?a(f.join("")):f.join("")},_render:function(a){var c;a.beginPath();a.moveTo(this.points[0].x,this.points[0].y);for(var d=0,g=this.points.length;d<g;d++)c=this.points[d],a.lineTo(c.x,c.y);this._renderFill(a);this._renderStroke(a)},_renderDashedStroke:function(b){var c,
d;b.beginPath();for(var g=0,h=this.points.length;g<h;g++)c=this.points[g],d=this.points[g+1]||c,a.util.drawDashedLine(b,c.x,c.y,d.x,d.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),a.Polyline.fromObject=function(b){return new a.Polyline(b.points,b,!0)})})("undefined"!==typeof exports?exports:this);
(function(d){var a=d.fabric||(d.fabric={}),c=a.util.object.extend,b=a.util.array.min,e=a.util.array.max,f=a.util.toFixed;a.Polygon?a.warn("fabric.Polygon is already defined"):(a.Polygon=a.util.createClass(a.Object,{type:"polygon",points:null,initialize:function(a,b,c){b=b||{};this.points=a;this.callSuper("initialize",b);this._calcDimensions(c)},_calcDimensions:function(a){var c=this.points,d=b(c,"x"),f=b(c,"y"),l=e(c,"x"),c=e(c,"y");this.width=l-d||1;this.height=c-f||1;this.minX=d;this.minY=f;if(!a){var q=
this.width/2+this.minX,r=this.height/2+this.minY;this.points.forEach(function(a){a.x-=q;a.y-=r},this)}},toObject:function(a){return c(this.callSuper("toObject",a),{points:this.points.concat()})},toSVG:function(a){for(var b=[],c=this._createBaseSVGMarkup(),d=0,e=this.points.length;d<e;d++)b.push(f(this.points[d].x,2),",",f(this.points[d].y,2)," ");c.push("<polygon ",'points="',b.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n');
return a?a(c.join("")):c.join("")},_render:function(a){var b;a.beginPath();a.moveTo(this.points[0].x,this.points[0].y);for(var c=0,d=this.points.length;c<d;c++)b=this.points[c],a.lineTo(b.x,b.y);this._renderFill(a);if(this.stroke||this.strokeDashArray)a.closePath(),this._renderStroke(a)},_renderDashedStroke:function(b){var c,d;b.beginPath();for(var e=0,f=this.points.length;e<f;e++)c=this.points[e],d=this.points[e+1]||this.points[0],a.util.drawDashedLine(b,c.x,c.y,d.x,d.y,this.strokeDashArray);b.closePath()},
complexity:function(){return this.points.length}}),a.Polygon.fromObject=function(b){return new a.Polygon(b.points,b,!0)})})("undefined"!==typeof exports?exports:this);
(function(d){function a(a){return"H"===a[0]?a[1]:a[a.length-2]}function c(a){return"V"===a[0]?a[1]:a[a.length-1]}var b=d.fabric||(d.fabric={}),e=b.util.array.min,f=b.util.array.max,g=b.util.object.extend,h=Object.prototype.toString,n=b.util.drawArc,k={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},l={m:"l",M:"L"};b.Path?b.warn("fabric.Path is already defined"):(b.Path=b.util.createClass(b.Object,{type:"path",path:null,initialize:function(a,b){b=b||{};this.setOptions(b);if(!a)throw Error("`path` argument is required");
var c="[object Array]"===h.call(a);if(this.path=c?a:a.match&&a.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi))c||(this.path=this._parsePath()),this._initializePath(b),b.sourcePath&&this.setSourcePath(b.sourcePath)},_initializePath:function(a){var b="width"in a&&null!=a.width,c="height"in a&&null!=a.width,d="left"in a,e="top"in a,f=d?this.left:0,h=e?this.top:0;b&&c?(e||(this.top=this.height/2),d||(this.left=this.width/2)):(g(this,this._parseDimensions()),b&&(this.width=a.width),c&&(this.height=a.height));this.pathOffset=
this.pathOffset||this._calculatePathOffset(f,h)},_calculatePathOffset:function(a,b){return{x:this.left-a-this.width/2,y:this.top-b-this.height/2}},_render:function(a,b){var c,d=null,e=0,f=0,g=0,h=0,k=0,l=0,z,s,F,H,u=-(this.width/2+this.pathOffset.x),A=-(this.height/2+this.pathOffset.y);b&&(u+=this.width/2,A+=this.height/2);for(var J=0,K=this.path.length;J<K;++J){c=this.path[J];switch(c[0]){case "l":g+=c[1];h+=c[2];a.lineTo(g+u,h+A);break;case "L":g=c[1];h=c[2];a.lineTo(g+u,h+A);break;case "h":g+=
c[1];a.lineTo(g+u,h+A);break;case "H":g=c[1];a.lineTo(g+u,h+A);break;case "v":h+=c[1];a.lineTo(g+u,h+A);break;case "V":h=c[1];a.lineTo(g+u,h+A);break;case "m":g+=c[1];h+=c[2];e=g;f=h;a.moveTo(g+u,h+A);break;case "M":g=c[1];h=c[2];e=g;f=h;a.moveTo(g+u,h+A);break;case "c":z=g+c[5];s=h+c[6];k=g+c[3];l=h+c[4];a.bezierCurveTo(g+c[1]+u,h+c[2]+A,k+u,l+A,z+u,s+A);g=z;h=s;break;case "C":g=c[5];h=c[6];k=c[3];l=c[4];a.bezierCurveTo(c[1]+u,c[2]+A,k+u,l+A,g+u,h+A);break;case "s":z=g+c[3];s=h+c[4];k=k?2*g-k:g;
l=l?2*h-l:h;a.bezierCurveTo(k+u,l+A,g+c[1]+u,h+c[2]+A,z+u,s+A);k=g+c[1];l=h+c[2];g=z;h=s;break;case "S":z=c[3];s=c[4];k=2*g-k;l=2*h-l;a.bezierCurveTo(k+u,l+A,c[1]+u,c[2]+A,z+u,s+A);g=z;h=s;k=c[1];l=c[2];break;case "q":z=g+c[3];s=h+c[4];k=g+c[1];l=h+c[2];a.quadraticCurveTo(k+u,l+A,z+u,s+A);g=z;h=s;break;case "Q":z=c[3];s=c[4];a.quadraticCurveTo(c[1]+u,c[2]+A,z+u,s+A);g=z;h=s;k=c[1];l=c[2];break;case "t":z=g+c[1];s=h+c[2];null===d[0].match(/[QqTt]/)?(k=g,l=h):"t"===d[0]?(k=2*g-F,l=2*h-H):"q"===d[0]&&
(k=2*g-k,l=2*h-l);F=k;H=l;a.quadraticCurveTo(k+u,l+A,z+u,s+A);g=z;h=s;k=g+c[1];l=h+c[2];break;case "T":z=c[1];s=c[2];k=2*g-k;l=2*h-l;a.quadraticCurveTo(k+u,l+A,z+u,s+A);g=z;h=s;break;case "a":n(a,g+u,h+A,[c[1],c[2],c[3],c[4],c[5],c[6]+g+u,c[7]+h+A]);g+=c[6];h+=c[7];break;case "A":n(a,g+u,h+A,[c[1],c[2],c[3],c[4],c[5],c[6]+u,c[7]+A]);g=c[6];h=c[7];break;case "z":case "Z":g=e,h=f,a.closePath()}d=c}},render:function(a,c){if(this.visible){a.save();c&&a.translate(-this.width/2,-this.height/2);var d=this.transformMatrix;
d&&a.transform(d[0],d[1],d[2],d[3],d[4],d[5]);c||this.transform(a);this._setStrokeStyles(a);this._setFillStyles(a);this._setShadow(a);this.clipTo&&b.util.clipContext(this,a);a.beginPath();a.globalAlpha=this.group?a.globalAlpha*this.opacity:this.opacity;this._render(a,c);this._renderFill(a);this._renderStroke(a);this.clipTo&&a.restore();this._removeShadow(a);a.restore()}},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(a){a=
g(this.callSuper("toObject",a),{path:this.path.map(function(a){return a.slice()}),pathOffset:this.pathOffset});this.sourcePath&&(a.sourcePath=this.sourcePath);this.transformMatrix&&(a.transformMatrix=this.transformMatrix);return a},toDatalessObject:function(a){a=this.toObject(a);this.sourcePath&&(a.path=this.sourcePath);delete a.sourcePath;return a},toSVG:function(a){for(var b=[],c=this._createBaseSVGMarkup(),d=0,e=this.path.length;d<e;d++)b.push(this.path[d].join(" "));b=b.join(" ");c.push("<path ",
'd="',b,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'" stroke-linecap="round" ',"/>\n");return a?a(c.join("")):c.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var a=[],b=[],c,d,e=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/ig,f,g=0,h=this.path.length;g<h;g++){c=this.path[g];f=c.slice(1).trim();for(b.length=0;d=e.exec(f);)b.push(d[0]);c=[c.charAt(0)];f=0;for(var n=b.length;f<n;f++)d=parseFloat(b[f]),
isNaN(d)||c.push(d);d=c[0];f=k[d.toLowerCase()];n=l[d]||d;if(c.length-1>f)for(var C=1,z=c.length;C<z;C+=f)a.push([d].concat(c.slice(C,C+f))),d=n;else a.push(c)}return a},_parseDimensions:function(){var a=[],b=[],c={};this.path.forEach(function(d,e){this._getCoordsFromCommand(d,e,a,b,c)},this);var d=e(a),g=e(b),h=f(a),k=f(b),h=h-d,k=k-g;return{left:this.left+(d+h/2),top:this.top+(g+k/2),width:h,height:k}},_getCoordsFromCommand:function(b,d,e,f,g){var h=!1;"H"!==b[0]&&(g.x=0===d?a(b):a(this.path[d-
1]));"V"!==b[0]&&(g.y=0===d?c(b):c(this.path[d-1]));b[0]===b[0].toLowerCase()&&(h=!0);b=this._getXY(b,h,g);d=parseInt(b.x,10);isNaN(d)||e.push(d);d=parseInt(b.y,10);isNaN(d)||f.push(d)},_getXY:function(b,d,e){var f=d?e.x+a(b):"V"===b[0]?e.x:a(b);b=d?e.y+c(b):"H"===b[0]?e.y:c(b);return{x:f,y:b}}}),b.Path.fromObject=function(a,c){"string"===typeof a.path?b.loadSVGFromURL(a.path,function(d){d=d[0];var e=a.path;delete a.path;b.util.object.extend(d,a);d.setSourcePath(e);c(d)}):c(new b.Path(a.path,a))},
b.Path.async=!0)})("undefined"!==typeof exports?exports:this);
(function(d){var a=d.fabric||(d.fabric={}),c=a.util.object.extend,b=a.util.array.invoke,e=a.Object.prototype.toObject;a.PathGroup?a.warn("fabric.PathGroup is already defined"):(a.PathGroup=a.util.createClass(a.Path,{type:"path-group",fill:"",initialize:function(a,b){b=b||{};this.paths=a||[];for(var c=this.paths.length;c--;)this.paths[c].group=this;this.setOptions(b);b.widthAttr&&(this.scaleX=b.widthAttr/b.width);b.heightAttr&&(this.scaleY=b.heightAttr/b.height);this.setCoords();b.sourcePath&&this.setSourcePath(b.sourcePath)},
render:function(b){if(this.visible){b.save();var c=this.transformMatrix;c&&b.transform(c[0],c[1],c[2],c[3],c[4],c[5]);this.transform(b);this._setShadow(b);this.clipTo&&a.util.clipContext(this,b);for(var c=0,d=this.paths.length;c<d;++c)this.paths[c].render(b,!0);this.clipTo&&b.restore();this._removeShadow(b);b.restore()}},_set:function(a,b){if("fill"===a&&b&&this.isSameColor())for(var c=this.paths.length;c--;)this.paths[c]._set(a,b);return this.callSuper("_set",a,b)},toObject:function(a){a=c(e.call(this,
a),{paths:b(this.getObjects(),"toObject",a)});this.sourcePath&&(a.sourcePath=this.sourcePath);return a},toDatalessObject:function(a){a=this.toObject(a);this.sourcePath&&(a.paths=this.sourcePath);return a},toSVG:function(a){for(var b=this.getObjects(),c="translate("+this.left+" "+this.top+")",c=["<g ",'style="',this.getSvgStyles(),'" ','transform="',c,this.getSvgTransform(),'" ',">\n"],d=0,e=b.length;d<e;d++)c.push(b[d].toSVG(a));c.push("</g>\n");return a?a(c.join("")):c.join("")},toString:function(){return"#<fabric.PathGroup ("+
this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var a=(this.getObjects()[0].get("fill")||"").toLowerCase();return this.getObjects().every(function(b){return(b.get("fill")||"").toLowerCase()===a})},complexity:function(){return this.paths.reduce(function(a,b){return a+(b&&b.complexity?b.complexity():0)},0)},getObjects:function(){return this.paths}}),a.PathGroup.fromObject=function(b,c){"string"===typeof b.paths?a.loadSVGFromURL(b.paths,function(d){var e=b.paths;
delete b.paths;d=a.util.groupSVGElements(d,b,e);c(d)}):a.util.enlivenObjects(b.paths,function(d){delete b.paths;c(new a.PathGroup(d,b))})},a.PathGroup.async=!0)})("undefined"!==typeof exports?exports:this);
(function(d){var a=d.fabric||(d.fabric={}),c=a.util.object.extend,b=a.util.array.min,e=a.util.array.max,f=a.util.array.invoke;if(!a.Group){var g={lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0};a.Group=a.util.createClass(a.Object,a.Collection,{type:"group",initialize:function(a,b){b=b||{};this._objects=a||[];for(var d=this._objects.length;d--;)this._objects[d].group=this;this.originalState={};this.callSuper("initialize");this._calcBounds();this._updateObjectsCoords();
b&&c(this,b);this._setOpacityIfSame();this.setCoords();this.saveCoords()},_updateObjectsCoords:function(){this.forEachObject(this._updateObjectCoords,this)},_updateObjectCoords:function(a){var b=a.getLeft(),c=a.getTop();a.set({originalLeft:b,originalTop:c,left:b-this.left,top:c-this.top});a.setCoords();a.__origHasControls=a.hasControls;a.hasControls=!1},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(a){this._restoreObjectsState();a&&(this._objects.push(a),
a.group=this);this.forEachObject(this._setObjectActive,this);this._calcBounds();this._updateObjectsCoords();return this},_setObjectActive:function(a){a.set("active",!0);a.group=this},removeWithUpdate:function(a){this._moveFlippedObject(a);this._restoreObjectsState();this.forEachObject(this._setObjectActive,this);this.remove(a);this._calcBounds();this._updateObjectsCoords();return this},_onObjectAdded:function(a){a.group=this},_onObjectRemoved:function(a){delete a.group;a.set("active",!1)},delegatedProperties:{fill:!0,
opacity:!0,fontFamily:!0,fontWeight:!0,fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,textAlign:!0,backgroundColor:!0},_set:function(a,b){if(a in this.delegatedProperties){var c=this._objects.length;for(this[a]=b;c--;)this._objects[c].set(a,b)}else this[a]=b},toObject:function(a){return c(this.callSuper("toObject",a),{objects:f(this._objects,"toObject",a)})},render:function(b){if(this.visible){b.save();this.clipTo&&a.util.clipContext(this,b);for(var c=0,d=this._objects.length;c<d;c++)this._renderObject(this._objects[c],
b);this.clipTo&&b.restore();b.restore()}},_renderControls:function(a,b){this.callSuper("_renderControls",a,b);for(var c=0,d=this._objects.length;c<d;c++)this._objects[c]._renderControls(a)},_renderObject:function(a,b){var c=a.hasRotatingPoint;a.visible&&(a.hasRotatingPoint=!1,a.render(b),a.hasRotatingPoint=c)},_restoreObjectsState:function(){this._objects.forEach(this._restoreObjectState,this);return this},_moveFlippedObject:function(a){var b=a.get("originX"),c=a.get("originY"),d=a.getCenterPoint();
a.set({originX:"center",originY:"center",left:d.x,top:d.y});this._toggleFlipping(a);d=a.getPointByOrigin(b,c);a.set({originX:b,originY:c,left:d.x,top:d.y});return this},_toggleFlipping:function(a){this.flipX&&(a.toggle("flipX"),a.set("left",-a.get("left")),a.setAngle(-a.getAngle()));this.flipY&&(a.toggle("flipY"),a.set("top",-a.get("top")),a.setAngle(-a.getAngle()))},_restoreObjectState:function(a){this._setObjectPosition(a);a.setCoords();a.hasControls=a.__origHasControls;delete a.__origHasControls;
a.set("active",!1);a.setCoords();delete a.group;return this},_setObjectPosition:function(a){var b=this.getLeft(),c=this.getTop(),d=this._getRotatedLeftTop(a);a.set({angle:a.getAngle()+this.getAngle(),left:b+d.left,top:c+d.top,scaleX:a.get("scaleX")*this.get("scaleX"),scaleY:a.get("scaleY")*this.get("scaleY")})},_getRotatedLeftTop:function(a){var b=this.getAngle()*(Math.PI/180);return{left:-Math.sin(b)*a.getTop()*this.get("scaleY")+Math.cos(b)*a.getLeft()*this.get("scaleX"),top:Math.cos(b)*a.getTop()*
this.get("scaleY")+Math.sin(b)*a.getLeft()*this.get("scaleX")}},destroy:function(){this._objects.forEach(this._moveFlippedObject,this);return this._restoreObjectsState()},saveCoords:function(){this._originalLeft=this.get("left");this._originalTop=this.get("top");return this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){this.forEachObject(function(a){a.setCoords()});return this},_setOpacityIfSame:function(){var a=
this.getObjects(),b=a[0]?a[0].get("opacity"):1;a.every(function(a){return a.get("opacity")===b})&&(this.opacity=b)},_calcBounds:function(a){for(var b=[],c=[],d,e=0,f=this._objects.length;e<f;++e){d=this._objects[e];d.setCoords();for(var g in d.oCoords)b.push(d.oCoords[g].x),c.push(d.oCoords[g].y)}this.set(this._getBounds(b,c,a))},_getBounds:function(c,d,f){var g=a.util.invertTransform(this.getViewportTransform()),q=a.util.transformPoint(new a.Point(b(c),b(d)),g);c=a.util.transformPoint(new a.Point(e(c),
e(d)),g);d={width:c.x-q.x||0,height:c.y-q.y||0};f||(d.left=(q.x+c.x)/2||0,d.top=(q.y+c.y)/2||0);return d},toSVG:function(a){for(var b=["<g ",'transform="',this.getSvgTransform(),'">\n'],c=0,d=this._objects.length;c<d;c++)b.push(this._objects[c].toSVG(a));b.push("</g>\n");return a?a(b.join("")):b.join("")},get:function(a){if(a in g){if(this[a])return this[a];for(var b=0,c=this._objects.length;b<c;b++)if(this._objects[b][a])return!0;return!1}return a in this.delegatedProperties?this._objects[0]&&this._objects[0].get(a):
this[a]}});a.Group.fromObject=function(b,c){a.util.enlivenObjects(b.objects,function(d){delete b.objects;c&&c(new a.Group(d,b))})};a.Group.async=!0}})("undefined"!==typeof exports?exports:this);
(function(d){var a=fabric.util.object.extend;d.fabric||(d.fabric={});d.fabric.Image?fabric.warn("fabric.Image is already defined."):(fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",initialize:function(a,b){b||(b={});this.filters=[];this.callSuper("initialize",b);this._initElement(a,b);this._initConfig(b);b.filters&&(this.filters=b.filters,this.applyFilters())},getElement:function(){return this._element},setElement:function(a,b){this._originalElement=this._element=a;
this._initConfig();0!==this.filters.length&&this.applyFilters(b);return this},setCrossOrigin:function(a){this.crossOrigin=a;this._element.crossOrigin=a;return this},getOriginalSize:function(){var a=this.getElement();return{width:a.width,height:a.height}},_stroke:function(a){a.save();this._setStrokeStyles(a);a.beginPath();a.strokeRect(-this.width/2,-this.height/2,this.width,this.height);a.closePath();a.restore()},_renderDashedStroke:function(a){var b=-this.width/2,d=-this.height/2,f=this.width,g=this.height;
a.save();this._setStrokeStyles(a);a.beginPath();fabric.util.drawDashedLine(a,b,d,b+f,d,this.strokeDashArray);fabric.util.drawDashedLine(a,b+f,d,b+f,d+g,this.strokeDashArray);fabric.util.drawDashedLine(a,b+f,d+g,b,d+g,this.strokeDashArray);fabric.util.drawDashedLine(a,b,d+g,b,d,this.strokeDashArray);a.closePath();a.restore()},toObject:function(c){return a(this.callSuper("toObject",c),{src:this._originalElement.src||this._originalElement._src,filters:this.filters.map(function(a){return a&&a.toObject()}),
crossOrigin:this.crossOrigin})},toSVG:function(a){var b=[],d=-this.width/2,f=-this.height/2;this.group&&(d=this.left,f=this.top);b.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n','<image xlink:href="',this.getSvgSrc(),'" x="',d,'" y="',f,'" style="',this.getSvgStyles(),'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="none"',"></image>\n");if(this.stroke||this.strokeDashArray){var g=this.fill;this.fill=null;b.push("<rect ",'x="',d,'" y="',f,'" width="',
this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n');this.fill=g}b.push("</g>\n");return a?a(b.join("")):b.join("")},getSrc:function(){if(this.getElement())return this.getElement().src||this.getElement()._src},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(a,b){this.constructor.fromObject(this.toObject(b),a)},applyFilters:function(a){if(this._originalElement)if(0===this.filters.length)this._element=this._originalElement,a&&a();else{var b=
this._originalElement,d=fabric.util.createCanvasElement(),f=fabric.util.createImage(),g=this;d.width=b.width;d.height=b.height;d.getContext("2d").drawImage(b,0,0,b.width,b.height);this.filters.forEach(function(a){a&&a.applyTo(d)});f.width=b.width;f.height=b.height;fabric.isLikelyNode?(f.src=d.toBuffer(void 0,fabric.Image.pngCompression),g._element=f,a&&a()):(f.onload=function(){g._element=f;a&&a();f.onload=d=b=null},f.src=d.toDataURL("image/png"));return this}},_render:function(a,b){this._element&&
a.drawImage(this._element,b?this.left:-this.width/2,b?this.top:-this.height/2,this.width,this.height);this._renderStroke(a)},_resetWidthHeight:function(){var a=this.getElement();this.set("width",a.width);this.set("height",a.height)},_initElement:function(a){this.setElement(fabric.util.getById(a));fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(a){a||(a={});this.setOptions(a);this._setWidthHeight(a);this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},
_initFilters:function(a,b){a.filters&&a.filters.length?fabric.util.enlivenObjects(a.filters,function(a){b&&b(a)},"fabric.Image.filters"):b&&b()},_setWidthHeight:function(a){this.width="width"in a?a.width:this.getElement()?this.getElement().width||0:0;this.height="height"in a?a.height:this.getElement()?this.getElement().height||0:0},complexity:function(){return 1}}),fabric.Image.CSS_CANVAS="canvas-img",fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc,fabric.Image.fromObject=function(a,
b){fabric.util.loadImage(a.src,function(d){fabric.Image.prototype._initFilters.call(a,a,function(f){a.filters=f||[];f=new fabric.Image(d,a);b&&b(f)})},null,a.crossOrigin)},fabric.Image.fromURL=function(a,b,d){fabric.util.loadImage(a,function(a){b(new fabric.Image(a,d))},null,d&&d.crossOrigin)},fabric.Image.async=!0,fabric.Image.pngCompression=1)})("undefined"!==typeof exports?exports:this);
(function(d){fabric.Canvas.EMPTY_JSON=fabric.StaticCanvas.EMPTY_JSON='{"objects":[],"background":""}';d.SimpleDraw=function(a,c,b){var d=this;c=c||{};d.drawingJSON=ko.observable();d.onChangeListeners=[];a.onselectstart=function(){return!1};var f=c.matchSize||$(a).parent(),g=function(){if(f&&f.width()&&f.height()){var h=d.canvas=new fabric[c.viewOnly?"StaticCanvas":"Canvas"](a,{isDrawingMode:!c.viewOnly}),n={width:c.width||f.width(),height:c.height||f.height()};h.setDimensions(n);var k=null;if(c.initialDrawingJSON)try{k=
JSON.parse(c.initialDrawingJSON)}catch(l){}k&&k.scaleFrom?d.scaleFrom=k.scaleFrom:c.scaleFrom&&"object"===typeof c.scaleFrom&&(d.scaleFrom=c.scaleFrom);var q=ZAP.util.calculateDrawingScale(n,d.scaleFrom);h.freeDrawingBrush=new fabric.PencilBrush(h);h.freeDrawingBrush.color="#FFFB00";h.freeDrawingBrush.width=5*ZAP.util.calculateDrawingScale(n,{width:619,height:348});h=function(){!c.viewOnly&&d.canvas&&(d._setupListeners(),setTimeout(d.updateOffset.bind(d),25));b&&setTimeout(b,0)};k?d.loadDrawingJSON(k,
q,h):h()}else setTimeout(g,25)};g()};d.SimpleDraw.prototype.renderJSON=function(a,c,b,d){var f=1;this.canvas&&(this.canvas.clear(),"undefined"===typeof b&&(b=!0),this.scaleFrom&&(f=ZAP.util.calculateDrawingScale(c,this.scaleFrom)),b&&(this.scaleFrom.width=c.width,this.scaleFrom.height=c.height),this.canvas.setDimensions(c),this.canvas.freeDrawingBrush.width=5*ZAP.util.calculateDrawingScale(c,{width:619,height:348}),this.loadDrawingJSON(a,f,d))};d.SimpleDraw.prototype.getDrawingJSON=function(){var a=
this.canvas.toJSON();this.scaleFrom&&(a.scaleFrom=this.scaleFrom);return JSON.stringify(a)};d.SimpleDraw.prototype.loadDrawingJSON=function(a,c,b){var d=this;b="function"===typeof b?b:function(){};d.canvas.loadFromJSON(a||fabric.Canvas.EMPTY_JSON,function(){if(!d.canvas)return b();d.canvas.renderAll();b()},function(a,b){b.scale(b.getScaleX()*c);b.setLeft(b.getLeft()*c);b.setTop(b.getTop()*c)})};d.SimpleDraw.prototype.clear=function(){this.canvas.clear()};d.SimpleDraw.prototype.destroy=function(){this.canvas&&
(this.canvas.off(),this.canvas.dispose(),this.canvas=null)};d.SimpleDraw.prototype.addChangeListener=function(a){this.onChangeListeners.push(a)};d.SimpleDraw.prototype.removeChangeListener=function(a){for(var c=0;c<this.onChangeListeners.length;c++)this.onChangeListeners[c]===a&&this.onChangeListeners.splice(c--,1)};d.SimpleDraw.prototype.updateOffset=function(){this.canvas&&this.canvas.calcOffset()};d.SimpleDraw.prototype._setupListeners=function(){var a=this,c=function(){a.drawingJSON(a.getDrawingJSON())};
a.canvas.on("object:modified",c);a.canvas.on("object:added",c);a.canvas.on("object:removed",c);a.canvas.on("canvas:cleared",c);a.canvas.on("mouse:down",a.updateOffset.bind(a));a.canvas.on("mouse:over",a.updateOffset.bind(a));a.drawingJSON.subscribe(function(){if(a.canvas)for(var b=0;b<a.onChangeListeners.length;b++)a.onChangeListeners[b](a.drawingJSON())})}})(window);
(function(){ZAP.player=ZAP.player||{};ZAP.player.centerFullScreenVideo=function(d,a,c,b){var e=$(".video-player");a-=c||46;b&&(d-=b);d=ZAP.player.getPlayerDimensions(d,a);if(d.width!==e.width()||e.height()!==screen.height)e.width(d.width),e.height(d.height),d.height<=a&&e.css({top:(a-d.height)/2+"px"})};ZAP.player.getPlayerDimensions=function(d,a){var c={},b=d/619,e=a/348;b<e?(c.width=d,c.height=348*b):(c.width=619*e,c.height=a);return c};ZAP.player.getCurrentRatio=function(){return $(".video-player").width()/
619}})();
